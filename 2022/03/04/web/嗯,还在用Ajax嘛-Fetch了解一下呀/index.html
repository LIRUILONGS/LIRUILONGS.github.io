<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>嗯,还在用Ajax嘛?Fetch了解一下呀! - 山河已无恙</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="山河已无恙"><meta name="msapplication-TileImage" content="https://cdn.jsdelivr.net/gh/removeif/removeif-demo@latest/img/favicon.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="山河已无恙"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta description="此刻你在沙漠里，因此你要潜心于沙漠之中。沙漠和世上其他东西一样，可以用来理解世界。你甚至不必理解沙漠，只要观察普通的沙粒就行，从中你可以看到天地万物的神奇之处。——–《牧羊少年的人生之旅》"><meta property="og:type" content="blog"><meta property="og:title" content="山河已无恙"><meta property="og:url" content="https://mp.weixin.qq.com/s?__biz=MzkyNjIxNTYwMw==&amp;mid=2247496480&amp;idx=1&amp;sn=a9971fed3962ef2a1aeda1f0bda65f86&amp;chksm=c2380ffcf54f86eaba8daac6caca72a70f38e61a8d25dc2a66d3a17b87c02530e326dcaea14b#rd"><meta property="og:site_name" content="山河已无恙"><meta property="og:description" content="此刻你在沙漠里，因此你要潜心于沙漠之中。沙漠和世上其他东西一样，可以用来理解世界。你甚至不必理解沙漠，只要观察普通的沙粒就行，从中你可以看到天地万物的神奇之处。——–《牧羊少年的人生之旅》"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://mp.weixin.qq.com/img/头像.jpg"><meta property="article:published_time" content="2022-03-04T13:47:08.000Z"><meta property="article:modified_time" content="2023-06-21T11:25:59.155Z"><meta property="article:author" content="LIRUILONGS"><meta property="article:tag" content="Fetch"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/头像.jpg"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://liruilongs.github.io/2022/03/04/web/%E5%97%AF,%E8%BF%98%E5%9C%A8%E7%94%A8Ajax%E5%98%9B-Fetch%E4%BA%86%E8%A7%A3%E4%B8%80%E4%B8%8B%E5%91%80/"},"headline":"山河已无恙","image":["https://liruilongs.github.io/img/og_image.png"],"datePublished":"2022-03-04T13:47:08.000Z","dateModified":"2023-06-21T11:25:59.155Z","author":{"@type":"Person","name":"山河已无恙"},"description":"此刻你在沙漠里，因此你要潜心于沙漠之中。沙漠和世上其他东西一样，可以用来理解世界。你甚至不必理解沙漠，只要观察普通的沙粒就行，从中你可以看到天地万物的神奇之处。——–《牧羊少年的人生之旅》"}</script><link rel="canonical" href="https://liruilongs.github.io/2022/03/04/web/%E5%97%AF,%E8%BF%98%E5%9C%A8%E7%94%A8Ajax%E5%98%9B-Fetch%E4%BA%86%E8%A7%A3%E4%B8%80%E4%B8%8B%E5%91%80/"><link rel="alternate" href="/path/to/atom.xml" title="山河已无恙" type="application/atom+xml"><link rel="icon" href="https://cdn.jsdelivr.net/gh/removeif/removeif-demo@latest/img/favicon.png"><meta name="referrer" content="no-referrer-when-downgrade"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/5.12.0/css/all.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/highlight.js/9.12.0/styles/dracula.min.css"><link rel="stylesheet" href="https://fonts.loli.net/css2?family=Oxanium:wght@300;400;600&amp;family=Roboto+Mono"><link rel="stylesheet" href="/css/cyberpunk.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/5.12.0/css/all.min.css"><link rel="stylesheet" href="https://fonts.loli.net/css?family=Ubuntu:400,600|Source+Code+Pro|Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Microsoft YaHei:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&amp;amp;subset=latin,latin-ext|Inconsolata|Itim|Lobster.css"><script src="https://cdnjs.loli.net/ajax/libs/jquery/3.3.1/jquery.min.js"></script><script src="/js/globalUtils.js"></script><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><script>var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?3f06f2b732a5b1034c989f74e28d0eea";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();</script><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.7.0/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.css"><script src="https://cdnjs.loli.net/ajax/libs/pace/1.0.2/pace.min.js"></script><meta name="generator" content="Hexo 5.4.2"></head><body class="is-3-column has-navbar-fixed-top"><nav class="navbar navbar-main is-fixed-top"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.png" alt="山河已无恙" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">首页</a><a class="navbar-item" href="/archives">归档</a><a class="navbar-item" href="/categories">分类</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/media">影音</a><a class="navbar-item" href="/album">相册</a><a class="navbar-item" href="/friend">友链</a><a class="navbar-item" href="/self-talking">生活小记</a><a class="navbar-item" href="/message">留言墙</a><a class="navbar-item" href="/about">关于</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Gitee" href="https://gitee.com/liruilonger"><i class="fab fa-git-square fa-1x"></i></a><a class="navbar-item" target="_blank" rel="noopener" title="GitHub" href="https://github.com/LIRUILONGS"><i class="fab fa-github fa-1x"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul fa-1x"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search fa-1x"></i></a><a class="navbar-item" id="night-nav" title="Night Mode" href="javascript:;"><i class="fas fa-moon fa-1x" id="night-icon"></i></a></div></div></div></nav><script type="text/javascript" src="/js/theme-setting.js"></script><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-9-widescreen"><!--!--><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2022-03-04  <a class="commentCountImg" href="/2022/03/04/web/%E5%97%AF,%E8%BF%98%E5%9C%A8%E7%94%A8Ajax%E5%98%9B-Fetch%E4%BA%86%E8%A7%A3%E4%B8%80%E4%B8%8B%E5%91%80/#comment-container"><span class="display-none-class">7a03e66e650bd2e9ae440e9611c42b26</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="7a03e66e650bd2e9ae440e9611c42b26">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>33 分钟  <i class="fas fa-pencil-alt"> </i>5.0 k</span><span class="level-item" id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span>次访问</span></div></div><h1 class="title is-3 is-size-4-mobile">嗯,还在用Ajax嘛?Fetch了解一下呀!</h1><div class="content"><p><strong><font color="009688">此刻你在沙漠里，因此你要潜心于沙漠之中。沙漠和世上其他东西一样，可以用来理解世界。你甚至不必理解沙漠，只要观察普通的沙粒就行，从中你可以看到天地万物的神奇之处。——–《牧羊少年的人生之旅》</strong></font></p>
<span id="more"></span>
<h2 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h2><hr>
<ul>
<li><p>之前写了一篇<code>AJAX</code>相关的博文的，看到有小伙伴讲到了<code>Fetch</code>，所以研究下</p>
</li>
<li><p>博文内容参考：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.ruanyifeng.com/blog/2020/12/fetch-tutorial.html">https://www.ruanyifeng.com/blog/2020/12/fetch-tutorial.html</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API">https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/node-fetch/node-fetch">https://github.com/node-fetch/node-fetch</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/github/fetch">https://github.com/github/fetch</a></li>
</ul>
</li>
<li><p><code>Demo</code>是搭了一个简单的<code>Flask</code>web服务,然后通过<code>Node</code>环境发出请求</p>
</li>
</ul>
<p><strong><font color="009688">此刻你在沙漠里，因此你要潜心于沙漠之中。沙漠和世上其他东西一样，可以用来理解世界。你甚至不必理解沙漠，只要观察普通的沙粒就行，从中你可以看到天地万物的神奇之处。——–《牧羊少年的人生之旅》</strong></font></p>
<hr>
<p><code>Fetch API </code>提供了一个获取资源的接口(包括跨域请求)。任何使用过<code>XMLHttpRequest</code>的人都能轻松上手，而且新的 API 提供了更强大和灵活的功能集。</p>
<p><code>Fetch </code>提供了对<code>Request</code>和<code>Response</code>,<code>Headers</code>(以及其他与网络请求有关的)对象的通用定义</p>
<p><code>fetch()</code> 必须接受一个参数——资源的路径。无论请求成功与否，它都返回一个<code>Promise</code>对象，<code>resolve</code> 对应请求的<code> Response</code>。你也可以传一个可选的第二个参数 <code>init</code>。</p>
<p>一旦<code>Response</code>被返回，就可以使用一些方法来定义内容的形式，以及应当如何处理内容,你也可以通过 Request() 和 Response() 的构造函数直接创建请求和响应，但是我们不建议这么做。</p>
<h1 id="Fetch-接口"><a href="#Fetch-接口" class="headerlink" title="Fetch 接口"></a>Fetch 接口</h1><ul>
<li><code>Headers</code>:相当于 response&#x2F;request 的头信息</li>
<li><code>Request</code>:相当于一个资源请求</li>
<li><code>Response</code>:相当于请求的响应</li>
</ul>
<h1 id="使用-Fetch"><a href="#使用-Fetch" class="headerlink" title="使用 Fetch"></a>使用 Fetch</h1><p><code>Fetch API </code>提供了一个<code>JavaScript</code>接口，用于访问和操纵 <code>HTTP 管道</code>的一些具体部分，例如请求和响应。它还提供了一个全局<code>fetch()</code>方法，该方法提供了一种简单，合理的方式来跨网络异步获取资源。</p>
<p>fetch 规范与<code>jQuery.ajax()</code>主要有以下的不同：</p>
<ul>
<li>当接收到一个代表错误的<code> HTTP 状态码</code>时，从 fetch() 返回的<code>Promise</code>不会被标记为<code> reject</code>，即使响应的<code> HTTP 状态码</code>是<code> 404 或 500</code>。相反，它会将<code>Promise</code>状态标记为 <code>resolve </code>(如果响应的 HTTP 状态码不在 200 - 299 的范围内，则设置 resolve 返回值的 ok 属性为 false )，仅当网络故障时或请求被阻止时，才会标记为<code> reject</code>。<br>+<code>fetch</code>不会发送跨域<code> cookies</code>，除非你使用了<code>credentials</code>的初始化选项。(自2018 年 8 月以后，默认的 credentials 政策变更为<code> same-origin</code>。Firefox 也在 61.0b13 版本中进行了修改)</li>
<li><code>fetch()</code>使用 <code>Promise</code>，不使用<code>回调函数</code>，因此大大简化了写法，写起来更简洁。</li>
<li><code>fetch()</code>采用<code>模块化设计</code>，API 分散在多个对象上(<code>Response 对象、Request 对象、Headers 对象</code>)，更合理一些；相比之下，<code>XMLHttpRequest</code> 的 API 设计并不是很好，输入、输出、状态都在同一个接口管理，容易写出非常混乱的代码。</li>
<li><code>fetch()通过数据流(Stream 对象)处理数据</code>，可以分块读取，有利于提高网站性能表现，减少内存占用，对于请求大文件或者网速慢的场景相当有用。XMLHTTPRequest 对象不支持数据流，所有的数据必须放在缓存里，不支持分块读取，必须等待全部拿到后，再一次性吐出来。</li>
</ul>
<p>在用法上，<code>fetch()</code>接受一个<code>URL</code>字符串作为参数，默认向该网址发出<code>GET</code>请求，返回一个 <code>Promise </code>对象。</p>
<h2 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h2><p>这里我们用<code>Node</code>环境来学习，当然在浏览器更有可比性，需要安装基于<code>Node</code>的依赖包<code>node-fetch</code>，这里一定要注意版本问题</p>
<ul>
<li><code>node-fetch</code>用于<code>服务器端</code>，即只能在<code>nodejs</code>中用</li>
<li><code>whatwg-fetch</code>用于<code>客户端</code>,即用于在<code>浏览器没有原生支持fetch</code>的情况</li>
<li><code>isomorphic-fetch</code>可以在<code>nodejs</code>和<code>浏览器</code>两种环境中运行，是对<code>whatwg-fetch</code>的<code>包装</code>。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install node-fetch@<span class="number">2</span></span><br></pre></td></tr></table></figure>
<p>同时我们需要一个<code>Web</code>服务用作测试，这里用<code>python</code>搭一个简单的<code>Web</code>服务</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># Python 3.9.0</span></span><br><span class="line"><span class="comment"># pip install flask</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">@File    :   fetch.py</span></span><br><span class="line"><span class="string">@Time    :   2022/03/04 18:59:02</span></span><br><span class="line"><span class="string">@Author  :   Li Ruilong</span></span><br><span class="line"><span class="string">@Version :   1.0</span></span><br><span class="line"><span class="string">@Contact :   1224965096@qq.com</span></span><br><span class="line"><span class="string">@Desc    :   Fetch学习Demo</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,jsonify,request,send_from_directory</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="comment"># configuration</span></span><br><span class="line">DEBUG = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/index&quot;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">default</span>():</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    @Time    :   2022/03/04 18:58:42</span></span><br><span class="line"><span class="string">    @Author  :   Li Ruilong</span></span><br><span class="line"><span class="string">    @Version :   1.0</span></span><br><span class="line"><span class="string">    @Desc    :   默认页面</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&lt;h1&gt;Fetch学习Demo&lt;h1/&gt;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/init&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">init</span>():</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    @Time    :   2022/03/04 19:41:40</span></span><br><span class="line"><span class="string">    @Author  :   Li Ruilong</span></span><br><span class="line"><span class="string">    @Version :   1.0</span></span><br><span class="line"><span class="string">    @Desc    :   get请求返回JSON</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    </span><br><span class="line">    data = [<span class="string">&quot;Ajax&quot;</span>,<span class="string">&quot;Fetch&quot;</span>,<span class="string">&quot;Promise&quot;</span>,<span class="string">&quot;Axios&quot;</span>]</span><br><span class="line">    <span class="keyword">return</span> jsonify(data)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/add&quot;</span>,methods=[<span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>():</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    @Time    :   2022/03/04 19:43:05</span></span><br><span class="line"><span class="string">    @Author  :   Li Ruilong</span></span><br><span class="line"><span class="string">    @Version :   1.0</span></span><br><span class="line"><span class="string">    @Desc    :   Post请求</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    data = request.json</span><br><span class="line">    <span class="built_in">print</span>(*data, sep=<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> jsonify(&#123;<span class="string">&quot;msg&quot;</span>:<span class="string">&quot;Post请求成功&quot;</span>,<span class="string">&quot;code&quot;</span>:<span class="string">&quot;0&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/download/&lt;filename&gt;&quot;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">download</span>(<span class="params">filename</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(filename)</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    @Time    :   2022/03/04 22:30:12</span></span><br><span class="line"><span class="string">    @Author  :   Li Ruilong</span></span><br><span class="line"><span class="string">    @Version :   1.0</span></span><br><span class="line"><span class="string">    @Desc    :   下载文件</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    directory = os.getcwd()  </span><br><span class="line">    <span class="built_in">print</span>(directory)</span><br><span class="line">    <span class="keyword">return</span> send_from_directory(directory, filename, as_attachment=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/upload&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;PUT&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">upload</span>():</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    @Time    :   2021/12/15 10:32:03</span></span><br><span class="line"><span class="string">    @Author  :   Li Ruilong</span></span><br><span class="line"><span class="string">    @Version :   1.0</span></span><br><span class="line"><span class="string">    @Desc    :   上传文件</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            f = request.files[<span class="string">&#x27;file&#x27;</span>]</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;上传的文件名:===&quot;</span>, f.filename)</span><br><span class="line">            basepath = os.path.dirname(__file__)  <span class="comment"># 当前文件所在路径</span></span><br><span class="line">            upload_path = os.path.join(basepath, <span class="string">&quot;\\&quot;</span>, <span class="built_in">str</span>(f.filename))  </span><br><span class="line">            f.save(upload_path)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;保存的文件路径：&quot;</span>+upload_path)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;上传文件失败&quot;</span>, e)</span><br><span class="line">    <span class="keyword">return</span> jsonify(&#123;<span class="string">&quot;msg&quot;</span>:<span class="string">&quot;上传文件OK&quot;</span>,<span class="string">&quot;code&quot;</span>:<span class="string">&quot;0&quot;</span>&#125;),<span class="number">200</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/stop/&lt;int:s&gt;&quot;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">stop</span>(<span class="params">s</span>):</span></span><br><span class="line">    sleep(s)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;OK&quot;</span>,<span class="number">200</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;127.0.0.1&#x27;</span>, port=<span class="number">37881</span>, debug=DEBUG)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><code>data.json文件</code></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="attr">&quot;site&quot;</span>: <span class="string">&quot;npr&quot;</span>,</span><br><span class="line">		<span class="attr">&quot;link&quot;</span>: <span class="string">&quot;http://www.npr.org/rss/rss.php?id=1001&quot;</span>,</span><br><span class="line">		<span class="attr">&quot;type&quot;</span>: <span class="string">&quot;rss&quot;</span></span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="attr">&quot;site&quot;</span>: <span class="string">&quot;npr&quot;</span>,</span><br><span class="line">		<span class="attr">&quot;link&quot;</span>: <span class="string">&quot;http://www.npr.org/rss/rss.php?id=1008&quot;</span>,</span><br><span class="line">		<span class="attr">&quot;type&quot;</span>: <span class="string">&quot;rss&quot;</span></span><br><span class="line">	&#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>准备工作做好以后，我们开始愉快的学习吧</p>
<p>一个基本的<code>fetch</code>请求设置起来很简单。看看下面的代码：</p>
<p>这是一个回调风格的请求，从服务器获取<code>JSON</code>数据。在<code>Node</code>环境的一个<code>Demo</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// -*- encoding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *@File    :   fetch.js</span></span><br><span class="line"><span class="comment"> *@Time    :   2022/03/04 22:04:04</span></span><br><span class="line"><span class="comment"> *@Author  :   Li Ruilong</span></span><br><span class="line"><span class="comment"> *@Version :   1.0</span></span><br><span class="line"><span class="comment"> *@Contact :   1224965096@qq.com</span></span><br><span class="line"><span class="comment"> *@Desc    :   Fetch学习</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> fetch = <span class="built_in">require</span>(<span class="string">&quot;node-fetch&quot;</span>);</span><br><span class="line"></span><br><span class="line">fetch(<span class="string">&#x27;http://127.0.0.1:37881/download/data.json&#x27;</span>)</span><br><span class="line">  .then(<span class="function"><span class="params">response</span> =&gt;</span> response.json())</span><br><span class="line">  .then(<span class="function"><span class="params">json</span> =&gt;</span> <span class="built_in">console</span>.log(json))</span><br><span class="line">  .catch(<span class="function"><span class="params">err</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;Request Failed&#x27;</span>, err)); </span><br></pre></td></tr></table></figure>
<p><code>fetch()</code>接收到的<code>response</code>是一个<code>Stream</code>对象，<code>response.json()</code>是一个异步操作，取出所有内容，并将其转为<code> JSON 对象</code>。</p>
<p>整理上看和<code>axios</code>类似，相同点都是基于<code>ES 6 </code>的<code>Promise</code>对象，在<code>Node</code>环境，都是基于<code>HTTP模块</code>实现，不同点，<code>axios</code>在浏览器中，是基于<code>XMLHttpRequests</code>来实现异步通信的,而<code>fetch</code>是一个新的<code>API</code>,是<code>XMLHttpRequest</code>的最新替代技术 ，下面是一个<code>axios</code>的例子.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> axios = <span class="built_in">require</span>(<span class="string">&#x27;axios&#x27;</span>).default;</span><br><span class="line"><span class="keyword">const</span> &#123; <span class="attr">v4</span>: uuidv4 &#125; = <span class="built_in">require</span>(<span class="string">&#x27;uuid&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> subscriptionKey = <span class="string">&quot;3c6588c7026b41a4**7f81551cb4a737&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> endpoint = <span class="string">&quot;https://api.translator.azure.cn/&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> location = <span class="string">&quot;chinanorth&quot;</span>;</span><br><span class="line"></span><br><span class="line">axios(&#123;</span><br><span class="line">    <span class="attr">baseURL</span>: endpoint,</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/translate&#x27;</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">    <span class="attr">headers</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;Ocp-Apim-Subscription-Key&#x27;</span>: subscriptionKey,</span><br><span class="line">        <span class="string">&#x27;Ocp-Apim-Subscription-Region&#x27;</span>: location,</span><br><span class="line">        <span class="string">&#x27;Content-type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;X-ClientTraceId&#x27;</span>: uuidv4().toString()</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">params</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;api-version&#x27;</span>: <span class="string">&#x27;3.0&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;from&#x27;</span>: <span class="string">&#x27;zh-Hans&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;to&#x27;</span>: [<span class="string">&#x27;zh-Hant&#x27;</span>, <span class="string">&#x27;en&#x27;</span>]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">data</span>: [&#123;</span><br><span class="line">        <span class="string">&#x27;text&#x27;</span>: <span class="string">&#x27;我徒然学会了抗拒热闹，却还来不及透悟真正的冷清。--------张大春&#x27;</span></span><br><span class="line">    &#125;],</span><br><span class="line">    <span class="attr">responseType</span>: <span class="string">&#x27;json&#x27;</span></span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">response</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">JSON</span>.stringify(response.data, <span class="literal">null</span>, <span class="number">4</span>));</span><br><span class="line">&#125;).catch(<span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(error);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><code>Promise </code>可以使用<code>await</code>语法改写，使得语义更清晰。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// -*- encoding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *@File    :   fetch.js</span></span><br><span class="line"><span class="comment"> *@Time    :   2022/03/04 22:04:04</span></span><br><span class="line"><span class="comment"> *@Author  :   Li Ruilong</span></span><br><span class="line"><span class="comment"> *@Version :   1.0</span></span><br><span class="line"><span class="comment"> *@Contact :   1224965096@qq.com</span></span><br><span class="line"><span class="comment"> *@Desc    :   Fetch学习</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fetch = <span class="built_in">require</span>(<span class="string">&quot;node-fetch&quot;</span>);</span><br><span class="line"></span><br><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> url = <span class="string">&#x27;http://127.0.0.1:37881/download/data.json&#x27;</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> response = <span class="keyword">await</span> fetch(url);</span><br><span class="line">        <span class="keyword">let</span> data =<span class="keyword">await</span> response.json();</span><br><span class="line">        <span class="built_in">console</span>.log(data);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;Oops, error&quot;</span>, e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><code>await</code>语句必须放在<code>try...catch</code>里面，这样才能<code>捕捉异步</code>操作中可能发生的<code>错误</code>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">=====</span><br><span class="line">PS D:\GolandProjects\code-master\demo&gt; node fetch</span><br><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    site: <span class="string">&#x27;npr&#x27;</span>,</span><br><span class="line">    link: <span class="string">&#x27;http://www.npr.org/rss/rss.php?id=1001&#x27;</span>,</span><br><span class="line">    <span class="built_in">type</span>: <span class="string">&#x27;rss&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    site: <span class="string">&#x27;npr&#x27;</span>,</span><br><span class="line">    link: <span class="string">&#x27;http://www.npr.org/rss/rss.php?id=1008&#x27;</span>,</span><br><span class="line">    <span class="built_in">type</span>: <span class="string">&#x27;rss&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br><span class="line">PS D:\GolandProjects\code-master\demo&gt; </span><br></pre></td></tr></table></figure>

<h2 id="Response-对象：处理-HTTP-回应"><a href="#Response-对象：处理-HTTP-回应" class="headerlink" title="Response 对象：处理 HTTP 回应"></a>Response 对象：处理 HTTP 回应</h2><p><code>fetch()</code>请求成功以后，得到的是一个<code>Response</code>对象。它对应服务器的<code> HTTP 回应</code>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> response = <span class="keyword">await</span> fetch(url);</span><br></pre></td></tr></table></figure>
<p><code>Response </code>包含de同步属性，对应 HTTP 回应的标头信息<code>(Headers)</code>，可以<code>立即读取</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// -*- encoding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *@File    :   fetch.js</span></span><br><span class="line"><span class="comment"> *@Time    :   2022/03/04 22:04:04</span></span><br><span class="line"><span class="comment"> *@Author  :   Li Ruilong</span></span><br><span class="line"><span class="comment"> *@Version :   1.0</span></span><br><span class="line"><span class="comment"> *@Contact :   1224965096@qq.com</span></span><br><span class="line"><span class="comment"> *@Desc    :   Fetch学习</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fetch = <span class="built_in">require</span>(<span class="string">&quot;node-fetch&quot;</span>);</span><br><span class="line"></span><br><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> url = <span class="string">&#x27;http://127.0.0.1:37881/init&#x27;</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> response = <span class="keyword">await</span> fetch(url);</span><br><span class="line">        <span class="comment">//同步属性，对应 HTTP 回应的标头信息(Headers)，可以立即读取</span></span><br><span class="line">        <span class="built_in">console</span>.log(response.ok);</span><br><span class="line">        <span class="built_in">console</span>.log(response.status); </span><br><span class="line">        <span class="built_in">console</span>.log(response.statusText);</span><br><span class="line">        <span class="built_in">console</span>.log(response.type);</span><br><span class="line">        <span class="built_in">console</span>.log(response.url);</span><br><span class="line">        <span class="built_in">console</span>.log(response.redirected)</span><br><span class="line">        <span class="comment">//Response 包含的数据通过 Stream 接口异步读取</span></span><br><span class="line">        <span class="keyword">let</span> data =<span class="keyword">await</span> response.json();</span><br><span class="line">        <span class="built_in">console</span>.log(data);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;Oops, error&quot;</span>, e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[Running] node <span class="string">&quot;d:\GolandProjects\code-master\demo\fetch.js&quot;</span></span><br><span class="line"><span class="literal">true</span></span><br><span class="line">200</span><br><span class="line">OK</span><br><span class="line">undefined</span><br><span class="line">http://127.0.0.1:37881/init</span><br><span class="line"><span class="literal">false</span></span><br><span class="line">[ <span class="string">&#x27;Ajax&#x27;</span>, <span class="string">&#x27;Fetch&#x27;</span>, <span class="string">&#x27;Promise&#x27;</span>, <span class="string">&#x27;Axios&#x27;</span> ]</span><br><span class="line"></span><br><span class="line">[Done] exited with code=0 <span class="keyword">in</span> 0.253 seconds</span><br></pre></td></tr></table></figure>
<p><code>response.ok</code>:属性返回一个布尔值，表示请求是否成功，true对应 HTTP 请求的状态码 200 到 299，false对应其他的状态码。</p>
<p><code>response.status</code>:属性返回一个数字，表示 HTTP 回应的状态码(例如200，表示成功请求)。</p>
<p><code>response.statusText</code>:属性返回一个字符串，表示 HTTP 回应的状态信息(例如请求成功以后，服务器返回”OK”)。</p>
<p><code>response.url</code>:属性返回请求的 URL。如果 URL 存在跳转，该属性返回的是最终 URL。</p>
<p><code>response.type</code>:属性返回请求的类型。可能的值如下：</p>
<h3 id="通过状态码判断请求是否成功"><a href="#通过状态码判断请求是否成功" class="headerlink" title="通过状态码判断请求是否成功"></a>通过状态码判断请求是否成功</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// -*- encoding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *@File    :   fetch.js</span></span><br><span class="line"><span class="comment"> *@Time    :   2022/03/04 22:04:04</span></span><br><span class="line"><span class="comment"> *@Author  :   Li Ruilong</span></span><br><span class="line"><span class="comment"> *@Version :   1.0</span></span><br><span class="line"><span class="comment"> *@Contact :   1224965096@qq.com</span></span><br><span class="line"><span class="comment"> *@Desc    :   Fetch学习</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fetch = <span class="built_in">require</span>(<span class="string">&quot;node-fetch&quot;</span>);</span><br><span class="line"></span><br><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> url = <span class="string">&#x27;http://127.0.0.1:37881/init&#x27;</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> response = <span class="keyword">await</span> fetch(url);</span><br><span class="line">        <span class="keyword">if</span> (response.status &gt;= <span class="number">200</span> &amp;&amp; response.status &lt; <span class="number">300</span>)&#123;</span><br><span class="line">            <span class="keyword">let</span> data = <span class="keyword">await</span> response.json();</span><br><span class="line">            <span class="built_in">console</span>.log(data);</span><br><span class="line">            <span class="keyword">return</span> data;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(response.statusText);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(response.statusText);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;Oops, error&quot;</span>, e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>
<p>我们把python的web服务接口里抛出一个异常，直接到了catch里面</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/init&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">init</span>():</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    @Time    :   2022/03/04 19:41:40</span></span><br><span class="line"><span class="string">    @Author  :   Li Ruilong</span></span><br><span class="line"><span class="string">    @Version :   1.0</span></span><br><span class="line"><span class="string">    @Desc    :   get请求返回JSON</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    </span><br><span class="line">    data = [<span class="string">&quot;Ajax&quot;</span>,<span class="string">&quot;Fetch&quot;</span>,<span class="string">&quot;Promise&quot;</span>,<span class="string">&quot;Axios&quot;</span>]</span><br><span class="line">    <span class="keyword">raise</span> Exception(<span class="string">&#x27;这是一个请求异常的模拟&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> jsonify(data)</span><br></pre></td></tr></table></figure>
<p>执行报错：内部服务器错误，即<code>500</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[Running] node <span class="string">&quot;d:\GolandProjects\code-master\demo\fetch.js&quot;</span></span><br><span class="line">Oops, error Error: INTERNAL SERVER ERROR</span><br><span class="line">    at d:\GolandProjects\code-master\demo\fetch.js:23:15</span><br><span class="line">    at processTicksAndRejections (internal/process/task_queues.js:93:5)</span><br></pre></td></tr></table></figure>
<p>修改接口返回状态码为<code>400</code></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/init&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">init</span>():</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    @Time    :   2022/03/04 19:41:40</span></span><br><span class="line"><span class="string">    @Author  :   Li Ruilong</span></span><br><span class="line"><span class="string">    @Version :   1.0</span></span><br><span class="line"><span class="string">    @Desc    :   get请求返回JSON</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    </span><br><span class="line">    data = [<span class="string">&quot;Ajax&quot;</span>,<span class="string">&quot;Fetch&quot;</span>,<span class="string">&quot;Promise&quot;</span>,<span class="string">&quot;Axios&quot;</span>]</span><br><span class="line">    <span class="keyword">return</span> jsonify(data),<span class="number">400</span></span><br></pre></td></tr></table></figure>
<p>报错误请求</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[Running] node <span class="string">&quot;d:\GolandProjects\code-master\demo\fetch.js&quot;</span></span><br><span class="line">INTERNAL SERVER ERROR</span><br><span class="line">Oops, error Error: INTERNAL SERVER ERROR</span><br><span class="line">    at d:\GolandProjects\code-master\demo\fetch.js:24:19</span><br><span class="line">    at processTicksAndRejections (internal/process/task_queues.js:93:5)</span><br><span class="line"></span><br><span class="line">[Done] exited with code=0 <span class="keyword">in</span> 0.261 seconds</span><br></pre></td></tr></table></figure>
<p>也可以直接通过<code>response.ok</code>来判断</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// -*- encoding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *@File    :   fetch.js</span></span><br><span class="line"><span class="comment"> *@Time    :   2022/03/04 22:04:04</span></span><br><span class="line"><span class="comment"> *@Author  :   Li Ruilong</span></span><br><span class="line"><span class="comment"> *@Version :   1.0</span></span><br><span class="line"><span class="comment"> *@Contact :   1224965096@qq.com</span></span><br><span class="line"><span class="comment"> *@Desc    :   Fetch学习</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fetch = <span class="built_in">require</span>(<span class="string">&quot;node-fetch&quot;</span>);</span><br><span class="line"></span><br><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> url = <span class="string">&#x27;http://127.0.0.1:37881/init&#x27;</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> response = <span class="keyword">await</span> fetch(url);</span><br><span class="line">        <span class="keyword">if</span> (response.ok)&#123;</span><br><span class="line">            <span class="keyword">let</span> data = <span class="keyword">await</span> response.json();</span><br><span class="line">            <span class="built_in">console</span>.log(data);</span><br><span class="line">            <span class="keyword">return</span> data;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(response.statusText);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(response.statusText);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;Oops, error&quot;</span>, e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>
<p>修改接口返回状态码为<code>404</code></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/init&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">init</span>():</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    @Time    :   2022/03/04 19:41:40</span></span><br><span class="line"><span class="string">    @Author  :   Li Ruilong</span></span><br><span class="line"><span class="string">    @Version :   1.0</span></span><br><span class="line"><span class="string">    @Desc    :   get请求返回JSON</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    </span><br><span class="line">    data = [<span class="string">&quot;Ajax&quot;</span>,<span class="string">&quot;Fetch&quot;</span>,<span class="string">&quot;Promise&quot;</span>,<span class="string">&quot;Axios&quot;</span>]</span><br><span class="line">    <span class="keyword">return</span> jsonify(data),<span class="number">404</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[Running] node <span class="string">&quot;d:\GolandProjects\code-master\demo\fetch.js&quot;</span></span><br><span class="line">NOT FOUND</span><br><span class="line">Oops, error Error: NOT FOUND</span><br><span class="line">    at d:\GolandProjects\code-master\demo\fetch.js:24:19</span><br><span class="line">    at processTicksAndRejections (internal/process/task_queues.js:93:5)</span><br><span class="line"></span><br><span class="line">[Done] exited with code=0 <span class="keyword">in</span> 0.257 seconds</span><br></pre></td></tr></table></figure>
<h3 id="Response-headers-属性"><a href="#Response-headers-属性" class="headerlink" title="Response.headers 属性"></a>Response.headers 属性</h3><p><code>Response </code>对象还有一个<code>Response.headers</code>属性，指向一个<code>Headers</code>对象，对应 <code>HTTP </code>回应的所有标头。</p>
<p><code>Headers </code>对象可以使用<code>for...of</code>循环进行遍历。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// -*- encoding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *@File    :   fetch.js</span></span><br><span class="line"><span class="comment"> *@Time    :   2022/03/04 22:04:04</span></span><br><span class="line"><span class="comment"> *@Author  :   Li Ruilong</span></span><br><span class="line"><span class="comment"> *@Version :   1.0</span></span><br><span class="line"><span class="comment"> *@Contact :   1224965096@qq.com</span></span><br><span class="line"><span class="comment"> *@Desc    :   Fetch学习</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fetch = <span class="built_in">require</span>(<span class="string">&quot;node-fetch&quot;</span>);</span><br><span class="line"></span><br><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> url = <span class="string">&#x27;http://127.0.0.1:37881/init&#x27;</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> response = <span class="keyword">await</span> fetch(url);</span><br><span class="line">        <span class="keyword">if</span> (response.ok)&#123;</span><br><span class="line">            <span class="keyword">let</span> data = <span class="keyword">await</span> response.json();</span><br><span class="line">            <span class="built_in">console</span>.log(data);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">let</span> [key, value] <span class="keyword">of</span> response.headers) &#123; </span><br><span class="line">                <span class="comment">//console.log(key+&quot;:&quot;+ value);  </span></span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;key&#125;</span> : <span class="subst">$&#123;value&#125;</span>`</span>);  </span><br><span class="line">              &#125;</span><br><span class="line">            <span class="keyword">return</span> data;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(response.statusText);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(response.statusText);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;Oops, error&quot;</span>, e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[Running] node <span class="string">&quot;d:\GolandProjects\code-master\demo\fetch.js&quot;</span></span><br><span class="line">[ <span class="string">&#x27;Ajax&#x27;</span>, <span class="string">&#x27;Fetch&#x27;</span>, <span class="string">&#x27;Promise&#x27;</span>, <span class="string">&#x27;Axios&#x27;</span> ]</span><br><span class="line">content-length : 51</span><br><span class="line">content-type : application/json</span><br><span class="line">date : Sat, 05 Mar 2022 15:14:47 GMT</span><br><span class="line">server : Werkzeug/2.0.2 Python/3.9.0</span><br><span class="line"></span><br><span class="line">[Done] exited with code=0 <span class="keyword">in</span> 0.26 seconds</span><br></pre></td></tr></table></figure>
<p><code>Headers </code>对象提供了以下方法，用来操作标头。HTTP 回应来说，修改标头意义不大</p>
<ul>
<li><code>Headers.get()</code>：根据指定的键名，返回键值。</li>
<li><code>Headers.has()</code>： 返回一个布尔值，表示是否包含某个标头。</li>
<li><code>Headers.set()</code>：将指定的键名设置为新的键值，如果该键名不存在则会添加。</li>
<li><code>Headers.append()</code>：添加标头。</li>
<li><code>Headers.delete()</code>：删除标头。</li>
<li><code>Headers.keys()</code>：返回一个遍历器，可以依次遍历所有键名。</li>
<li><code>Headers.values()</code>：返回一个遍历器，可以依次遍历所有键值。</li>
<li><code>Headers.entries()</code>：返回一个遍历器，可以依次遍历所有键值对([key, value])。</li>
<li><code>Headers.forEach()</code>：依次遍历标头，每个标头都会执行一次参数函数。</li>
</ul>
<h3 id="读取内容的方法"><a href="#读取内容的方法" class="headerlink" title="读取内容的方法"></a>读取内容的方法</h3><p><code>Response</code>对象根据服务器返回的不同类型的数据，提供了不同的读取方法。<code>读取方法都是异步的</code>，返回的都是 Promise <code>对象。必须等到</code>异步<code>操作结束，才能得到服务器返回的</code>完整数据&#96;。</p>
<ul>
<li><code>response.text()</code>：得到文本字符串。</li>
<li><code>response.json()</code>：得到 JSON 对象。</li>
<li><code>response.blob()</code>：得到二进制 Blob 对象。</li>
<li><code>response.formData()</code>：得到 FormData 表单对象。</li>
<li><code>response.arrayBuffer()</code>：得到二进制 ArrayBuffer 对象。</li>
</ul>
<p><strong><code>response.text()</code>可以用于获取文本数据，比如<code>HTML</code>文件。</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/index&quot;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">default</span>():</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    @Time    :   2022/03/04 18:58:42</span></span><br><span class="line"><span class="string">    @Author  :   Li Ruilong</span></span><br><span class="line"><span class="string">    @Version :   1.0</span></span><br><span class="line"><span class="string">    @Desc    :   默认页面</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&lt;h1&gt;Fetch学习Demo&lt;h1/&gt;&quot;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// -*- encoding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *@File    :   fetch.js</span></span><br><span class="line"><span class="comment"> *@Time    :   2022/03/04 22:04:04</span></span><br><span class="line"><span class="comment"> *@Author  :   Li Ruilong</span></span><br><span class="line"><span class="comment"> *@Version :   1.0</span></span><br><span class="line"><span class="comment"> *@Contact :   1224965096@qq.com</span></span><br><span class="line"><span class="comment"> *@Desc    :   Fetch学习</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fetch = <span class="built_in">require</span>(<span class="string">&quot;node-fetch&quot;</span>);</span><br><span class="line"></span><br><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> url = <span class="string">&#x27;http://127.0.0.1:37881/&#x27;</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> response = <span class="keyword">await</span> fetch(url);</span><br><span class="line">        <span class="keyword">if</span> (response.ok)&#123;</span><br><span class="line">            <span class="keyword">let</span> data = <span class="keyword">await</span> response.text();</span><br><span class="line">            <span class="built_in">console</span>.log(data);</span><br><span class="line">            <span class="keyword">return</span> data;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(response.statusText);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(response.statusText);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;Oops, error&quot;</span>, e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>

<p><strong><code>response.json()  </code>主要用于获取服务器返回的<code> JSON</code> 数据</strong></p>
<p><strong><code>response.formData()</code>主要用在 Service Worker 里面，拦截用户提交的表单，修改某些数据以后，再提交给服务器。</strong></p>
<p><strong><code>response.blob()</code>用于获取二进制文件。</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// -*- encoding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *@File    :   fetch.js</span></span><br><span class="line"><span class="comment"> *@Time    :   2022/03/04 22:04:04</span></span><br><span class="line"><span class="comment"> *@Author  :   Li Ruilong</span></span><br><span class="line"><span class="comment"> *@Version :   1.0</span></span><br><span class="line"><span class="comment"> *@Contact :   1224965096@qq.com</span></span><br><span class="line"><span class="comment"> *@Desc    :   Fetch学习</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fetch = <span class="built_in">require</span>(<span class="string">&quot;node-fetch&quot;</span>);</span><br><span class="line"></span><br><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> url = <span class="string">&#x27;http://127.0.0.1:37881/download/data.json&#x27;</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> response = <span class="keyword">await</span> fetch(url);</span><br><span class="line">        <span class="keyword">if</span> (response.ok)&#123;</span><br><span class="line">            <span class="keyword">let</span> data = <span class="keyword">await</span> response.blob();</span><br><span class="line">            <span class="built_in">console</span>.log(data);</span><br><span class="line">            <span class="keyword">return</span> data;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(response.statusText);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(response.statusText);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;Oops, error&quot;</span>, e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[Running] node <span class="string">&quot;d:\GolandProjects\code-master\demo\fetch.js&quot;</span></span><br><span class="line">Blob &#123;</span><br><span class="line">  [Symbol(<span class="built_in">type</span>)]: <span class="string">&#x27;application/json&#x27;</span>,</span><br><span class="line">  [Symbol(buffer)]: &lt;Buffer 5b 0a 09 7b 0a 09 09 22 73 69 74 65 22 3a 20 22 6e 70 72 22 2c 0a 09 09 22 6c 69 6e 6b 22 3a 20 22 68 74 74 70 3a 2f 2f 77 77 77 2e 6e 70 72 2e 6f 72 ... 141 more bytes&gt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[Done] exited with code=0 <span class="keyword">in</span> 0.847 seconds</span><br></pre></td></tr></table></figure>
<p>response.arrayBuffer()主要用于获取流媒体文件。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> audioCtx = <span class="keyword">new</span> <span class="built_in">window</span>.AudioContext();</span><br><span class="line"><span class="keyword">const</span> source = audioCtx.createBufferSource();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> response = <span class="keyword">await</span> fetch(<span class="string">&#x27;song.ogg&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> buffer = <span class="keyword">await</span> response.arrayBuffer();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> decodeData = <span class="keyword">await</span> audioCtx.decodeAudioData(buffer);</span><br><span class="line">source.buffer = buffer;</span><br><span class="line">source.connect(audioCtx.destination);</span><br><span class="line">source.loop = <span class="literal">true</span>;</span><br></pre></td></tr></table></figure>
<h3 id="Response-clone"><a href="#Response-clone" class="headerlink" title="Response.clone()"></a>Response.clone()</h3><p><code>Stream 对象</code>只能读取一次，读取完就没了。这意味着，前一节的五个读取方法，只能使用一个，否则会报错。</p>
<p><code>Response </code>对象提供<code>Response.clone()</code>方法，创建<code>Response对象的副本</code>，实现多次读取。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// -*- encoding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *@File    :   fetch.js</span></span><br><span class="line"><span class="comment"> *@Time    :   2022/03/04 22:04:04</span></span><br><span class="line"><span class="comment"> *@Author  :   Li Ruilong</span></span><br><span class="line"><span class="comment"> *@Version :   1.0</span></span><br><span class="line"><span class="comment"> *@Contact :   1224965096@qq.com</span></span><br><span class="line"><span class="comment"> *@Desc    :   Fetch学习</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fetch = <span class="built_in">require</span>(<span class="string">&quot;node-fetch&quot;</span>);</span><br><span class="line"></span><br><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> url = <span class="string">&#x27;http://127.0.0.1:37881/download/data.json&#x27;</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> response = <span class="keyword">await</span> fetch(url);</span><br><span class="line">        <span class="keyword">let</span> response1 = response.clone();</span><br><span class="line">        <span class="keyword">if</span> (response.ok)&#123;</span><br><span class="line">            <span class="keyword">let</span> data = <span class="keyword">await</span> response.json();</span><br><span class="line">            <span class="keyword">let</span> data1 = <span class="keyword">await</span> response1.json()</span><br><span class="line">            <span class="built_in">console</span>.log(data1);</span><br><span class="line">            <span class="keyword">return</span> data;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(response.statusText);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(response.statusText);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;Oops, error&quot;</span>, e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[Running] node <span class="string">&quot;d:\GolandProjects\code-master\demo\fetch.js&quot;</span></span><br><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    site: <span class="string">&#x27;npr&#x27;</span>,</span><br><span class="line">    link: <span class="string">&#x27;http://www.npr.org/rss/rss.php?id=1001&#x27;</span>,</span><br><span class="line">    <span class="built_in">type</span>: <span class="string">&#x27;rss&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    site: <span class="string">&#x27;npr&#x27;</span>,</span><br><span class="line">    link: <span class="string">&#x27;http://www.npr.org/rss/rss.php?id=1008&#x27;</span>,</span><br><span class="line">    <span class="built_in">type</span>: <span class="string">&#x27;rss&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">[Done] exited with code=0 <span class="keyword">in</span> 0.25 seconds</span><br></pre></td></tr></table></figure>
<p>Response 对象还有一个<code>Response.redirect()</code>方法，用于将 Response 结果重定向到指定的 URL。该方法一般只用在 Service Worker 里面</p>
<h3 id="Response-body-属性"><a href="#Response-body-属性" class="headerlink" title="Response.body 属性"></a>Response.body 属性</h3><p><code>Response.body</code>属性是 Response 对象暴露出的底层接口，返回一个 <code>ReadableStream </code>对象，供用户操作。</p>
<p>它可以用来分块读取内容，应用之一就是显示下载的进度。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// -*- encoding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *@File    :   fetch.js</span></span><br><span class="line"><span class="comment"> *@Time    :   2022/03/04 22:04:04</span></span><br><span class="line"><span class="comment"> *@Author  :   Li Ruilong</span></span><br><span class="line"><span class="comment"> *@Version :   1.0</span></span><br><span class="line"><span class="comment"> *@Contact :   1224965096@qq.com</span></span><br><span class="line"><span class="comment"> *@Desc    :   Fetch学习</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fetch = <span class="built_in">require</span>(<span class="string">&quot;node-fetch&quot;</span>);</span><br><span class="line"></span><br><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> url = <span class="string">&#x27;http://127.0.0.1:37881/download/data.json&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    fetch(url)</span><br><span class="line">        .then(<span class="function"><span class="params">response</span> =&gt;</span> response.body)</span><br><span class="line">        .then(<span class="function"><span class="params">res</span> =&gt;</span> res.on(<span class="string">&#x27;readable&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> chunk;</span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">null</span> !== (chunk = res.read())) &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(chunk.toString());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;))</span><br><span class="line">        .catch(<span class="function"><span class="params">err</span> =&gt;</span> <span class="built_in">console</span>.log(err));</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>
<h2 id="第二个参数init：定制-HTTP-请求"><a href="#第二个参数init：定制-HTTP-请求" class="headerlink" title="第二个参数init：定制 HTTP 请求"></a>第二个参数init：定制 HTTP 请求</h2><p><code>fetch()</code>的第一个参数是<code> URL</code>，还可以接受<code>第二个参数</code>，作为<code>配置对象</code>，定制发出的<code>HTTP 请求</code>。</p>
<p><code>HTTP </code>请求的方法、标头、数据体都在这个对象里面设置</p>
<h3 id="Post请求传递JSON"><a href="#Post请求传递JSON" class="headerlink" title="Post请求传递JSON"></a>Post请求传递JSON</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/add&quot;</span>,methods=[<span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>():</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    @Time    :   2022/03/04 19:43:05</span></span><br><span class="line"><span class="string">    @Author  :   Li Ruilong</span></span><br><span class="line"><span class="string">    @Version :   1.0</span></span><br><span class="line"><span class="string">    @Desc    :   Post请求</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    data = request.json</span><br><span class="line">    <span class="built_in">print</span>(*data, sep=<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> jsonify(&#123;<span class="string">&quot;msg&quot;</span>:<span class="string">&quot;Post请求成功&quot;</span>,<span class="string">&quot;code&quot;</span>:<span class="string">&quot;0&quot;</span>&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// -*- encoding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *@File    :   fetch.js</span></span><br><span class="line"><span class="comment"> *@Time    :   2022/03/04 22:04:04</span></span><br><span class="line"><span class="comment"> *@Author  :   Li Ruilong</span></span><br><span class="line"><span class="comment"> *@Version :   1.0</span></span><br><span class="line"><span class="comment"> *@Contact :   1224965096@qq.com</span></span><br><span class="line"><span class="comment"> *@Desc    :   Fetch学习</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fetch = <span class="built_in">require</span>(<span class="string">&quot;node-fetch&quot;</span>);</span><br><span class="line"></span><br><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> url = <span class="string">&#x27;http://127.0.0.1:37881/add&#x27;</span>;</span><br><span class="line">    <span class="keyword">const</span> body =  &#123; <span class="attr">name</span>:  <span class="string">&#x27;John&#x27;</span>, <span class="attr">surname</span>:  <span class="string">&#x27;Smith&#x27;</span>  &#125;;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> response = <span class="keyword">await</span> fetch(url,&#123;</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">            <span class="attr">body</span>: <span class="built_in">JSON</span>.stringify(body),</span><br><span class="line">            <span class="attr">headers</span>: &#123;<span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json;charset=utf-8&#x27;</span>&#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">if</span> (response.ok)&#123;</span><br><span class="line">            <span class="keyword">const</span> data = <span class="keyword">await</span> response.json();</span><br><span class="line">            <span class="built_in">console</span>.log(data);</span><br><span class="line">            <span class="keyword">return</span> data;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(response.statusText);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(response.statusText);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;Oops, error&quot;</span>, e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">name</span><br><span class="line">surname</span><br><span class="line">127.0.0.1 - - [06/Mar/2022 02:27:42] <span class="string">&quot;POST /add HTTP/1.1&quot;</span> 200 -</span><br><span class="line">========</span><br><span class="line">[Running] node <span class="string">&quot;d:\GolandProjects\code-master\demo\fetch.js&quot;</span></span><br><span class="line">&#123; code: <span class="string">&#x27;0&#x27;</span>, msg: <span class="string">&#x27;Post请求成功&#x27;</span> &#125;</span><br><span class="line"></span><br><span class="line">[Done] exited with code=0 <span class="keyword">in</span> 0.293 seconds</span><br></pre></td></tr></table></figure>

<h3 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/upload&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;PUT&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">upload</span>():</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    @Time    :   2021/12/15 10:32:03</span></span><br><span class="line"><span class="string">    @Author  :   Li Ruilong</span></span><br><span class="line"><span class="string">    @Version :   1.0</span></span><br><span class="line"><span class="string">    @Desc    :   上传文件</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            f = request.files[<span class="string">&#x27;file&#x27;</span>]</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;上传的文件名:===&quot;</span>, f.filename)</span><br><span class="line">            basepath = os.path.dirname(__file__)  <span class="comment"># 当前文件所在路径</span></span><br><span class="line">            upload_path = os.path.join(basepath, <span class="string">&quot;\\&quot;</span>, <span class="built_in">str</span>(f.filename))  </span><br><span class="line">            f.save(upload_path)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;保存的文件路径：&quot;</span>+upload_path)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;上传文件失败&quot;</span>, e)</span><br><span class="line">    <span class="keyword">return</span> jsonify(&#123;<span class="string">&quot;msg&quot;</span>:<span class="string">&quot;上传文件OK&quot;</span>,<span class="string">&quot;code&quot;</span>:<span class="string">&quot;0&quot;</span>&#125;),<span class="number">200</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// -*- encoding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *@File    :   fetch.js</span></span><br><span class="line"><span class="comment"> *@Time    :   2022/03/04 22:04:04</span></span><br><span class="line"><span class="comment"> *@Author  :   Li Ruilong</span></span><br><span class="line"><span class="comment"> *@Version :   1.0</span></span><br><span class="line"><span class="comment"> *@Contact :   1224965096@qq.com</span></span><br><span class="line"><span class="comment"> *@Desc    :   Fetch学习</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"> <span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"> <span class="keyword">const</span> fetch = <span class="built_in">require</span>(<span class="string">&#x27;node-fetch&#x27;</span>);</span><br><span class="line"> <span class="keyword">const</span> FormData = <span class="built_in">require</span>(<span class="string">&#x27;form-data&#x27;</span>);</span><br><span class="line"> <span class="keyword">let</span> fileStream = fs.readFileSync(<span class="string">&quot;./data.json&quot;</span>);<span class="comment">//读取文件</span></span><br><span class="line"> <span class="keyword">let</span> formdata = <span class="keyword">new</span> FormData();</span><br><span class="line"> <span class="keyword">const</span> mimetype = <span class="string">&#x27;text/plain&#x27;</span></span><br><span class="line"> formdata.append(<span class="string">&quot;file&quot;</span>, fileStream, &#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;./data.json&quot;</span>,<span class="comment">//上传的文件名</span></span><br><span class="line">    <span class="attr">contentType</span>: mimetype,<span class="comment">//文件类型标识</span></span><br><span class="line">&#125;);</span><br><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> url = <span class="string">&#x27;http://127.0.0.1:37881/upload&#x27;</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> response = <span class="keyword">await</span> fetch(url,&#123;</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">            <span class="attr">body</span>: formdata ,</span><br><span class="line">            <span class="attr">headers</span>: formdata.getHeaders()</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">if</span> (response.ok)&#123;</span><br><span class="line">            <span class="keyword">const</span> data = <span class="keyword">await</span> response.json();</span><br><span class="line">            <span class="built_in">console</span>.log(data);</span><br><span class="line">            <span class="keyword">return</span> data;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(response.statusText);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(response.statusText);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;Oops, error&quot;</span>, e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">上传的文件名:=== data.json</span><br><span class="line">保存的文件路径：d:\data.json</span><br><span class="line">127.0.0.1 - - [06/Mar/2022 01:37:51] <span class="string">&quot;POST /upload HTTP/1.1&quot;</span> 200 -</span><br><span class="line">============</span><br><span class="line">[Running] node <span class="string">&quot;d:\GolandProjects\code-master\demo\fetch.js&quot;</span></span><br><span class="line">&#123; code: <span class="string">&#x27;0&#x27;</span>, msg: <span class="string">&#x27;上传文件OK&#x27;</span> &#125;</span><br></pre></td></tr></table></figure>

<h2 id="fetch-配置对象的完整-API"><a href="#fetch-配置对象的完整-API" class="headerlink" title="fetch()配置对象的完整 API"></a>fetch()配置对象的完整 API</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> response = fetch(url, &#123;</span><br><span class="line">  <span class="attr">method</span>: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">  <span class="attr">headers</span>: &#123;</span><br><span class="line">    <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;text/plain;charset=UTF-8&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">body</span>: <span class="literal">undefined</span>,</span><br><span class="line">  <span class="attr">referrer</span>: <span class="string">&quot;about:client&quot;</span>, <span class="comment">//referrer属性用于设定fetch()请求的referer标头。</span></span><br><span class="line">  <span class="attr">referrerPolicy</span>: <span class="string">&quot;no-referrer-when-downgrade&quot;</span>,  <span class="comment">//referrerPolicy属性用于设定Referer标头的规则</span></span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;cors&quot;</span>,  <span class="comment">// mode属性指定请求的模式</span></span><br><span class="line">  <span class="attr">credentials</span>: <span class="string">&quot;same-origin&quot;</span>,  <span class="comment">//credentials属性指定是否发送 Cookie。</span></span><br><span class="line">  <span class="attr">cache</span>: <span class="string">&quot;default&quot;</span>, <span class="comment">//cache属性指定如何处理缓存</span></span><br><span class="line">  <span class="attr">redirect</span>: <span class="string">&quot;follow&quot;</span>, <span class="comment">//redirect属性指定 HTTP 跳转的处理方法</span></span><br><span class="line">  <span class="attr">integrity</span>: <span class="string">&quot;&quot;</span>, <span class="comment">//integrity属性指定一个哈希值，用于检查 HTTP 回应传回的数据是否等于这个预先设定的哈希值。</span></span><br><span class="line">  <span class="attr">keepalive</span>: <span class="literal">false</span>, <span class="comment">/// keepalive属性用于页面卸载时，告诉浏览器在后台保持连接，继续发送数据。</span></span><br><span class="line">  <span class="attr">signal</span>: <span class="literal">undefined</span> <span class="comment">//signal属性指定一个 AbortSignal 实例，用于取消fetch()请求</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="取消fetch-请求"><a href="#取消fetch-请求" class="headerlink" title="取消fetch()请求"></a>取消fetch()请求</h2><p><code>fetch()</code>请求发送以后，如果中途想要取消，需要使用<code>AbortController</code>对象。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/stop/&lt;int:s&gt;&quot;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">stop</span>(<span class="params">s</span>):</span></span><br><span class="line">    sleep(s)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;OK&quot;</span>,<span class="number">200</span></span><br></pre></td></tr></table></figure>
<p>请求进去<code>睡眠10s</code>,在<code>5s</code>的时候<code>终止请求</code>,新建<code>AbortController</code>实例，然后发送<code>fetch()</code>请求，配置对象的<code>signal</code>属性必须指定接收<code>AbortController</code>实例发送的信号<code>controller.signal</code>。</p>
<p><code>controller.abort()</code>方法用于发出取消信号。这时会触发<code>abort事件</code>，这个事件可以监听，也可以通过<code>controller.signal.aborted</code>属性判断取消信号是否已经发出</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// -*- encoding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *@File    :   fetch.js</span></span><br><span class="line"><span class="comment"> *@Time    :   2022/03/04 22:04:04</span></span><br><span class="line"><span class="comment"> *@Author  :   Li Ruilong</span></span><br><span class="line"><span class="comment"> *@Version :   1.0</span></span><br><span class="line"><span class="comment"> *@Contact :   1224965096@qq.com</span></span><br><span class="line"><span class="comment"> *@Desc    :   Fetch学习</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"> <span class="keyword">const</span> fetch = <span class="built_in">require</span>(<span class="string">&#x27;node-fetch&#x27;</span>);</span><br><span class="line">  <span class="comment">//npm  install abort-controller</span></span><br><span class="line"> <span class="keyword">const</span> AbortController = globalThis.AbortController ||  <span class="built_in">require</span>(<span class="string">&#x27;abort-controller&#x27;</span>)</span><br><span class="line"></span><br><span class="line"> <span class="keyword">const</span> controller = <span class="keyword">new</span> AbortController();</span><br><span class="line"> <span class="keyword">const</span> timeout = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">     controller.abort();</span><br><span class="line"> &#125;, <span class="number">5000</span>);</span><br><span class="line"> </span><br><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> url = <span class="string">&#x27;http://127.0.0.1:37881/stop/10&#x27;</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> response = <span class="keyword">await</span> fetch(url, &#123;<span class="attr">signal</span>: controller.signal&#125;);</span><br><span class="line">        <span class="keyword">const</span> data = <span class="keyword">await</span> response.text();</span><br><span class="line">        <span class="built_in">console</span>.log(data)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&#x27;request was aborted&#x27;</span>,error);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="built_in">clearTimeout</span>(timeout);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[Running] node <span class="string">&quot;d:\GolandProjects\code-master\demo\fetch.js&quot;</span></span><br><span class="line">request was aborted AbortError: The user aborted a request.</span><br></pre></td></tr></table></figure>

<p><strong>Node 环境</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">PS D:\GolandProjects\code-master\demo&gt; node -v</span><br><span class="line">v12.13.1</span><br><span class="line">PS D:\GolandProjects\code-master\demo&gt; npm -v</span><br><span class="line">6.12.1</span><br><span class="line">PS D:\GolandProjects\code-master\demo&gt; npm init -y </span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;demo&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;main&quot;</span>: <span class="string">&quot;fetch.js&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;dependencies&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;abort-controller&quot;</span>: <span class="string">&quot;^3.0.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;form-data&quot;</span>: <span class="string">&quot;^4.0.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;node-fetch&quot;</span>: <span class="string">&quot;^2.6.7&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;devDependencies&quot;</span>: &#123;&#125;,</span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;test&quot;</span>: <span class="string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;keywords&quot;</span>: [],</span><br><span class="line">  <span class="attr">&quot;author&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;license&quot;</span>: <span class="string">&quot;ISC&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>python 环境</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">PS D:\GolandProjects\code-master&gt; python -V</span><br><span class="line">Python 3.9.0</span><br><span class="line">PS D:\GolandProjects\code-master&gt; pip -V</span><br><span class="line">pip 20.2.3 from d:\python\python310\lib\site-packages\pip (python 3.9)</span><br><span class="line">PS E:\docker&gt; flask --version</span><br><span class="line">Python 3.9.0</span><br><span class="line">Flask 2.0.2</span><br><span class="line">Werkzeug 2.0.2</span><br><span class="line">PS E:\docker&gt;</span><br></pre></td></tr></table></figure>
</div><div class="article-licensing box"><div class="licensing-title"><p>嗯,还在用Ajax嘛?Fetch了解一下呀!</p><p><a href="https://liruilongs.github.io/2022/03/04/web/嗯,还在用Ajax嘛-Fetch了解一下呀/">https://liruilongs.github.io/2022/03/04/web/嗯,还在用Ajax嘛-Fetch了解一下呀/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><a href="https://liruilongs.github.io"><p>山河已无恙</p></a></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2022-03-04</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2023-06-21</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a class="icon" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a><a class="icon" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="recommend-area"><div class="recommend-post"><span class="is-size-6 has-text-grey has-mr-7"># 推荐文章</span><br><span>  1.<a class="is-size-6" href="/2021/08/27/K8s/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/%E3%80%8AKubernetes%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-%E4%BB%8EDocker%E5%88%B0Kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A8%E6%8E%A5%E8%A7%A6%E3%80%8B%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" target="_blank">《Kubernetes权威指南:从Docker到Kubernetes实践全接触》读书笔记</a><br></span><span>  2.<a class="is-size-6" href="/2022/11/19/Git/%E5%85%B3%E4%BA%8E-Git-%E9%87%8D%E5%86%99%E5%8E%86%E5%8F%B2%E7%9A%84%E4%B8%80%E4%BA%9B%E7%AC%94%E8%AE%B0/" target="_blank">关于 Git 重写历史的一些笔记</a><br></span><span>  3.<a class="is-size-6" href="/2022/08/02/Git/%E5%85%B3%E4%BA%8EGit%E5%88%86%E6%94%AF%E5%8F%98%E5%9F%BA%E6%93%8D%E4%BD%9C%E7%9A%84%E4%B8%80%E4%BA%9B%E7%AC%94%E8%AE%B0/" target="_blank">关于Git分支变基操作的一些笔记</a><br></span><span>  4.<a class="is-size-6" href="/2022/07/26/Git/%E5%85%B3%E4%BA%8EGit%E5%88%86%E6%94%AF%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E7%9A%84%E4%B8%80%E4%BA%9B%E7%AC%94%E8%AE%B0/" target="_blank">关于Git分支基础知识的一些笔记</a><br></span><span>  5.<a class="is-size-6" href="/2022/08/02/Git/%E5%85%B3%E4%BA%8EGit%E5%88%86%E6%94%AF%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%9A%84%E4%B8%80%E4%BA%9B%E7%AC%94%E8%AE%B0/" target="_blank">关于Git分支工作流的一些笔记</a><br></span><span>  6.<a class="is-size-6" href="/2023/02/19/Git/%E5%85%B3%E4%BA%8EGit%E9%AB%98%E7%BA%A7%E5%90%88%E5%B9%B6%E7%9A%84%E4%B8%80%E4%BA%9B%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86/" target="_blank">关于Git分支高级合并的一些笔记整理</a><br></span></div></div><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/social-share.js/1.0.16/css/share.min.css"><div class="social-share"></div><script src="https://cdnjs.loli.net/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">喜欢这篇文章？打赏一下作者吧</h3><div class="buttons is-centered"><a class="button donate" data-type="alipay"><span class="icon is-small"><i class="fab fa-alipay"></i></span><span>支付宝</span><span class="qrcode"><img src="/img/alipay%EF%BF%A5.png" alt="支付宝"></span></a><a class="button donate" data-type="wechat"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>微信</span><span class="qrcode"><img src="/img/wechat%EF%BF%A5.png" alt="微信"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2022/03/08/Go/Go%E8%AF%AD%E8%A8%80%E5%AE%9E%E6%88%98%E4%B9%8B%E5%88%87%E7%89%87%E7%9A%84%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0%E5%92%8C%E5%9F%BA%E7%A1%80%E5%8A%9F%E8%83%BD/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">Go语言实战之切片的内部实现和基础功能</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2022/03/03/Ops_demo/CUP%E5%8D%A0%E7%94%A8%E7%8E%87%E7%88%86%E6%BB%A1-ESC%E9%81%AD%E9%81%87%E6%8C%96%E7%9F%BF%E5%A6%82%E4%BD%95%E6%8E%92%E6%9F%A5/"><span class="level-item">CPU占用率爆满,服务器遭遇挖矿如何排查</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--><div class="card"><div class="card-content"><div class="title is-5">评论</div><div id="comment-container"></div><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/gitalk/1.6.0/gitalk.css"><script> $.getScript('/js/gitalk.min.js', function () { 
            var gitalk = new Gitalk({
            language:'zh-CN',
            id: '7a03e66e650bd2e9ae440e9611c42b26',
            repo: 'blog_comment',
            owner: 'LIRUILONGS',
            clientID: '9fdc9739266d48d5f62e',
            clientSecret: 'c1cc33697d099a2197650ec9dadcb16bd4904655',
            admin: ["LIRUILONGS"],
            createIssueManually: true,
            distractionFreeMode: true,
            perPage: 10,
            pagerDirection: 'last',
            proxy: 'https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token',
            
            enableHotKey: true,
            isLocked: false
        })
        gitalk.render('comment-container')});</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><ul class="menu-list"><li><a class="is-flex is-mobile" href="#写在前面"><span class="mr-2">1.1</span><span>写在前面</span></a></li></ul><li><a class="is-flex is-mobile" href="#Fetch-接口"><span class="mr-2">2</span><span>Fetch 接口</span></a></li><li><a class="is-flex is-mobile" href="#使用-Fetch"><span class="mr-2">3</span><span>使用 Fetch</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#环境准备"><span class="mr-2">3.1</span><span>环境准备</span></a></li><li><a class="is-flex is-mobile" href="#Response-对象：处理-HTTP-回应"><span class="mr-2">3.2</span><span>Response 对象：处理 HTTP 回应</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#通过状态码判断请求是否成功"><span class="mr-2">3.2.1</span><span>通过状态码判断请求是否成功</span></a></li><li><a class="is-flex is-mobile" href="#Response-headers-属性"><span class="mr-2">3.2.2</span><span>Response.headers 属性</span></a></li><li><a class="is-flex is-mobile" href="#读取内容的方法"><span class="mr-2">3.2.3</span><span>读取内容的方法</span></a></li><li><a class="is-flex is-mobile" href="#Response-clone"><span class="mr-2">3.2.4</span><span>Response.clone()</span></a></li><li><a class="is-flex is-mobile" href="#Response-body-属性"><span class="mr-2">3.2.5</span><span>Response.body 属性</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#第二个参数init：定制-HTTP-请求"><span class="mr-2">3.3</span><span>第二个参数init：定制 HTTP 请求</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#Post请求传递JSON"><span class="mr-2">3.3.1</span><span>Post请求传递JSON</span></a></li><li><a class="is-flex is-mobile" href="#文件上传"><span class="mr-2">3.3.2</span><span>文件上传</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#fetch-配置对象的完整-API"><span class="mr-2">3.4</span><span>fetch()配置对象的完整 API</span></a></li><li><a class="is-flex is-mobile" href="#取消fetch-请求"><span class="mr-2">3.5</span><span>取消fetch()请求</span></a></li></ul></li></ul></div></div><style>.menu-list > li > a.is-active + .menu-list { display: block; }.menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="card widget" data-type="profile"><div class="card-content"><nav class=""><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7.jpg" alt="山河已无恙"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">山河已无恙</p><p class="is-size-6 is-block">爱自己，是终生浪漫的开始</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>中国·呼和浩特</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">321</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">103</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">154</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://mp.weixin.qq.com/s?__biz=MzkyNjIxNTYwMw==&amp;mid=2247496480&amp;idx=1&amp;sn=a9971fed3962ef2a1aeda1f0bda65f86&amp;chksm=c2380ffcf54f86eaba8daac6caca72a70f38e61a8d25dc2a66d3a17b87c02530e326dcaea14b#rd" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/LIRUILONGS"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="CSDN" href="https://liruilong.blog.csdn.net/"><i class="fa fa-code"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Email" href="mailto:1224965096@qq.com"><i class="fa fa-envelope"></i></a></div></div></div><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://liruilong.blog.csdn.net/?t=1&amp;type=blog" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">CSDN</span></span><span class="level-right"><span class="level-item tag">liruilong.blog.csdn.net</span></span></a></li><li><a class="level is-mobile" href="https://www.cnblogs.com/liruilong/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">博客园</span></span><span class="level-right"><span class="level-item tag">www.cnblogs.com</span></span></a></li><li><a class="level is-mobile" href="https://github.com/LIRUILONGS" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Githup</span></span><span class="level-right"><span class="level-item tag">github.com</span></span></a></li><li><a class="level is-mobile" href="https://gitee.com/liruilonger" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">码云</span></span><span class="level-right"><span class="level-item tag">gitee.com</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><h3 class="menu-label">最新评论</h3><span class="body_hot_comment">加载中，最新评论有1分钟缓存...</span></div></div><div class="card widget"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-12-18T20:39:30.000Z">2023-12-19</time></p><p class="title"><a href="/2023/12/19/%E5%BE%85%E5%8F%91%E5%B8%83/Stable-Diffusion-Windows%E9%83%A8%E7%BD%B2%E7%AE%80%E7%AD%94%E8%AE%A4%E7%9F%A5/">Stable Diffusion 简单认知 Windows 部署</a></p><p class="categories"><a href="/categories/AIGC/">AIGC</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-11-19T19:40:00.000Z">2023-11-20</time></p><p class="title"><a href="/2023/11/20/%E5%BE%85%E5%8F%91%E5%B8%83/Golang%20VScode%20%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/">Golang VScode 开发环境搭建</a></p><p class="categories"><a href="/categories/GO/">GO</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-11-15T12:44:37.000Z">2023-11-15</time></p><p class="title"><a href="/2023/11/15/%E5%BE%85%E5%8F%91%E5%B8%83/%E5%9F%BA%E4%BA%8E%20selenium%20%E5%AE%9E%E7%8E%B0%E7%BD%91%E7%AB%99%E5%9B%BE%E7%89%87%E9%87%87%E9%9B%86/">基于 selenium 实现网站图片采集</a></p><p class="categories"><a href="/categories/selenium/">selenium</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-11-13T20:29:38.000Z">2023-11-14</time></p><p class="title"><a href="/2023/11/14/%E5%BE%85%E5%8F%91%E5%B8%83/%E5%85%B3%E4%BA%8E-Kubernetes%E4%B8%ADAdmission-Controllers-%E7%9A%84%E4%B8%80%E4%BA%9B%E7%AC%94%E8%AE%B0/">关于 Kubernetes中Admission Controllers(准入控制器) 认知的一些笔记</a></p><p class="categories"><a href="/categories/Kubernetes/">Kubernetes</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-11-13T19:52:18.000Z">2023-11-14</time></p><p class="title"><a href="/2023/11/14/%E5%BE%85%E5%8F%91%E5%B8%83/K8s%20Pod%20%E5%88%9B%E5%BB%BA%E5%9F%8B%E7%82%B9%E5%A4%84%E7%90%86(Mutating%20%20Admission%20Webhook)/">K8s Pod 创建埋点处理(Mutating  Admission Webhook)</a></p><p class="categories"><a href="/categories/Kubernetes/">Kubernetes</a></p></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/categories/AIGC/"><span class="level-start"><span class="level-item">AIGC</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/AdaFace/"><span class="level-start"><span class="level-item">AdaFace</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Ajax/"><span class="level-start"><span class="level-item">Ajax</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Ansible/"><span class="level-start"><span class="level-item">Ansible</span></span><span class="level-end"><span class="level-item tag">23</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/AppCube/"><span class="level-start"><span class="level-item">AppCube</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/BPF/"><span class="level-start"><span class="level-item">BPF</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Bind9/"><span class="level-start"><span class="level-item">Bind9</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/CI-CD/"><span class="level-start"><span class="level-item">CI/CD</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/CSS/"><span class="level-start"><span class="level-item">CSS</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Ceph/"><span class="level-start"><span class="level-item">Ceph</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><a class="level is-mobile is-marginless" href="/categories/"><span class="level-start"><span class="level-item">查看全部&gt;&gt;</span></span></a></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/archives/2023/12/"><span class="level-start"><span class="level-item">十二月 2023</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2023/11/"><span class="level-start"><span class="level-item">十一月 2023</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2023/10/"><span class="level-start"><span class="level-item">十月 2023</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2023/09/"><span class="level-start"><span class="level-item">九月 2023</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2023/08/"><span class="level-start"><span class="level-item">八月 2023</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><a class="level is-mobile is-marginless" href="/archives/"><span class="level-start"><span class="level-item">查看全部&gt;&gt;</span></span></a></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/Kubernetes/"><span class="tag">Kubernetes</span><span class="tag is-grey-lightest">92</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Linux/"><span class="tag">Linux</span><span class="tag is-grey-lightest">34</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Ansible/"><span class="tag">Ansible</span><span class="tag is-grey-lightest">25</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Python/"><span class="tag">Python</span><span class="tag is-grey-lightest">14</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Ceph/"><span class="tag">Ceph</span><span class="tag is-grey-lightest">11</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Docker/"><span class="tag">Docker</span><span class="tag is-grey-lightest">8</span></a></div><div class="control"><a class="tags has-addons" href="/tags/JAVA/"><span class="tag">JAVA</span><span class="tag is-grey-lightest">8</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Git/"><span class="tag">Git</span><span class="tag is-grey-lightest">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Go/"><span class="tag">Go</span><span class="tag is-grey-lightest">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/OpenShift/"><span class="tag">OpenShift</span><span class="tag is-grey-lightest">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%A8%8B%E5%BA%8F%E4%BA%BA%E7%94%9F/"><span class="tag">程序人生</span><span class="tag is-grey-lightest">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/DNS/"><span class="tag">DNS</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/OKD/"><span class="tag">OKD</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/selenium/"><span class="tag">selenium</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%AE%B9%E5%99%A8/"><span class="tag">容器</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%BD%91%E7%BB%9C/"><span class="tag">网络</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CKA/"><span class="tag">CKA</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/GO/"><span class="tag">GO</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ISCSI/"><span class="tag">ISCSI</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/NFS/"><span class="tag">NFS</span><span class="tag is-grey-lightest">3</span></a></div></div><div class="field is-grouped is-grouped-multiline"><a class="tags has-addons" href="/tags/"><span class="tag">查看全部&gt;&gt;</span></a></div></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">订阅更新</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="订阅"></div></div></form></div></div></div><!--!--><div class="column-right-shadow is-hidden-widescreen is-sticky"></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.png" alt="山河已无恙" height="28"></a><p class="size-small"><span>&copy; 2024 山河已无恙</span>  Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank">Icarus</a> &amp; <a href="https://github.com/removeif/hexo-theme-amazing" target="_blank">Amazing</a> <br><span>© <a href="http://www.beian.miit.gov.cn/" target="_blank">备案中</a><br></span><span>© 版权说明：[本网站所有内容均收集于互联网或自己创作,<br />&nbsp;&nbsp;&nbsp;&nbsp;方便于网友与自己学习交流，如有侵权，请<a href="/message" target="_blank">留言</a>，立即处理]<br /></span><span><span id="statistic-times">loading...</span><script>function createTime(time) {
            var n = new Date(time);
            now.setTime(now.getTime() + 250),
                days = (now - n) / 1e3 / 60 / 60 / 24,
                dnum = Math.floor(days),
                hours = (now - n) / 1e3 / 60 / 60 - 24 * dnum,
                hnum = Math.floor(hours),
            1 == String(hnum).length && (hnum = "0" + hnum),
                minutes = (now - n) / 1e3 / 60 - 1440 * dnum - 60 * hnum,
                mnum = Math.floor(minutes),
            1 == String(mnum).length && (mnum = "0" + mnum),
                seconds = (now - n) / 1e3 - 86400 * dnum - 3600 * hnum - 60 * mnum,
                snum = Math.round(seconds),
            1 == String(snum).length && (snum = "0" + snum),
                document.getElementById("statistic-times").innerHTML = "❤️本站自 <strong>"+time.split(" ")[0].replace(/\//g,".")+"</strong> 已运行 <strong>" + dnum + "</strong> 天 <strong>" + hnum + "</strong> 小时 <strong>" + mnum + "</strong> 分 <strong>" + snum + "</strong> 秒！❤️";
        }var now = new Date();setInterval("createTime('2021/6/26 21:27:00')", 250,"");</script><br></span><div class="size-small"><span>❤️感谢 <strong><span id="busuanzi_value_site_uv">99+</span></strong> 小伙伴的 <strong><span id="busuanzi_value_site_pv">99+</span></strong> 次光临！❤️</span></div></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/removeif/hexo-theme-amazing"><i class="fab fa-github"></i></a></p></div><div class="sideMusic"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="/js/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script><meting-js style="width: auto;height: 2000px;" server="netease" type="playlist" id="2364053447" theme="#2980b9" loop="all" autoplay="false" order="list" storageName="aplayer-setting" lrctype="0" list-max-height="400px" fixed="true"></meting-js></div></div></div></div></footer><script src="https://cdnjs.loli.net/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script><script src="https://cdnjs.loli.net/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" async></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><!--!--><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><script src="https://cdnjs.loli.net/ajax/libs/lightgallery/1.6.8/js/lightgallery.min.js" defer></script><script src="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.7.0/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/KaTeX/0.11.1/katex.min.css"><script src="https://cdnjs.loli.net/ajax/libs/KaTeX/0.11.1/katex.min.js" defer></script><script src="https://cdnjs.loli.net/ajax/libs/KaTeX/0.11.1/contrib/auto-render.min.js" defer></script><script src="https://cdnjs.loli.net/ajax/libs/KaTeX/0.11.1/contrib/mhchem.js" defer></script><script>window.addEventListener("load", function() {
            document.querySelectorAll('[role="article"] > .content').forEach(function(element) {
                renderMathInElement(element);
            });
        });</script><script type="text/x-mathjax-config">MathJax.Hub.Config({
            'HTML-CSS': {
                matchFontHeight: false
            },
            SVG: {
                matchFontHeight: false
            },
            CommonHTML: {
                matchFontHeight: false
            },
            tex2jax: {
                inlineMath: [
                    ['$','$'],
                    ['\\(','\\)']
                ]
            }
        });</script><script src="https://cdnjs.loli.net/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><div id="outdated"><h6>Your browser is out-of-date!</h6><p>Update your browser to view this website correctly.&amp;npsb;<a id="btnUpdateBrowser" target="_blank" rel="noopener" href="http://outdatedbrowser.com/">Update my browser now </a></p><p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">×</a></p></div><script src="https://cdnjs.loli.net/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.js" defer></script><script>window.addEventListener("load", function () {
            outdatedBrowser({
                bgColor: '#f25648',
                color: '#ffffff',
                lowerThan: 'object-fit' // display on IE11 or below
            });
        });</script><!--!--><script src="/js/main.js" defer></script><script>$.getScript('/js/comment-issue-data.js',function(){loadIssueData('9fdc9739266d48d5f62e','c1cc33697d099a2197650ec9dadcb16bd4904655','LIRUILONGS','blog_comment',false);})</script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.js"></script><script type="text/javascript">var pjax = new Pjax({
            elements: "a",//代表点击链接就更新
            selectors: [  //代表要更新的节点
                ".section",
                "title"
            ],
            cache: true,
            cacheBust:false
        })

        function loadBusuanzi(){
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js", function () {});
        }

        function loadMathJax() { //加载mathjax
            $.getScript("//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML", function () {
                MathJax.Hub.Config({ tex2jax: { inlineMath: [['$', '$'], ['\(', '\)']] } });
                var math = document.getElementsByClassName("entry-content")[0];
                MathJax.Hub.Queue(["Typeset", MathJax.Hub, math]);
            });
        };

        // 开始 PJAX 执行的函数
        document.addEventListener('pjax:send', function () {
        });
        
        // PJAX 完成之后执行的函数，可以和上面的重载放在一起
        document.addEventListener('pjax:complete', function () {
            $(".section").css({opacity:1});
            if(true){
                $.getScript('/js/comment-issue-data.js',function(){loadIssueData('9fdc9739266d48d5f62e','c1cc33697d099a2197650ec9dadcb16bd4904655','LIRUILONGS','blog_comment',false);});
            }
            if(false){
                loadMathJax();
            }
            loadMainJs(jQuery, window.moment, window.ClipboardJS, window.IcarusThemeSettings);
            loadBackTop();
            loadBusuanzi();
            if(typeof loadBanner == 'function'){
                loadBanner();
            }
        });</script></body></html>