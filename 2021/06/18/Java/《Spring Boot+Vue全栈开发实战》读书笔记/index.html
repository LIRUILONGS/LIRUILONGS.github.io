<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="google-adsense-account" content="ca-pub-5805170532312625"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>《Spring Boot+Vue全栈开发实战》读书笔记 - 山河已无恙</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="山河已无恙"><meta name="msapplication-TileImage" content="https://cdn.jsdelivr.net/gh/removeif/removeif-demo@latest/img/favicon.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="山河已无恙"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta description="傍晚时分，你坐在屋檐下，看着天慢慢地黑下去，心里寂寞而凄凉，感到自己的生命被剥夺了。当时我是个年轻人，但我害怕这样生活下去，衰老下去。在我看来，这是比死亡更可怕的事。——–王小波"><meta property="og:type" content="blog"><meta property="og:title" content="山河已无恙"><meta property="og:url" content="https://mp.weixin.qq.com/s?__biz=MzkyNjIxNTYwMw==&amp;mid=2247496480&amp;idx=1&amp;sn=a9971fed3962ef2a1aeda1f0bda65f86&amp;chksm=c2380ffcf54f86eaba8daac6caca72a70f38e61a8d25dc2a66d3a17b87c02530e326dcaea14b#rd"><meta property="og:site_name" content="山河已无恙"><meta property="og:description" content="傍晚时分，你坐在屋檐下，看着天慢慢地黑下去，心里寂寞而凄凉，感到自己的生命被剥夺了。当时我是个年轻人，但我害怕这样生活下去，衰老下去。在我看来，这是比死亡更可怕的事。——–王小波"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://mp.weixin.qq.com/img/头像.jpg"><meta property="article:published_time" content="2021-06-17T16:00:00.000Z"><meta property="article:modified_time" content="2023-06-21T11:25:59.029Z"><meta property="article:author" content="LIRUILONGS"><meta property="article:tag" content="JAVA"><meta property="article:tag" content="SpringBoot"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/头像.jpg"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://liruilongs.github.io/2021/06/18/Java/%E3%80%8ASpring%20Boot+Vue%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98%E3%80%8B%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"},"headline":"山河已无恙","image":["https://img-blog.csdnimg.cn/20210603213601202.png","https://img-blog.csdnimg.cn/20210604122743210.png","https://img-blog.csdnimg.cn/20210605112418558.png"],"datePublished":"2021-06-17T16:00:00.000Z","dateModified":"2023-06-21T11:25:59.029Z","author":{"@type":"Person","name":"山河已无恙"},"description":"傍晚时分，你坐在屋檐下，看着天慢慢地黑下去，心里寂寞而凄凉，感到自己的生命被剥夺了。当时我是个年轻人，但我害怕这样生活下去，衰老下去。在我看来，这是比死亡更可怕的事。——–王小波"}</script><link rel="canonical" href="https://liruilongs.github.io/2021/06/18/Java/%E3%80%8ASpring%20Boot+Vue%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98%E3%80%8B%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"><link rel="alternate" href="/path/to/atom.xml" title="山河已无恙" type="application/atom+xml"><link rel="icon" href="https://cdn.jsdelivr.net/gh/removeif/removeif-demo@latest/img/favicon.png"><meta name="referrer" content="no-referrer-when-downgrade"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/5.12.0/css/all.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/highlight.js/9.12.0/styles/dracula.min.css"><link rel="stylesheet" href="https://fonts.loli.net/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/5.12.0/css/all.min.css"><link rel="stylesheet" href="https://fonts.loli.net/css?family=Ubuntu:400,600|Source+Code+Pro|Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Microsoft YaHei:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&amp;amp;subset=latin,latin-ext|Inconsolata|Itim|Lobster.css"><script src="https://cdnjs.loli.net/ajax/libs/jquery/3.3.1/jquery.min.js"></script><script src="/js/globalUtils.js"></script><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><script>var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?3f06f2b732a5b1034c989f74e28d0eea";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();</script><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.7.0/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.css"><script src="https://cdnjs.loli.net/ajax/libs/pace/1.0.2/pace.min.js"></script><link rel="stylesheet" href="/live2d/waifu.css"><script type="text/javascript" async src="/live2d/autoload.js"></script><meta name="generator" content="Hexo 5.4.2"></head><body class="is-3-column has-navbar-fixed-top"><nav class="navbar navbar-main is-fixed-top"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.png" alt="山河已无恙" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">首页</a><a class="navbar-item" href="/archives">归档</a><a class="navbar-item" href="/categories">分类</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/media">影音</a><a class="navbar-item" href="/album">相册</a><a class="navbar-item" href="/friend">友链</a><a class="navbar-item" href="/self-talking">生活小记</a><a class="navbar-item" href="/message">留言墙</a><a class="navbar-item" href="/about">关于</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Gitee" href="https://gitee.com/liruilonger"><i class="fab fa-git-square fa-1x"></i></a><a class="navbar-item" target="_blank" rel="noopener" title="GitHub" href="https://github.com/LIRUILONGS"><i class="fab fa-github fa-1x"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul fa-1x"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search fa-1x"></i></a><a class="navbar-item" id="night-nav" title="Night Mode" href="javascript:;"><i class="fas fa-moon fa-1x" id="night-icon"></i></a></div></div></div></nav><script type="text/javascript" src="/js/theme-setting.js"></script><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-9-widescreen"><!--!--><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2021-06-18  <a class="commentCountImg" href="/2021/06/18/Java/%E3%80%8ASpring%20Boot+Vue%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98%E3%80%8B%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/#comment-container"><span class="display-none-class">5ac3c0993f04578ec4b1e3d5243a2780</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="5ac3c0993f04578ec4b1e3d5243a2780">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>3 小时  <i class="fas fa-pencil-alt"> </i>23.0 k</span><span class="level-item" id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span>次访问</span></div></div><h1 class="title is-3 is-size-4-mobile">《Spring Boot+Vue全栈开发实战》读书笔记</h1><div class="content"><p>傍晚时分，你坐在屋檐下，看着天慢慢地黑下去，心里寂寞而凄凉，感到自己的<code>生命被剥夺</code>了。当时我是个年轻人，但我害怕这样生活下去，衰老下去。在我看来，这是<code>比死亡更可怕的事</code>。——–王小波</p>
<span id="more"></span>

<h2 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h2><ul>
<li>嗯，回家处理一些事，所以离职了，之前的公司用开源技术封装了一套自己的低代码平台，所以之前学的spring Boot之类的东西都忘了很多，蹭回家的闲暇时间复习下。</li>
<li>笔记整体以 <strong>Spring Boot+Vue全栈开发实战</strong>一书为方向，中间穿插一些其他视频(原书作者的视频)的知识点。</li>
<li>嗯，生活加油，这段时间好好休养，笔记在更新中..整装待发 ^ _ ^，加油生活…</li>
</ul>
<p><strong><font color="#009688">我年青时以为金钱至上,而今年事已迈,发现果真如此  —王尔德</font></strong></p>
<hr>
<h3 id="使用XML配置搭建SSM项目"><a href="#使用XML配置搭建SSM项目" class="headerlink" title="使用XML配置搭建SSM项目"></a>使用XML配置搭建SSM项目</h3><p> <a target="_blank" rel="noopener" href="https://github.com/LIRUILONGS/SSM-XML.git">代码详见：https://github.com/LIRUILONGS/SSM-XML.git</a></p>
<ul>
<li><code>新建一个maven工程，构造SSM目录结构</code><br><img src="https://img-blog.csdnimg.cn/20210601102803412.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3Nhbmhld3V5YW5n,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></li>
<li><code>添加依赖，构建配置文件</code><br><img src="https://img-blog.csdnimg.cn/20210601104651750.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3Nhbmhld3V5YW5n,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>SpringMVC是Spring的子容器，所以SpringMVC子容器可以访问Spring父容器，反之则不行。所以Spring的配置文件扫描除了Controller的bean，SpringMVC扫描controller的东西。<br><img src="https://img-blog.csdnimg.cn/20210601114813865.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3Nhbmhld3V5YW5n,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></li>
</ul>
<hr>
<h3 id="使用-Java配置类搭建SSM项目"><a href="#使用-Java配置类搭建SSM项目" class="headerlink" title="使用 Java配置类搭建SSM项目"></a>使用 Java配置类搭建SSM项目</h3><p><a target="_blank" rel="noopener" href="https://github.com/LIRUILONGS/SSM-java.git">代码详见：https://github.com/LIRUILONGS/SSM-java.git</a></p>
<ul>
<li><font color="#009688"><strong>@Configuration 注解表示这是一个配置类，在我们这里，这个配置的作用类似于 applicationContext.xml</strong></li>
<li><font color="#009688"><strong>@ComponentScan 注解表示配置包扫描，里边的属性和 xml 配置中的属性都是一一对应的，useDefaultFilters 表示使用默认的过滤器，然后又除去 Controller 注解，即在 Spring 容器中扫描除了 Controller 之外的其他所有 Bean 。</strong></li>
<li><font color="#009688"><strong>使用 Java 代码去代替 web.xml 文件，这里会用到 WebApplicationInitializer ，WebInit 的作用类似于 web.xml，这个类需要实现 WebApplicationInitializer 接口，并实现接口中的方法，当项目启动时，onStartup 方法会被自动执行，我们可以在这个方法中做一些项目初始化操作，例如加载 SpringMVC 容器，添加过滤器，添加 Listener、添加 Servlet 等。具体定义如下：</strong><br><img src="https://img-blog.csdnimg.cn/20210602140442899.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3Nhbmhld3V5YW5n,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></li>
</ul>
<blockquote>
<p><code>注意</code>：<br>由于我们在 WebInit 中只是添加了 SpringMVC 的配置，这样项目在启动时只会去加载 SpringMVC 容器，而不会去加载 Spring 容器，如果一定要加载 Spring 容器，需要我们修改 SpringMVC 的配置，在 SpringMVC 配置的包扫描中也去扫描 @Configuration 注解，进而加载 Spring 容器，还有一种方案可以解决这个问题，就是直接在项目中舍弃 Spring 配置，直接将所有配置放到 SpringMVC 的配置中来完成，这个在 SSM 整合时是没有问题的，在实际开发中，较多采用第二种方案，第二种方案，SpringMVC 的配置如下：</p>
</blockquote>
<ul>
<li><p><font color="#009688"><strong>静态资源过滤:重写 addResourceHandlers 方法，在这个方法中配置静态资源过滤，这里我将静态资源放在 resources 目录下，所以资源位置是 classpath:&#x2F; ，当然，资源也可以放在 webapp 目录下，此时只需要修改配置中的资源位置即可。如果采用 Java 来配置 SSM 环境，一般来说，可以不必使用 webapp 目录，除非要使用 JSP 做页面模板，否则可以忽略 webapp 目录。</strong></p>
</li>
<li><p><font color="#009688"><strong>视图解析器</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/jsp/&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.jsp&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(basePackages = &quot;org.javaboy&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringMVCConfig</span> <span class="keyword">extends</span> <span class="title">WebMvcConfigurationSupport</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configureViewResolvers</span><span class="params">(ViewResolverRegistry registry)</span> </span>&#123;</span><br><span class="line">        registry.jsp(<span class="string">&quot;/jsp/&quot;</span>, <span class="string">&quot;.jsp&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>路径映射:控制器的作用仅仅只是一个跳转，就像上面小节中的控制器，里边没有任何业务逻辑，像这种情况，可以不用定义方法，可以直接通过路径映射来实现页面访问。如果在 XML 中配置路径映射</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:view-controller</span> <span class="attr">path</span>=<span class="string">&quot;/hello&quot;</span> <span class="attr">view-name</span>=<span class="string">&quot;hello&quot;</span> <span class="attr">status-code</span>=<span class="string">&quot;200&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>这行配置，表示如果用户访问 &#x2F;hello 这个路径，则直接将名为 hello 的视图返回给用户，并且响应码为 200，这个配置就可以替代 Controller 中的方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(basePackages = &quot;org.javaboy&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringMVCConfig</span> <span class="keyword">extends</span> <span class="title">WebMvcConfigurationSupport</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> </span>&#123;</span><br><span class="line">        registry.addViewController(<span class="string">&quot;/hello3&quot;</span>).setViewName(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p><font color="#009688"><strong><code>JSON 配置</code>SpringMVC 可以接收JSON 参数，也可以返回 JSON 参数，这一切依赖于 HttpMessageConverter。</strong></font></p>
<blockquote>
<p>HttpMessageConverter 可以将一个 JSON 字符串转为 对象，也可以将一个对象转为 JSON 字符串，实际上它的底层还是依赖于具体的 JSON 库。<br>所有的 JSON 库要在 SpringMVC 中自动返回或者接收 JSON，都必须提供和自己相关的 HttpMessageConverter 。<br>SpringMVC 中，默认提供了 Jackson 和 gson 的 HttpMessageConverter ，分别是：MappingJackson2HttpMessageConverter 和 GsonHttpMessageConverter 。<br>正因为如此，我们在 SpringMVC 中，如果要使用 JSON ，对于 jackson 和 gson 我们只需要添加依赖，加完依赖就可以直接使用了。具体的配置是在 AllEncompassingFormHttpMessageConverter 类中完成的。<br>如果开发者使用了 fastjson，那么默认情况下，SpringMVC 并没有提供 fastjson 的 HttpMessageConverter ，这个需要我们自己提供，如果是在 XML 配置中，fastjson 除了加依赖，还要显式配置 HttpMessageConverter，如下：</p>
</blockquote>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:annotation-driven</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:message-converters</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.fastjson.support.spring.FastJsonHttpMessageConverter&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mvc:message-converters</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:annotation-driven</span>&gt;</span></span><br></pre></td></tr></table></figure>
<hr>
<h2 id="第1章Spring-Boot入门"><a href="#第1章Spring-Boot入门" class="headerlink" title="第1章Spring Boot入门"></a>第1章Spring Boot入门</h2><ul>
<li>提供一个快速的Spring项目搭建渠道</li>
<li>开箱即用,很少的Spring 配置就能运行一个Java EE项目。</li>
<li>提供了生产级的服务监控方案。</li>
<li>内嵌服务器,可以快速部署。</li>
<li>提供了一系列非功能性的通用配置。</li>
<li>纯Java配置,没有代码生成,也不需要XML配置。</li>
</ul>
<hr>
<h2 id="第2章-Spring-Boot基础配置"><a href="#第2章-Spring-Boot基础配置" class="headerlink" title="第2章 Spring Boot基础配置"></a>第2章 Spring Boot基础配置</h2><p>工程创建的三种方式：</p>
<ol>
<li>在线创建</li>
<li>通过 IDE 来创建(IntelliJ IDEA、STS)</li>
<li>通过改造一个普通的 Maven 工程来实现</li>
</ol>
<h3 id="2-1不使用spring-boot-starter-parent"><a href="#2-1不使用spring-boot-starter-parent" class="headerlink" title="2.1不使用spring-boot-starter-parent"></a>2.1不使用spring-boot-starter-parent</h3><p><code>spring-boot-starter-parent</code>主要提供了如下默认配置:</p>
<ul>
<li>Java版本默认使用1.8.编码格式</li>
<li>默认使用UTF-8.</li>
<li>提供Dependency Management进行项目依赖的版本管理。</li>
<li>默认的资源过滤与插件配置</li>
</ul>
<h3 id="2-2-Spring-BootApplication"><a href="#2-2-Spring-BootApplication" class="headerlink" title="2.2 @Spring BootApplication."></a>2.2 @Spring BootApplication.</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(ElementType.TYPE)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="meta">@SpringBootConfiguration</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="meta">@ComponentScan(excludeFilters = &#123; @Filter(type = FilterType.CUSTOM, classes = TypeExcludeFilter.class),</span></span><br><span class="line"><span class="meta">		@Filter(type = FilterType.CUSTOM, classes = AutoConfigurationExcludeFilter.class) &#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> SpringBootApplication &#123;</span><br><span class="line">...</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>@Spring BootApplication 是一个组合注解：</p>
<ul>
<li>@SpringBootConfiguration原来就是一个@Configuration,所以@Spring BootConfiguration的功能就是表明这是一个配置类。开发者可以在这个类中配置Bean。从这个角度来讲,这个类所扮演的角色有点类似于Spring中applicationContext.xml文件的角色。</li>
<li>第二个注解@EnableAutoConfiguration表示开启自动化配置。 Spring Boot中的自动化配置是非侵入式的,在任意时刻,开发者都可以使用自定义配置代替自动化配置中的某一个配置。</li>
<li>第三个注解@ComponentScan完成包扫描,也是Spring中的功能。由于@ComponentScan注解默认扫描的类都位于当前类所在包的下面,因此建议在实际项目开发中把项目启动类放在根包。</li>
</ul>
<h3 id="2-3定制banner"><a href="#2-3定制banner" class="headerlink" title="2.3定制banner"></a>2.3定制banner</h3><ul>
<li>Spring Boot项目在启动时会打印一个banne</li>
<li>定制网站：<a target="_blank" rel="noopener" href="http://patorjk.com/software/taag">http://patorjk.com/software/taag</a><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringBootDemoApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplicationBuilder builder = <span class="keyword">new</span> SpringApplicationBuilder(SpringBootDemoApplication.class);</span><br><span class="line">        builder.bannerMode(Banner.Mode.OFF).run(args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="2-4-Web容器配置"><a href="#2-4-Web容器配置" class="headerlink" title="2.4 Web容器配置"></a>2.4 Web容器配置</h3><h5 id="2-4-1-Tomcat配置"><a href="#2-4-1-Tomcat配置" class="headerlink" title="2.4.1 Tomcat配置"></a>2.4.1 Tomcat配置</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##配置了Web容器的端口号。</span></span><br><span class="line">server.port=8081  </span><br><span class="line"><span class="comment">##配置了当项目出错时跳转去的页面。</span></span><br><span class="line">server.error.path=/error  </span><br><span class="line"><span class="comment">##配置了session失效时间, 30m表示30分钟,如果不写单位,默认单位是秒。由于Tomcat中配置session过期时间以分钟为单位,因此这里单位如果是秒的话,该时间会被转换为一个不超过所配置秒数的最大分钟数,例如这里配置了119,默认单位为秒,则实际session过期时间为1分钟。</span></span><br><span class="line">server.servlet.session.timeout=30m</span><br><span class="line"><span class="comment">##表示项目名称,不配置时默认为/,如果配置了,就要在访问路径中加上配置的路径。</span></span><br><span class="line">server.servlet.context-path=/  </span><br><span class="line"><span class="comment">##表示配置Tomcat请求编码。</span></span><br><span class="line">server.tomcat.uri-encoding=utf-8</span><br><span class="line"><span class="comment">##表示Tomcat最大线程数。</span></span><br><span class="line">server.tomcat.threads.max=500  </span><br><span class="line"><span class="comment">##是一个存放Tomcat运行日志和临时文件的目录,若不配置,则默认使用系统的临时目录。</span></span><br><span class="line">server.tomcat.basedir=/home/sang/tmp  </span><br><span class="line"><span class="comment">##</span></span><br></pre></td></tr></table></figure>
<h6 id="HTTPS的配置："><a href="#HTTPS的配置：" class="headerlink" title="HTTPS的配置："></a>HTTPS的配置：</h6><p><img src="https://img-blog.csdnimg.cn/20210603092337271.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3Nhbmhld3V5YW5n,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 密匙文件</span></span><br><span class="line">server.ssl.key-store=sang.p12</span><br><span class="line"><span class="comment">## 密匙别名</span></span><br><span class="line">server.ssl.key-alias=tomcathttps</span><br><span class="line"><span class="comment">## 就是在cmd命令执行过程中输入的密码</span></span><br><span class="line">server.ssl.key-store-password=123456</span><br></pre></td></tr></table></figure>
<p>Spring Boot不支持同时在配置中启动<code>HTTP</code>和<code>HTTPS</code>,这个时候可以配置请求重定向,将HTTP请求重定向为HTTPS请求。配置方式如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TomcatConfig</span> </span>&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * @return</span></span><br><span class="line"><span class="comment">     * @Description : TODO 配置一个 TomcatServletWebServerFactory 的Bean，</span></span><br><span class="line"><span class="comment">     * @author Liruilong</span></span><br><span class="line"><span class="comment">     * @date  2021/6/3  11:47</span></span><br><span class="line"><span class="comment">     **/</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function">TomcatServletWebServerFactory <span class="title">tomcatServletWebServerFactory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        TomcatServletWebServerFactory factory = <span class="keyword">new</span> TomcatServletWebServerFactory()&#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">postProcessContext</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">                SecurityConstraint constraint = <span class="keyword">new</span> SecurityConstraint();</span><br><span class="line">                constraint.setUserConstraint(<span class="string">&quot;CONFIDENTIAL&quot;</span>);</span><br><span class="line">                SecurityCollection collection = <span class="keyword">new</span> SecurityCollection();</span><br><span class="line">                collection.addPattern(<span class="string">&quot;/*&quot;</span>);</span><br><span class="line">                constraint.addCollection(collection);</span><br><span class="line">                context.addConstraint(constraint);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        factory.addAdditionalTomcatConnectors(createTomcatConnector());</span><br><span class="line">        <span class="keyword">return</span> factory;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * @return</span></span><br><span class="line"><span class="comment">     * @Description</span></span><br><span class="line"><span class="comment">     * @author Liruilong</span></span><br><span class="line"><span class="comment">     * @date  2021/6/3  11:45</span></span><br><span class="line"><span class="comment">     **/</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Connector <span class="title">createTomcatConnector</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Connector connector = <span class="keyword">new</span> Connector(<span class="string">&quot;org.apache.coyote.http11.Http11NioProtocol&quot;</span>);</span><br><span class="line">        connector.setScheme(<span class="string">&quot;http&quot;</span>);</span><br><span class="line">        connector.setPort(<span class="number">8080</span>);</span><br><span class="line">        connector.setSecure(<span class="keyword">false</span>);</span><br><span class="line">        connector.setRedirectPort(<span class="number">8081</span>);</span><br><span class="line">        <span class="keyword">return</span> connector;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里首先配置一个TomcatServletWebServerFactory,然后添加一个Tomcat中的Connector (监听8080端口) ,并将请求转发到8081上去。</p>
<h5 id="2-4-2-Jetty配置"><a href="#2-4-2-Jetty配置" class="headerlink" title="2.4.2 Jetty配置"></a>2.4.2 Jetty配置</h5><p>除了Tomcat外,也可以在Spring Boot中嵌入Jetty,从spring-boot-starter-web中除去默认的Tomcat,然后加入Jetty的依赖即可配置方式如下:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                 <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                 <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">     <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jetty<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="2-4-3-Undertow配置"><a href="#2-4-3-Undertow配置" class="headerlink" title="2.4.3 Undertow配置"></a>2.4.3 Undertow配置</h5><p>Undertow是一个红帽公司开源的Java服务器,具有非常好的性能,在Spring Boot中也得到了很好的支持,配置方式与Jetty类似。</p>
<h3 id="2-5-Properties配置"><a href="#2-5-Properties配置" class="headerlink" title="2.5 Properties配置"></a>2.5 Properties配置</h3><p>Spring Boot项目中的·<code>application.properties</code>配置文件一共可以出现在如下4个位置:加载的优先级从1到4依次降低</p>
<blockquote>
<p><img src="https://img-blog.csdnimg.cn/20210603212527840.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3Nhbmhld3V5YW5n,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<ol>
<li>项目根目录下的config文件夹中。</li>
<li>项目根目录下。</li>
<li>classpath 下的config文件夹中。</li>
<li>classpath 下</li>
</ol>
</blockquote>
<p><code>application.yml</code>配置文件的优先级与上面一致默认情况下, 如果开发者不想使用<code>application.properties</code>作为配置文件名,也可以自己定义。例如,在resources目录下创建一个配置文件<code>app.properties</code>,然后将项目打成jar包,打包成功后,使用如下命令运行:<br><img src="https://img-blog.csdnimg.cn/20210603213601202.png" alt="在这里插入图片描述"></p>
<h3 id="2-6类型安全配置属性"><a href="#2-6类型安全配置属性" class="headerlink" title="2.6类型安全配置属性."></a>2.6类型安全配置属性.</h3><p>Spring提供了<code>@Value注解</code>以及<code>EnvironmentAware接口</code>来将<code>Spring Environment</code>中的数据注入到属性上, Spring Boot对此进一步提出了<code>类型安全配置属性</code>(Type-safe ConfigurationProperties) ,这样即使在数据量非常庞大的情况下,也可以更加方便地将配置文件中的数据注入Bean中.<br><img src="https://img-blog.csdnimg.cn/20210603220903768.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3Nhbmhld3V5YW5n,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>yml类型配置文件：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">my:</span></span><br><span class="line">  <span class="attr">users:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">江南一点雨</span></span><br><span class="line">      <span class="attr">address:</span> <span class="string">China</span></span><br><span class="line">      <span class="attr">favorites:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">足球</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">徒步</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">Coding</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">sang</span></span><br><span class="line">      <span class="attr">address:</span> <span class="string">GZ</span></span><br><span class="line">      <span class="attr">favorites:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">阅读</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">吉他</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by sang on 2018/7/5.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;my&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Users</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;User&gt; users;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="2-7-YAML配置"><a href="#2-7-YAML配置" class="headerlink" title="2.7 YAML配置"></a>2.7 YAML配置</h3><p><code>YAML</code>是<code>JSON的超集</code>,简洁而强大,是一种专门用来书写<code>配置文件</code>的语言,可以替代application.properties。在创建一个Spring Boot项目时,引入的<code>spring-boot-starter-web</code>依赖间接地引入了<code>snakeyaml</code>依赖, snakeyaml会<code>实现对YAML配置的解析</code>。YAML的使用非常简单,利用缩进来表示层级关系,并且<code>大小写敏感</code>。在Spring Boot项目中使用YAML只需要在<code>resources</code>目录下创建一个<code>application.yml</code>文件即可,然后向application.yml中添加配置:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">  <span class="attr">servlet:</span></span><br><span class="line">    <span class="attr">context-path:</span> <span class="string">/chapter02</span></span><br><span class="line">  <span class="attr">tomcat:</span></span><br><span class="line">    <span class="attr">uri-encoding:</span> <span class="string">utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="attr">my:</span></span><br><span class="line">  <span class="attr">users:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">江南一点雨</span></span><br><span class="line">      <span class="attr">address:</span> <span class="string">China</span></span><br><span class="line">      <span class="attr">favorites:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">足球</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">徒步</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">Coding</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">sang</span></span><br><span class="line">      <span class="attr">address:</span> <span class="string">GZ</span></span><br><span class="line">      <span class="attr">favorites:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">阅读</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">吉他</span></span><br></pre></td></tr></table></figure>
<h3 id="2-8-Profile"><a href="#2-8-Profile" class="headerlink" title="2.8 Profile"></a>2.8 Profile</h3><p>开发者在项目发布之前,配置需要频繁更改,例如<code>数据库配置、redis配置、mongodb配置、jms配置</code>等。频·繁修改带来了巨大的工作量, Spring对此提供了解决方案(<code>@Profile注解</code>) , Spring Boot则更进一步提供了更加简洁的解决方案, Spring Boot中约定的不同环境下配置文件名称规则为<code>application-&#123;profile&#125;.properties</code>, profile占位符表示当前环境的名称,具体配置步骤如下:</p>
<h5 id="不同的环境指定不同的配置文件"><a href="#不同的环境指定不同的配置文件" class="headerlink" title="不同的环境指定不同的配置文件"></a>不同的环境指定不同的配置文件</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.profiles.active=dev</span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/2021060321383934.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3Nhbmhld3V5YW5n,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<hr>
<h2 id="第3章Spring-Boot整合视图层技术"><a href="#第3章Spring-Boot整合视图层技术" class="headerlink" title="第3章Spring Boot整合视图层技术"></a>第3章Spring Boot整合视图层技术</h2><p>Spring Boot官方推荐使用的模板引擎是Thymeleaf,不过像FreeMarker也支持, JSP技术在这里并不推荐使用。下面分别向读者介绍Spring Boot整合Thymeleaf和FreeMarker两种视图层技术。</p>
<h3 id="3-1整合Thymeleaf"><a href="#3-1整合Thymeleaf" class="headerlink" title="3.1整合Thymeleaf"></a>3.1整合Thymeleaf</h3><p><code>Thymeleaf</code>是新一代<code>Java模板引擎</code>,类似于<code>Velocity</code>, <code>FreeMarker</code>等传统<code>Java模板引擎</code>。与传统Java模板引擎不同的是, <code>Thymeleaf支持HTML原型</code>,既可以让前端工程师在浏览器中直接打开查看样式,也可以让后端工程师结合真实数据查看显示效果。同时, <code>Spring Boot提供了Thymeleaf自动化配置解决方案</code>,因此在Spring Boot中使用Thymeleaf非常方便。Spring Boot整合Thymeleaf主要可通过如下步骤:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="2．配置Thymeleaf"><a href="#2．配置Thymeleaf" class="headerlink" title="2．配置Thymeleaf"></a>2．配置<code>Thymeleaf</code></h5><p>Spring Boot为<code>Thymeleaf</code>提供了自动化配置类<code>ThymeleafAutoConfiguration</code>,相关的配置属性在<code>ThymeleatProperties</code>类中, ThymeleafProperties部分源码如下:<br><img src="https://img-blog.csdnimg.cn/2021060322360776.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3Nhbmhld3V5YW5n,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>如果开发者想对<code>默认的Thymeleaf配置参数</code>进行自定义配置,那么可以直接在<code>application.properties</code>中进行配置,部分常见配置如下:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#是否开启缓存，开发时可设置为false，默认为true</span></span><br><span class="line">spring.thymeleaf.cache=<span class="literal">true</span></span><br><span class="line"><span class="comment">#是否检查模板是否存在，默认为true</span></span><br><span class="line">spring.thymeleaf.check-template=<span class="literal">true</span></span><br><span class="line"><span class="comment">#是否检查模板位置是否存在，默认为true</span></span><br><span class="line">spring.thymeleaf.check-template-location=<span class="literal">true</span></span><br><span class="line"><span class="comment">#模板文件编码</span></span><br><span class="line">spring.thymeleaf.encoding=UTF-8</span><br><span class="line"><span class="comment">#模板文件位置</span></span><br><span class="line">spring.thymeleaf.prefix=classpath:/templates/</span><br><span class="line"><span class="comment">#Content-Type配置</span></span><br><span class="line">spring.thymeleaf.servlet.content-type=text/html</span><br><span class="line"><span class="comment">#模板文件后缀</span></span><br><span class="line">spring.thymeleaf.suffix=.html</span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/20210604091750176.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3Nhbmhld3V5YW5n,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20210604091841946.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3Nhbmhld3V5YW5n,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><strong>官网： <a target="_blank" rel="noopener" href="https://www.thymeleaf.org/">https://www.thymeleaf.org</a></strong></p>
<h3 id="3-2整合FreeMarke"><a href="#3-2整合FreeMarke" class="headerlink" title="3.2整合FreeMarke"></a>3.2整合FreeMarke</h3><p><code>FreeMarker</code>是一个非常古老的模板引擎,可以用在<code>Web环境或者非Web环境</code>中。与<code>Thymeleaf</code>不同, <code>FreeMarker</code>需要经过解析才能够在浏览器中展示出来。FreeMarker不仅可以用来配置<code>HTML</code>页面模板,也可以作为<code>电子邮件模板</code>、<code>配置文件模板</code>以及<code>源码模板</code>等。Spring Boot中对FreeMarker整合也提供了很好的支持.</p>
<h5 id="配置FreeMarker"><a href="#配置FreeMarker" class="headerlink" title="配置FreeMarker"></a>配置FreeMarker</h5><p>Spring Boot对<code>FreeMarker</code>也提供了<code>自动化配置类FreeMarkerAutoConfiguration</code>,相关的配置属性在<code>FreeMarkerProperties</code> 中,</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#HttpServletRequest的属性是否可以覆盖controller中model的同名项</span></span><br><span class="line">spring.freemarker.allow-request-override=<span class="literal">false</span></span><br><span class="line"><span class="comment">#HttpSession的属性是否可以覆盖controller中model的同名项</span></span><br><span class="line">spring.freemarker.allow-session-override=<span class="literal">true</span></span><br><span class="line"><span class="comment">#是否开启缓存</span></span><br><span class="line">spring.freemarker.cache=fal se</span><br><span class="line"><span class="comment">#模板文件编码</span></span><br><span class="line">spring.freemarker.charset=UTF-8</span><br><span class="line"><span class="comment">#是否检查模板位置</span></span><br><span class="line">spring.freemarker.check-template-location=<span class="literal">true</span></span><br><span class="line"><span class="comment">#Content-Type的值</span></span><br><span class="line">spring.freemarker.content-type=text/html</span><br><span class="line"><span class="comment">#是否将HttpServletRequest中的属性添加到Model中</span></span><br><span class="line">spring.freemarker.expose-request-attributes=<span class="literal">false</span></span><br><span class="line"><span class="comment">#是否将HttpSession中的属性添加到Model中</span></span><br><span class="line">spring.freemarker.expose-session-attributes=<span class="literal">true</span></span><br><span class="line"><span class="comment">#模板文件后缀</span></span><br><span class="line">spring.freemarker.suffix=.ftl</span><br><span class="line"><span class="comment">#模板文件位置</span></span><br><span class="line">spring.freemarker.template-loader-path=classpath:/templates/</span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/2021060409293794.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3Nhbmhld3V5YW5n,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20210604092951300.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3Nhbmhld3V5YW5n,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><strong>官网：<a target="_blank" rel="noopener" href="https://freemarker.apache.org/">https://freemarker.apache.org/</a></strong> </p>
<h3 id="3-3-整合-JSP"><a href="#3-3-整合-JSP" class="headerlink" title="3.3 整合 JSP"></a>3.3 整合 JSP</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat.embed<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat-embed-jasper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jstl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.liruilong.spring_boot_demo.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.ViewResolverRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> WebMvcConfig</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> TODO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2021/6/4 10:02</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> Li Ruilong</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebMvcConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configureViewResolvers</span><span class="params">(ViewResolverRegistry registry)</span> </span>&#123;</span><br><span class="line">        registry.jsp(<span class="string">&quot;/WEB-INF/jsp/&quot;</span>, <span class="string">&quot;.jsp&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="第4章-Spring-Boot整合Web开发"><a href="#第4章-Spring-Boot整合Web开发" class="headerlink" title="第4章 Spring Boot整合Web开发."></a>第4章 Spring Boot整合Web开发.</h2><h3 id="4-1返回JSON数据"><a href="#4-1返回JSON数据" class="headerlink" title="4.1返回JSON数据"></a>4.1返回JSON数据</h3><h5 id="4-1-1-默认实现"><a href="#4-1-1-默认实现" class="headerlink" title="4.1.1 默认实现"></a>4.1.1 默认实现</h5><p><code>JSON</code>是目前主流的前后端数据传输方式, <code>Spring MVC</code>中使用消息转换器<code>HttpMessageConverter</code>对JSON的转换提供了很好的支持,在<code>Spring Boot</code>中更进一步,对相关配置做了更进一步的简化。默认情况下,当开发者新创建一个Spring Boot项目后,添加Web依赖,<br><img src="https://img-blog.csdnimg.cn/20210604103028128.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3Nhbmhld3V5YW5n,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>这个依赖中默认加入了<code>jackson-databind</code>作为JSON处理器,此时不需要添加额外的JSON处理器就能返回一段JSON了.</p>
<p>如果需要频繁地用到<code>@ResponseBody</code>注解,那么可以采用<code>@RestController </code>组合注解代替<code>@Controller</code>和<code>@ResponseBody</code></p>
<blockquote>
<p>这是Spring Boot自带的处理方式。如果采用这种方式,那么对于字段忽略、日期格式化等常见需求都可以通过注解来解决。这是通过Spring中默认提供的<code>MappingJackson2HttpMessageConverter来实现</code>的.<br><code>HttpMessageConverter</code> ，看名字就知道，这是一个消息转换工具，有两方面的功能：</p>
<ol>
<li><code>将服务端返回的对象序列化成 JSON 字符串</code></li>
<li><code>将前端传来的 JSON 字符串反序列化成 Java 对象</code><br>所有的 JSON 生成都离不开相关的 <code>HttpMessageConverter</code>,SpringMVC 自动配置了<code> Jackson</code> 和 <code>Gson</code> 的 HttpMessageConverter，Spring Boot 中又对此做了自动化配置：</li>
<li><code>org.springframework.boot.autoconfigure.http.JacksonHttpMessageConvertersConfiguration</code></li>
<li><code>org.springframework.boot.autoconfigure.http.GsonHttpMessageConvertersConfiguration</code></li>
</ol>
<p>所以，如果用户使用 <code>jackson</code> 和 <code>gson</code> 的话，没有其他额外配置，则只需要添加依赖即可。</p>
</blockquote>
<h5 id="修改转化器"><a href="#修改转化器" class="headerlink" title="修改转化器"></a>修改转化器</h5><p>添加一个MappingJackson2HttpMessageConverter，由<code>@ConditionalOnMissingBean</code>确定。<br><font color="#009688"><strong>嗯，我们温习一下条件化注解吧</strong></p>
<blockquote>
<p><img src="https://img-blog.csdnimg.cn/20210604111015837.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3Nhbmhld3V5YW5n,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/202106041104095.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3Nhbmhld3V5YW5n,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20210604112518739.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3Nhbmhld3V5YW5n,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>当然这里我们也可以只定义一个 <code>ObjectMapper </code></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.liruilong.spring_boot_demo.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.converter.json.MappingJackson2HttpMessageConverter;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> WebMvcConfig</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> TODO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2021/6/4 10:02</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> Li Ruilong</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebMvcConfig</span>  </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function">MappingJackson2HttpMessageConverter <span class="title">mappingJackson2CborHttpMessageConverter</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MappingJackson2HttpMessageConverter(objectMapper());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function">ObjectMapper <span class="title">objectMapper</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ObjectMapper om = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">        om.setDateFormat(<span class="keyword">new</span> SimpleDateFormat(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>));</span><br><span class="line">        <span class="keyword">return</span> om;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="4-1-2-自定义转换器"><a href="#4-1-2-自定义转换器" class="headerlink" title="4.1.2 自定义转换器"></a>4.1.2 自定义转换器</h5><p>当然开发者在这里也可以根据实际需求<code>自定义JSON转换器</code>。常见的JSON处理器除了<code>jackson-databind</code>之外,还有<code>Gson</code>和<code>fastison</code>,这里针对常见用法分别举例.</p>
<h6 id="Gson"><a href="#Gson" class="headerlink" title="Gson"></a><code>Gson</code></h6><p>Gson是Google的一个开源JSON解析框架。使用Gson,需要先除去默认的jackson-databind,然后加入Gson依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-json<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.75<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>由于<code>Spring Boot</code>中默认提供了<code>Gson的自动转换类GsonHttpMessageConvertersConfiguration</code>,因此Gson的依赖添加成功后,可以像使用<code>jackson-databind那样直接使用Gson</code>。但是在Gson进行·转换时,如果想对日期数据进行格式化,那么还需要开发者自定义<code>HttpMessageConverter</code>.自定义<code>HttpMessageConverter</code>可以通过如下方式。也可以直接使用Gson对象。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebMvcConfig</span> </span>&#123;</span><br><span class="line"><span class="comment">//    @Bean</span></span><br><span class="line"><span class="comment">//    GsonBuilder gsonBuilder() &#123;</span></span><br><span class="line"><span class="comment">//        GsonBuilder gsonBuilder = new GsonBuilder();</span></span><br><span class="line"><span class="comment">//        gsonBuilder.setDateFormat(&quot;yyyy-MM-dd&quot;);</span></span><br><span class="line"><span class="comment">//        return gsonBuilder;</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function">GsonHttpMessageConverter <span class="title">gsonHttpMessageConverter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        GsonBuilder gsonBuilder = <span class="keyword">new</span> GsonBuilder();</span><br><span class="line">        gsonBuilder.setDateFormat(<span class="string">&quot;yyyy-MM-dd&quot;</span>);</span><br><span class="line">        GsonHttpMessageConverter converter = <span class="keyword">new</span> GsonHttpMessageConverter();</span><br><span class="line">        converter.setGson(gsonBuilder.create());</span><br><span class="line">        <span class="keyword">return</span> converter;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="fastison"><a href="#fastison" class="headerlink" title="fastison"></a><code>fastison</code></h6><p><code>fastjson</code>是阿里巴巴的一个开源JSON解析框架,是目前JSON解析速度最快的开源框架,该框架也可以集成到Spring Boot中。不同于<code>Gson</code>, <code>fastjson</code>继承完成之后并不能立马使用,需要开发者提供相应的<code>HttpMessageConverter</code>后才能使用,集成fastison的步骤如下。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-json<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.75<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.http.encoding.force-response=<span class="literal">true</span></span><br></pre></td></tr></table></figure>
<p>对于<code>FastlsonHttpMessageConverter</code>的配置,除了<code>FastJsonHttpMessageConverter </code>这种方式之外,还有另一种方式。在Spring Boot项目中,当开发者引入<code>spring-boo-starter-web</code>依赖之后,该依赖又依赖了<code>spring-boot-autoconfigure</code>,在这个自动化配置中,有一个<code>webMvcAutoConfiguration</code>类提供了对Spring MVC最基本的配置,如果某一项自动化配置不满足开发需求,开发者可以针对该项自定义配置,只需要实现<code>WebMveConfigurer</code>接口即可(在Spring 5.0之前是通过继承<code>WebMvcConfigurerAdapter</code>类来实现的) ,代码如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebMvcConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configureMessageConverters</span><span class="params">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> </span>&#123;</span><br><span class="line">        FastJsonHttpMessageConverter converter = <span class="keyword">new</span> FastJsonHttpMessageConverter();</span><br><span class="line">        FastJsonConfig fastJsonConfig = <span class="keyword">new</span> FastJsonConfig();</span><br><span class="line">        fastJsonConfig.setCharset(Charset.forName(<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">        fastJsonConfig.setDateFormat(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class="line">        converter.setFastJsonConfig(fastJsonConfig);</span><br><span class="line">        converter.setDefaultCharset(Charset.forName(<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">        converters.add(converter);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    @Bean</span></span><br><span class="line"><span class="comment">//    FastJsonHttpMessageConverter fastJsonHttpMessageConverter() &#123;</span></span><br><span class="line"><span class="comment">//        FastJsonHttpMessageConverter converter = new FastJsonHttpMessageConverter();</span></span><br><span class="line"><span class="comment">//        FastJsonConfig fastJsonConfig = new FastJsonConfig();</span></span><br><span class="line"><span class="comment">//        fastJsonConfig.setCharset(Charset.forName(&quot;UTF-8&quot;));</span></span><br><span class="line"><span class="comment">//        fastJsonConfig.setDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;);</span></span><br><span class="line"><span class="comment">//        converter.setFastJsonConfig(fastJsonConfig);</span></span><br><span class="line"><span class="comment">//        converter.setDefaultCharset(Charset.forName(&quot;UTF-8&quot;));</span></span><br><span class="line"><span class="comment">//        return converter;</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-2静态资源访问"><a href="#4-2静态资源访问" class="headerlink" title="4.2静态资源访问"></a>4.2静态资源访问</h3><p>在<code>Spring MVC</code>中,对于静态资源都需要开发者手动配置静态资源过滤。Spring Boot中对此也提供了<code>自动化配置</code>,可以简化静态资源过滤配置。</p>
<h6 id="Spring-MVC中的配置："><a href="#Spring-MVC中的配置：" class="headerlink" title="Spring MVC中的配置："></a>Spring MVC中的配置：</h6><p><code>xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">mapping</span>=<span class="string">&quot;/js/**&quot;</span> <span class="attr">location</span>=<span class="string">&quot;/js/&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">mapping</span>=<span class="string">&quot;/css/**&quot;</span> <span class="attr">location</span>=<span class="string">&quot;/css/&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">mapping</span>=<span class="string">&quot;/html/**&quot;</span> <span class="attr">location</span>=<span class="string">&quot;/html/&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>由于这是一种Ant风格的路径匹配符，&#x2F;** 表示可以匹配任意层级的路径，因此上面的代码也可以像下面这样简写：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">mapping</span>=<span class="string">&quot;/**&quot;</span> <span class="attr">location</span>=<span class="string">&quot;/&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>java</code>:重写 WebMvcConfigurationSupport 类中的addResourceHandlers方法，在该方法中配置静态资源位置即可</p>
<h5 id="4-2-1默认策略"><a href="#4-2-1默认策略" class="headerlink" title="4.2.1默认策略"></a>4.2.1默认策略</h5><p>Spring Boot中对于Spring MVC的自动化配置都在<code>webMvcAutoConfiguration</code>类中,因此对于默认的静态资源过滤策略可以从这个类中一窥究竟。在WebMvcAutoConfiguration类中有一个静态内部类<code>webMvcAutoConfigurationAdapter</code>,实现了4.1节提到的<code>WebMvcConfigurer</code>接口。<code>webMvcConfigurer</code>接口中有一个方法<code>addResourceHandlers</code>是用来配置静态资源过滤的。方法在<code>WebMvcAutoConfigurationAdapter</code>类中得到了实现,部分核心代码如下<br><img src="https://img-blog.csdnimg.cn/20210604122648530.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3Nhbmhld3V5YW5n,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>Spring Boot在这里进行了<code>默认的静态资源过滤配置</code>,其中<code>staticPathPattern</code>默认定义在<code>WebMvcProperties</code> 中<br><img src="https://img-blog.csdnimg.cn/20210604122743210.png" alt="在这里插入图片描述"><br><code>registration.addResourceLocations(this.resourceProperties.getStaticLocations());</code>获取到的默认静态资源位置定义在<code>ResourceProperties</code><br><img src="https://img-blog.csdnimg.cn/20210604123003358.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3Nhbmhld3V5YW5n,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<blockquote>
<p>在一个新创建的Spring Boot项目中,添加了<code>spring-boot-starter-web</code>依赖之后,在<code>resources</code>目录下分别创建<code>4个目录</code>, 4个目录中放入同名的静态资源(如图4-4所示,数字表示不同位置资源的优先级)<br><img src="https://img-blog.csdnimg.cn/20210604123624305.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3Nhbmhld3V5YW5n,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
</blockquote>
<h5 id="4-2-2自定义策略"><a href="#4-2-2自定义策略" class="headerlink" title="4.2.2自定义策略"></a>4.2.2自定义策略</h5><p>自定义静态资源过滤策略有以下两种方式;</p>
<ol>
<li><p>在配置文件中定义可以在<code>application.properties</code>中直接定义过滤规则和静态资源位置,</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 静态资源位置</span></span><br><span class="line">spring.web.resources.static-locations=classpath:/static/</span><br><span class="line"><span class="comment"># 过滤规则</span></span><br><span class="line">spring.mvc.static-path-pattern=/static/**  </span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/20210604124502468.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3Nhbmhld3V5YW5n,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
</li>
<li><p><code>Java编码定义</code>也可以通过Java编码方式来定义,此时只需要实现<code>WebMveConfigurer接口</code>即可,然后实现该接口的<code>addResourceHandlers</code>方法,代码如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebMvcConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> </span>&#123;</span><br><span class="line">        registry.addResourceHandler(<span class="string">&quot;/static/**&quot;</span>).addResourceLocations(<span class="string">&quot;classpath:/static/&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="4-3文件上传"><a href="#4-3文件上传" class="headerlink" title="4.3文件上传."></a>4.3文件上传.</h3><p><code>Spring MVC</code>对文件上传做了简化,在Spring Boot中对此做了更进一步的简化,文件上传更为方便。Java中的文件上传一共涉及两个组件,一个是<code>CommonsMultipartResolver</code>,另一个是<code>StandardServletMultipartResolver</code>.<br>其中<code>CommonsMultipartResolver</code>使用<code>commons-fileupload</code>来处理multipart请求,而<code>StandardServletMultipartResolver</code>则是基于<code>Servlet 3.0</code>来处理multipart请求的,因此若使用StandardServletMultipartResolver,则不需要添加额外的jar包。<code>Tomcat 7.0</code>开始就支持Servlet3.0.</p>
<blockquote>
<p>Spring Boot提供的文件上传自动化配置类<code>MultiparAutoConfiguraton中</code>,默认也是采用<code>StandardServletMultipartResolver</code><br><img src="https://img-blog.csdnimg.cn/20210604135451417.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3Nhbmhld3V5YW5n,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">spring.servlet.multipart.max-file-size=1KB</span><br><span class="line">.....</span><br></pre></td></tr></table></figure>
<h5 id="4-3-1单文件上传"><a href="#4-3-1单文件上传" class="headerlink" title="4.3.1单文件上传"></a>4.3.1单文件上传</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/upload&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;file&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;上传&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">DateTimeFormatter dateTimeFormatter = DateTimeFormatter.ofPattern(<span class="string">&quot;/yyyy/MM/dd/&quot;</span>);</span><br><span class="line">   <span class="meta">@PostMapping(&quot;/upload&quot;)</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">upload</span><span class="params">(MultipartFile file, HttpServletRequest req)</span> </span>&#123;</span><br><span class="line">       String realPath = req.getServletContext().getRealPath(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">       String format = LocalDate.now().format(dateTimeFormatter);</span><br><span class="line">       String path = realPath + format;</span><br><span class="line">       File folder = <span class="keyword">new</span> File(path);</span><br><span class="line">       <span class="keyword">if</span> (!folder.exists()) &#123;</span><br><span class="line">           folder.mkdirs();</span><br><span class="line">       &#125;</span><br><span class="line">       String oldName = file.getOriginalFilename();</span><br><span class="line">       String newName = UUID.randomUUID().toString() + oldName.substring(oldName.lastIndexOf(<span class="string">&quot;.&quot;</span>));</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           file.transferTo(<span class="keyword">new</span> File(folder, newName));</span><br><span class="line">           String s = req.getScheme() + <span class="string">&quot;://&quot;</span> + req.getServerName() + <span class="string">&quot;:&quot;</span> + req.getServerPort() + format + newName;</span><br><span class="line">           <span class="keyword">return</span> s;</span><br><span class="line">       &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> <span class="string">&quot;error&quot;</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h5 id="4-3-2多文件上传"><a href="#4-3-2多文件上传" class="headerlink" title="4.3.2多文件上传"></a>4.3.2多文件上传</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/upload2&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;files&quot;</span> <span class="attr">multiple</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;上传&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/upload2&quot;)</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">upload</span><span class="params">(MultipartFile[] files, HttpServletRequest req)</span> </span>&#123;</span><br><span class="line">       String realPath = req.getServletContext().getRealPath(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">       String format = LocalDate.now().format(dateTimeFormatter);</span><br><span class="line">       String path = realPath + format;</span><br><span class="line">       File folder = <span class="keyword">new</span> File(path);</span><br><span class="line">       <span class="keyword">if</span> (!folder.exists()) &#123;</span><br><span class="line">           folder.mkdirs();</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           <span class="keyword">for</span> (MultipartFile file : files) &#123;</span><br><span class="line">               String oldName = file.getOriginalFilename();</span><br><span class="line">               String newName = UUID.randomUUID().toString() + oldName.substring(oldName.lastIndexOf(<span class="string">&quot;.&quot;</span>));</span><br><span class="line">               file.transferTo(<span class="keyword">new</span> File(folder, newName));</span><br><span class="line">               String s = req.getScheme() + <span class="string">&quot;://&quot;</span> + req.getServerName() + <span class="string">&quot;:&quot;</span> + req.getServerPort() + format + newName;</span><br><span class="line">               System.out.println(<span class="string">&quot;s = &quot;</span> + s);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/upload3&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;file1&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;file2&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;上传&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/upload3&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">upload</span><span class="params">(MultipartFile file1, MultipartFile file2, HttpServletRequest req)</span> </span>&#123;</span><br><span class="line">        String realPath = req.getServletContext().getRealPath(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">        String format = LocalDate.now().format(dateTimeFormatter);</span><br><span class="line">        String path = realPath + format;</span><br><span class="line">        File folder = <span class="keyword">new</span> File(path);</span><br><span class="line">        <span class="keyword">if</span> (!folder.exists()) &#123;</span><br><span class="line">            folder.mkdirs();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            String oldName1 = file1.getOriginalFilename();</span><br><span class="line">            String newName1 = UUID.randomUUID().toString() + oldName1.substring(oldName1.lastIndexOf(<span class="string">&quot;.&quot;</span>));</span><br><span class="line">            file1.transferTo(<span class="keyword">new</span> File(folder, newName1));</span><br><span class="line">            String s1 = req.getScheme() + <span class="string">&quot;://&quot;</span> + req.getServerName() + <span class="string">&quot;:&quot;</span> + req.getServerPort() + format + newName1;</span><br><span class="line">            System.out.println(<span class="string">&quot;s1 = &quot;</span> + s1);</span><br><span class="line"></span><br><span class="line">            String oldName2 = file2.getOriginalFilename();</span><br><span class="line">            String newName2 = UUID.randomUUID().toString() + oldName2.substring(oldName2.lastIndexOf(<span class="string">&quot;.&quot;</span>));</span><br><span class="line">            file2.transferTo(<span class="keyword">new</span> File(folder, newName2));</span><br><span class="line">            String s2 = req.getScheme() + <span class="string">&quot;://&quot;</span> + req.getServerName() + <span class="string">&quot;:&quot;</span> + req.getServerPort() + format + newName2;</span><br><span class="line">            System.out.println(<span class="string">&quot;s2 = &quot;</span> + s2);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h5 id="4-3-3AJAX文件上传"><a href="#4-3-3AJAX文件上传" class="headerlink" title="4.3.3AJAX文件上传"></a>4.3.3AJAX文件上传</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://code.jquery.com/jquery-3.5.1.js&quot;</span> <span class="attr">integrity</span>=<span class="string">&quot;sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=&quot;</span> <span class="attr">crossorigin</span>=<span class="string">&quot;anonymous&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;result&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">id</span>=<span class="string">&quot;file&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;上传&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;uploadFile()&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">uploadFile</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> file = $(<span class="string">&quot;#file&quot;</span>)[<span class="number">0</span>].files[<span class="number">0</span>];</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> formData = <span class="keyword">new</span> FormData();</span></span><br><span class="line"><span class="javascript">        formData.append(<span class="string">&quot;file&quot;</span>, file);</span></span><br><span class="line"><span class="javascript">        formData.append(<span class="string">&quot;username&quot;</span>, <span class="string">&quot;javaboy&quot;</span>);</span></span><br><span class="line"><span class="javascript">        $.ajax(&#123;</span></span><br><span class="line"><span class="javascript">            <span class="attr">type</span>:<span class="string">&#x27;post&#x27;</span>,</span></span><br><span class="line"><span class="javascript">            <span class="attr">url</span>:<span class="string">&#x27;/upload&#x27;</span>,</span></span><br><span class="line"><span class="javascript">            <span class="attr">processData</span>:<span class="literal">false</span>,</span></span><br><span class="line"><span class="javascript">            <span class="attr">contentType</span>:<span class="literal">false</span>,</span></span><br><span class="line"><span class="javascript">            <span class="attr">data</span>:formData,</span></span><br><span class="line"><span class="javascript">            <span class="attr">success</span>:<span class="function"><span class="keyword">function</span> (<span class="params">msg</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                $(<span class="string">&quot;#result&quot;</span>).html(msg);</span></span><br><span class="line"><span class="javascript">            &#125;</span></span><br><span class="line"><span class="javascript">        &#125;)</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="4-4-ControllerAdvice"><a href="#4-4-ControllerAdvice" class="headerlink" title="4.4 @ControllerAdvice"></a>4.4 @ControllerAdvice</h3><p>顾名思义, <code>@ControllerAdvice</code>就是<code>@Controller</code>的增强版。<code>@ControllerAdvice</code>主要用来<code>处理全局数据</code>,一般搭配<code>@ExceptionHandier</code>. <code>@ModelAttribute</code>以及<code>@InitBinder</code>使用。</p>
<h5 id="4-4-1-全局异常处理"><a href="#4-4-1-全局异常处理" class="headerlink" title="4.4.1 全局异常处理"></a>4.4.1 全局异常处理</h5><p>上传文件大小超出限制。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="comment">//@Controller</span></span><br><span class="line"><span class="comment">//@RestControllerAdvice</span></span><br><span class="line"><span class="comment">//@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyGlobalException</span> </span>&#123;</span><br><span class="line">    <span class="meta">@ExceptionHandler(MaxUploadSizeExceededException.class)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">customException</span><span class="params">(MaxUploadSizeExceededException e)</span> </span>&#123;</span><br><span class="line">        ModelAndView mv = <span class="keyword">new</span> ModelAndView(<span class="string">&quot;javaboy&quot;</span>);</span><br><span class="line">        mv.addObject(<span class="string">&quot;error&quot;</span>, e.getMessage());</span><br><span class="line">        <span class="keyword">return</span> mv;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="4-4-2-添加全局数据"><a href="#4-4-2-添加全局数据" class="headerlink" title="4.4.2 添加全局数据"></a>4.4.2 添加全局数据</h5><p><code>@ControllerAdvice</code>是一个全局数据处理组件,因此也可以在<code>@ControllerAdvice</code>中配置全局数据,使用<code>@ModelAtribute注解进行配置</code>,代码如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyGlobalData</span> </span>&#123;</span><br><span class="line">    <span class="meta">@ModelAttribute(&quot;info&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String,String&gt; <span class="title">mydata</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Map&lt;String, String&gt; info = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        info.put(<span class="string">&quot;username&quot;</span>, <span class="string">&quot;javaboy&quot;</span>);</span><br><span class="line">        info.put(<span class="string">&quot;address&quot;</span>, <span class="string">&quot;www.javaboy.org&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> info;</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;   </span><br></pre></td></tr></table></figure>
<p>在全局配置中添加<code>mydata</code>方法,返回一个map.该方法有一个注解<code>@ModelAttribute</code>,其中的value属性表示这条返回数据的<code>key</code>,而方法的返回值是返回数据的<code>value</code>,此时在任意请求的<code>Controller</code>中,通过方法参数中的Model都可以获取info的数据。</p>
<h5 id="4-4-3-请求参数预处理"><a href="#4-4-3-请求参数预处理" class="headerlink" title="4.4.3 请求参数预处理"></a>4.4.3 请求参数预处理</h5><p><code>@ControllerAdvice</code>结合<code>@InitBinder</code>还能实现<code>请求参数预处理</code>,即将表单中的<code>数据</code>绑定到<code>实体类</code>上时进行一些额外处理。<br>多个实体类存在相同的字段时,会合并字段值，使用ControllerAdvice来做预处理。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyGlobalData</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@InitBinder(&quot;b&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">b</span><span class="params">(WebDataBinder binder)</span> </span>&#123;</span><br><span class="line">        binder.setFieldDefaultPrefix(<span class="string">&quot;b.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@InitBinder(&quot;a&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">a</span><span class="params">(WebDataBinder binder)</span> </span>&#123;</span><br><span class="line">        binder.setFieldDefaultPrefix(<span class="string">&quot;a.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/book&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addBook</span><span class="params">(<span class="meta">@ModelAttribute(&quot;b&quot;)</span> Book book, <span class="meta">@ModelAttribute(&quot;a&quot;)</span> Author author)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;book = &quot;</span> + book);</span><br><span class="line">        System.out.println(<span class="string">&quot;author = &quot;</span> + author);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><font color="#009688"><strong>在GlobalConfig类中创建两个方法,</strong></p>
<ul>
<li>第一个@InitBinder(“b”)表示该方法是处理@ModelAttribute(“)对应的参数的,</li>
<li>第二个@nitBinder(“a”)表示该方法是处理@ModelAttribute(“a”)对应的参数的。</li>
</ul>
<p><font color="#009688"><strong>在WebDataBinder对象中,还可以设置允许的字段、禁止的字段、必填字段以及验证器等。</strong></p>
</blockquote>
<h3 id="4-5-自定义错误页"><a href="#4-5-自定义错误页" class="headerlink" title="4.5 自定义错误页"></a>4.5 自定义错误页</h3><p><code>Spring Boot</code>中的全局异常处理。在处理异常时,开发者可以根据实际情况返回不同的页面,但是这种异常处理方式一般用来处理<code>应用级别</code>的异常,有一些<code>容器级别</code>的错误就处理不了,例如<code>Filter 中抛出异常</code>,使用<code>@ControllerAdvice</code>定义的全局异常处理机制就<code>无法处理</code>。</p>
<p>因此, Spring Boot中对于异常的处理还有另外的方式,这就是本节要介绍的内容。在Spring Boot 中,默认情况下,如果用户在发起请求时发生了404错误, Spring Boot会有一个默认的页面展示给用户.<br><img src="https://img-blog.csdnimg.cn/20210604194513830.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3Nhbmhld3V5YW5n,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>Spring Boot中的错误默认是由<code>BasicErrorController类</code>来处理的,该类中的核心方法主要有两个:<br><img src="https://img-blog.csdnimg.cn/2021060419542031.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3Nhbmhld3V5YW5n,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>·<code>errorHtml</code>方法用来返回错误<code>HTML</code>页面, <code>error</code>用来返回错误<code>JSON</code>,具体返回的是HTML还是<code>JSON</code>,则要看请求头的<code>Accept参数</code>。返回JSON的逻辑很简单,不必过多介绍,返回HTML的逻辑稍微有些复杂,在<code>errorHtml</code>方法中,通过调用<code>resolveErrorView</code>方法来获取一个错误视图的<code>ModelAndView</code>,而<code>resolveErrorView</code>方法的调用最终会来到<code>DefaultErrorViewResolver</code>类中。<code>DefaultErrorViewResolver</code>类是Spring Boot中默认的错误信息视图解析器,部分源码如下:<br><img src="https://img-blog.csdnimg.cn/20210604201520523.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3Nhbmhld3V5YW5n,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h5 id="4-5-1-简单配置-静态页面"><a href="#4-5-1-简单配置-静态页面" class="headerlink" title="4.5.1 简单配置.静态页面"></a>4.5.1 简单配置.静态页面</h5><p>要<code>自定义错误页面</code>其实很简单,提供<code>4xx和Sxx</code>页面即可。如果开发者不需要向用户展示详细的错误信息,那么可以把错误信息定义成静态页面,直接,在<code>resources/static</code> 录下创建<code>error</code>目录,然后在<code>error</code>目录中创建错误展示页面。错误展示页面的命名规则有两种:<br><img src="https://img-blog.csdnimg.cn/202106042213193.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3Nhbmhld3V5YW5n,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<ul>
<li>一种是<code>4xx.html</code>、 <code>5xx.html</code>;</li>
<li>另一种是直接使用响应码命名文件,例如<code>404.html.405.html, 500.html</code>.第二种命名方式划分得更细,当出错时,不同的错误会展示不同的错误页面</li>
</ul>
<h5 id="模板页面"><a href="#模板页面" class="headerlink" title=".模板页面"></a>.模板页面</h5><p><code>Spring Boot</code>在这里一共返回了<code>5条错误相关</code>的信息,分别是<code>timestamp</code>, <code>status</code>, <code>error</code>, <code>message</code>以及<code>path</code><br><img src="https://img-blog.csdnimg.cn/20210604222146507.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3Nhbmhld3V5YW5n,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><font color="#009688"><strong>若用户定义了多个错误页面,则<code>响应码html页面</code>的优先级<code>高</code>于<code>4xx.html. Sxx.tml页面</code>的优先级,即若当前是一个404错误,则优先展示<code>404.html</code>而不是<code>4xx.html</code>;<code>动态</code>页面的优级<code>高</code>于<code>静态</code>页面,即若<code>resources/templates</code>和<code>resource/static</code> 同时定义了<code>4xx.html</code>,则<code>优先</code>展示<code>resources/templates/4xx.html.</code></strong></p>
<h5 id="4-5-2-复杂配置"><a href="#4-5-2-复杂配置" class="headerlink" title="4.5.2 复杂配置"></a>4.5.2 复杂配置</h5><p>上面这种配置还是不够灵活,只能定义<code>HTML页面</code>,无法处理<code>JSON的定制</code>。Spring Boot中支持对<code>Error信息</code>的深度定制,接下来将从三个方面介绍深度定制:<code>自定义Error数据</code>、<code>自定义Error视图</code>以及<code>完全自定义</code>。</p>
<h6 id="1-自定义Error数据"><a href="#1-自定义Error数据" class="headerlink" title="1.自定义Error数据"></a>1.自定义Error数据</h6><p>自定义Error数据就是对<code>返回的数据进行自定义</code>。Spring Boot返回的Error信息一共有5条,分别是timestamp, status, error, message以及path,在BasicErrorController的errorHtml方法和error方法中,都是通过<code>getErrorAttributes</code>方法获取<code>Error信息</code>的。该方法最终会调用到<code>DefaultErrorAttributes类</code>的<code>getErrorAttributes</code>方法,而<code>DefaultErrorAttributes类</code>是在<code>ErrorMvcAutoConfiguration</code>中默认提供的.<code>ErrorMvcAutoConfiguration</code>类的<code>errorAttributes方法</code>源码如下:<br><img src="https://img-blog.csdnimg.cn/20210605064916580.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3Nhbmhld3V5YW5n,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>源码中可以看出,当系统<code>没有提供ErrorAttributes</code>时才会采用<code>DefaultErrorAttributes</code>.因此自定义错误提示时,<font color="#009688"><strong>只需要自己提供一个ErrorAttributes 可,而DefaultErroAttributes是ErrorAttributes的子类,因此只需要继承DefaultErrorAttributes即可</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyErrorAtributes</span> <span class="keyword">extends</span> <span class="title">DefaultErrorAttributes</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">getErrorAttributes</span><span class="params">(WebRequest webRequest, ErrorAttributeOptions options)</span> </span>&#123;</span><br><span class="line">        Map&lt;String, Object&gt; map = <span class="keyword">super</span>.getErrorAttributes(webRequest, options);</span><br><span class="line">        <span class="keyword">if</span> ((Integer) map.get(<span class="string">&quot;status&quot;</span>) == <span class="number">404</span>) &#123;</span><br><span class="line">            map.put(<span class="string">&quot;message&quot;</span>, <span class="string">&quot;页面不存在&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="2-自定义Error视图"><a href="#2-自定义Error视图" class="headerlink" title="2,自定义Error视图"></a>2,自定义Error视图</h6><p><code>Error视图</code>是展示给用户的页面,在<code>BasicErrorController </code>的<code>errorHtml</code>方法中调用<code>resolveErrorView</code>方法获取一个<code>ModelAndView</code>实例。 <code>resolveErrorView</code>方法是由<code>ErrorViewResolver</code>提供的,通过<code>ErrorMvcAutoConfiguration</code>类的源码可以看到Spring Boot默认采用的ErrorViewResolver是<code>DefaultErrorViewResolver</code>. ErrorMvcAutoConfiguration部分源码如下:<br><img src="https://img-blog.csdnimg.cn/20210605065831498.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3Nhbmhld3V5YW5n,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyErrorViewResolver</span> <span class="keyword">extends</span> <span class="title">DefaultErrorViewResolver</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyErrorViewResolver</span><span class="params">(ApplicationContext applicationContext, WebProperties.Resources resources)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(applicationContext, resources);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">resolveErrorView</span><span class="params">(HttpServletRequest request, HttpStatus status, Map&lt;String, Object&gt; model)</span> </span>&#123;</span><br><span class="line">        Map&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        map.putAll(model);</span><br><span class="line">        <span class="keyword">if</span> ((Integer) model.get(<span class="string">&quot;status&quot;</span>) == <span class="number">500</span>) &#123;</span><br><span class="line">            map.put(<span class="string">&quot;message&quot;</span>, <span class="string">&quot;服务器内部错误&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        ModelAndView view = <span class="keyword">new</span> ModelAndView(<span class="string">&quot;javaboy/999&quot;</span>,map);</span><br><span class="line">        <span class="keyword">return</span> view;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="3-完全自定义"><a href="#3-完全自定义" class="headerlink" title="3,完全自定义"></a>3,完全自定义</h6><p>前面提到的两种自定义方式都是对<code>BasicErrorController类</code>中的某个环节进行修补。查看Error自动化配置类<code>ErrorMvcAutoConfiguration</code>,读者可以发现<code>BasicErrorController</code> 身只是一个默认的配置,相关源码如下:<br><img src="https://img-blog.csdnimg.cn/20210605070734163.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3Nhbmhld3V5YW5n,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>从这段源码中可以看到,若开发者没有提供自己的<code>ErrorController</code>,则<code>Spring Boot</code>提供<code>BasicErrorController</code>作为默认的<code>ErrorController</code>,因此,如果开发者需要更加灵活地对<code>Error视图</code>和<code>数据</code>进行处理,那么只需要提供自己的<code>ErrorController</code>即可。提供自己的<code>ErrorController</code>有两种方式:一种是实现<code>ErrorController接口</code>,另一种是直接继承<code>BasicErrorController</code>,由于<code>ErorController</code>接口只提供一个待实现的方法,而<code>BasicErrorController</code>已经实现了很多功能,因此这里选择第二种方式,即通过继承<code>BasicErrorController</code>来实现自己的<code>ErrorController</code>.具体定义如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyErrorController</span> <span class="keyword">extends</span> <span class="title">BasicErrorController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyErrorController</span><span class="params">(ErrorAttributes errorAttributes,</span></span></span><br><span class="line"><span class="params"><span class="function">                             ServerProperties serverProperties,</span></span></span><br><span class="line"><span class="params"><span class="function">                             List&lt;ErrorViewResolver&gt; errorViewResolvers)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(errorAttributes, serverProperties.getError(), errorViewResolvers);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">errorHtml</span><span class="params">(HttpServletRequest request,</span></span></span><br><span class="line"><span class="params"><span class="function">                                  HttpServletResponse response)</span> </span>&#123;</span><br><span class="line">        HttpStatus status = getStatus(request);</span><br><span class="line">        Map&lt;String, Object&gt; model = getErrorAttributes(</span><br><span class="line">                request, isIncludeStackTrace(request, MediaType.TEXT_HTML));</span><br><span class="line">        model.put(<span class="string">&quot;custommsg&quot;</span>, <span class="string">&quot;出错啦！&quot;</span>);</span><br><span class="line">        ModelAndView modelAndView = <span class="keyword">new</span> ModelAndView(<span class="string">&quot;myErrorPage&quot;</span>, model, status);</span><br><span class="line">        <span class="keyword">return</span> modelAndView;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;Map&lt;String, Object&gt;&gt; error(HttpServletRequest request) &#123;</span><br><span class="line">        Map&lt;String, Object&gt; body = getErrorAttributes(request,</span><br><span class="line">                isIncludeStackTrace(request, MediaType.ALL));</span><br><span class="line">        body.put(<span class="string">&quot;custommsg&quot;</span>, <span class="string">&quot;出错啦！&quot;</span>);</span><br><span class="line">        HttpStatus status = getStatus(request);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity&lt;&gt;(body, status);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><font color="#009688"><strong>自定义<code>MyErrorController</code>继承自<code>BasicErrorController</code>并添加<code>@Controller</code>注解,将MyErrorController <code>注册</code>到<code>Spring MVC容器</code>中·</strong></li>
<li><font color="#009688"><strong>由于<code>BasicErrorController</code>没有无参构造方法,因此在创建<code>BasicErrorController</code>实例时需要<code>传递参数</code>,在<code>MyErrorController</code>的构造方法上添加<code>@Autowired注解</code>注入<code>所需参数</code>。</strong></li>
<li><font color="#009688"><strong>参考BasicErrorController中的实现,<code>重写</code>errorHtml和error方法,对Error的视图和数据进行充分的自定义。</strong></li>
</ul>
<h3 id="4-6-CORS支持"><a href="#4-6-CORS支持" class="headerlink" title="4.6 CORS支持"></a>4.6 CORS支持</h3><p><code>CORS (Cross-Origin Resource Sharing)</code>是由<code>w3C</code>制定的一种<code>跨域资源共享技术标准</code>,其目的就是为了解决<code>前端的跨域请求</code>。在Java EE开发中,最常见的前端跨域请求解决方案是<code>JSONP</code>,但是<code>JSONP只支持GET请求</code>,这是一个很大的缺陷,而<code>CORS则支持多种HTTP请求方法</code>。以<code>CORS</code><br><img src="https://img-blog.csdnimg.cn/20210605111218572.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3Nhbmhld3V5YW5n,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<blockquote>
<p>响应头中有一个<code>Access-Control-Allow-Origin</code>字段,用来<code>记录</code>可以<code>访问该资源的域</code>。当浏览器收到这样的响应头信息之后,提取出<code>Access-Control-Allow-Origin字段</code>中的值,发现该值包含<code>当前页面</code>所在的<code>域</code>,就知道这个跨域是被允许的,因此就不再对前端的跨域请求进行·限制。这就是GET请求的整个跨域流程,在这个过程中,前端请求的代码不需要修改,主.要是后端进行处理。这个流程主要是针对<code>GET</code>, <code>POST</code>以及<code>HEAD</code>请求,并且没有自定义请求头,如果用户发起一个<code>DELETE</code>请求、<code>PUT</code>请求或者<code>自定义</code>了请求头,流程就会稍微复杂一些。</p>
<p>以<code>DELETE</code>请求为例,当前端发起<code>一个DELETE请求</code>时,这个请求的处理会经过<code>两个步骤</code>。<br><code>第一步</code>:发送一个OPTIONS请求。代码如下:<br><img src="https://img-blog.csdnimg.cn/20210605112418558.png" alt="在这里插入图片描述"><br>这个请求将向服务端询问是否具备该资源的DELETE权限,服务端会给浏览器一个响应,代码如下:<br><img src="https://img-blog.csdnimg.cn/20210605112630801.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3Nhbmhld3V5YW5n,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>服务端给浏览器的响应, <code>Allow</code>头信息表示服务端支持的请求方法,这个请求相当于一个探测请求,当<code>浏览器</code>分析了请求头字段之后,知道<code>服务端支持本次请</code>求,则进入第二步。<br><code>第二步</code>:<code>发送DELETE请求</code>。接下来浏览器就会发送一个跨域的DELETE请求。</p>
</blockquote>
<p>在传统的Java EE开发中,可以通过过滤器统一配置,而Spring Boot中对此则提供了更加简洁的解决方案。在Spring Boot中配置CORS的步骤如下:</p>
<h6 id="3-配置跨域"><a href="#3-配置跨域" class="headerlink" title="3.配置跨域"></a>3.配置跨域</h6><p>跨域有两个地方可以配置:</p>
<ol>
<li>一个是直接在相应的请求方法上加注解: 这种配置方式是一种<code>细粒度的配置</code>.可以控制到每一个方法上。</li>
</ol>
<ul>
<li><code>@CrossOrigin</code>中的<code>value</code>表示支持的<code>域</code>,这里表示来自<code>http://ocalhost:8081</code>域的请求是<code>支持跨域</code>的.</li>
<li><code>maxAge</code>表示<code>探测请求</code>的<code>有效期</code>,在前面的讲解中,读者已经了解到对于<code>DELETE</code>, <code>PUT</code>请求或者有自定义头信息的请求,在执行过程中会先发送探测请求,<code>探测请求不用每次都发送,可以配置一个有效期,有效期过了之后才会发送探测请求</code>。这个属性默认是1800秒,即30分钟。</li>
<li><code>allowedHeaders</code>表示<code>允许的请求头</code>,<code> *</code>表示所有的<code>请求头都被允许</code>。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/book&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@PostMapping(&quot;/&quot;)</span></span><br><span class="line">    <span class="meta">@CrossOrigin(value = &quot;http://localhost:8081&quot;</span></span><br><span class="line"><span class="meta">            ,maxAge = 1800,allowedHeaders = &quot;*&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">addBook</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;receive:&quot;</span> + name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@CrossOrigin(value = &quot;http://localhost:8081&quot;</span></span><br><span class="line"><span class="meta">            ,maxAge = 1800,allowedHeaders = &quot;*&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">deleteBookById</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> String.valueOf(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>另一种全局配置,代码如下:<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addCorsMappings</span><span class="params">(CorsRegistry registry)</span> </span>&#123;</span><br><span class="line">    registry.addMapping(<span class="string">&quot;/**&quot;</span>)</span><br><span class="line">            .allowedHeaders(<span class="string">&quot;*&quot;</span>)</span><br><span class="line">            .allowedMethods(<span class="string">&quot;*&quot;</span>)</span><br><span class="line">            .allowedOrigins(<span class="string">&quot;http://localhost:8081&quot;</span>)</span><br><span class="line">            .maxAge(<span class="number">1800</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
全局配置需要自定义类实现<code>WebMvcConfigurer</code>接口,然后实现接口中的<code>addCorsMappings</code>方法。,在<code>addCorsMappings</code>方法中</li>
</ol>
<ul>
<li><code>addMapping</code>表示对哪种格式的请求路径进行跨域处理;</li>
<li><code>allowedHeaders</code>表示允许的请求头,默认允许所有的请求头信息;</li>
<li><code>allowedMethods</code>表示允许的请求方法,默认是GET. POST和HEAD,<code>*</code>表示支持所有的请求方法;</li>
<li>maxAge表示探测请求的有效期; </li>
<li>allowedOrigins表示支持的域。</li>
</ul>
<h3 id="4-7配置类与XML配置"><a href="#4-7配置类与XML配置" class="headerlink" title="4.7配置类与XML配置."></a>4.7配置类与XML配置.</h3><p><code>Spring Boot</code>推荐使用Java来完成相关的配置工作。在项目中,不建议将所有的配置放在一个配置类中,可以根据不同的需求提供不同的<code>配置类</code>,例如专门处理<code>Spring Security的配置类</code>、<code>提供Bean的配置类</code>、<code>Spring MVC相关的配置类</code>。这些配置类上都需要添加<code>@Configuration注解</code>。<br><code>@ComponentScan注解</code>会扫描所有的Spring组件,也包括<code>@Configuration</code>，<code>@ComponentScan</code>注解在项目入口类的<code>@Spring BootApplication</code>注解中已经提供,因此在实际项目中只需要按需提供相关配置类即可。Spring Boot中并不推荐使用XML配置,建议尽量用<code>Java配置代替XML配置</code>,本书中的案例都是以Java配置为主。</p>
<p>如果开发者需要<code>使用XML配置</code>,只需在<code>resources目录</code>下提供配置文件,然后通过<code>@ImportResource加载配置文件</code>即可。例如,有一个Book类如下:<br><img src="https://img-blog.csdnimg.cn/20210606200304202.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3Nhbmhld3V5YW5n,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h3 id="4-8注册拦截器"><a href="#4-8注册拦截器" class="headerlink" title="4.8注册拦截器"></a>4.8注册拦截器</h3><p><code>Spring MVC中</code>提供了<code>AOP风格</code>的拦截器,拥有更加精细的拦截处理能力。<code>Spring Boot</code>中拦.截器的注册更加方便,步骤如下:</p>
<h5 id="创建拦截器实现Handlerinterceptor接口"><a href="#创建拦截器实现Handlerinterceptor接口" class="headerlink" title="创建拦截器实现Handlerinterceptor接口"></a>创建拦截器实现Handlerinterceptor接口</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">ublic <span class="class"><span class="keyword">class</span> <span class="title">MyInterceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//该方法返回 false，请求将不再继续往下走</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;preHandle&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Controller 执行之后被调用</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;postHandle&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//preHandle 方法返回 true，afterCompletion 才会执行。</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;afterCompletion&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>拦截器中的方法将按<code>preHandle</code>-<code>Controller</code>-<code>postHandle</code>-<code>afterCompletion</code>的顺序执行。注意,<strong>只有preHandle方法返回true时后面的方法才会执行</strong>。当拦截器链内存在<code>多个拦截器时</code>, <code>postHandler在拦截器链内的所有拦截器返回成功时才会调用</code>,而<code>afterCompletion只有preHandle返回true才调用</code>,但若拦截器链内的第一个拦截器的<code>preHandle</code>方法返回<code>false</code>,则后面的方法都不会执行。</p>
<h5 id="配置拦截器。定义配置类进行拦截器的配置-代码如下"><a href="#配置拦截器。定义配置类进行拦截器的配置-代码如下" class="headerlink" title="配置拦截器。定义配置类进行拦截器的配置,代码如下:"></a>配置拦截器。定义配置类进行拦截器的配置,代码如下:</h5><p>自定义类实现<code>webMveConfigurer接口</code>,实现接口中的<code>addInterceptors方法</code>。其中,<code>addPathPatterns 表示拦截路径</code>, <code>excludePathPatterns表示排除的路径</code>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebMvcConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> </span>&#123;</span><br><span class="line">        registry.addInterceptor(<span class="keyword">new</span> MyInterceptor()).addPathPatterns(<span class="string">&quot;/**&quot;</span>).excludePathPatterns(<span class="string">&quot;/hello&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-9启动系统任务"><a href="#4-9启动系统任务" class="headerlink" title="4.9启动系统任务"></a>4.9启动系统任务</h3><p>有一些特殊的任务需要在<code>系统启动时</code>执行,例如<code>配置文件加载</code>、<code>数据库初始化</code>等操作。如果没有<code>使用Spring Boot</code>,这些问题可以在<code>Listener</code>中解决。Spring Boot对此提供了两种解决方案:<code>CommandLineRunner</code>和<code>ApplicationRunner</code>. <code>CommandLineRunner</code>和<code>ApplicationRunner</code>基本一致,差别主要体现在参数上。</p>
<h5 id="4-9-1-CommandLineRunner"><a href="#4-9-1-CommandLineRunner" class="headerlink" title="4.9.1 CommandLineRunner"></a>4.9.1 CommandLineRunner</h5><p>Spring Boot项目在启动时会遍历所有<code>CommandLineRunner</code>的实现类并调用其中的run方法,如果整个系统中有多个<code>CommandLineRunner的实现类</code>,那么可以使用<code>@Order注解</code>对这些实现类的调用顺序进行排序。<br><img src="https://img-blog.csdnimg.cn/20210606203029267.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3Nhbmhld3V5YW5n,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h5 id="4-9-2-ApplicationRunner"><a href="#4-9-2-ApplicationRunner" class="headerlink" title="4.9.2 ApplicationRunner"></a>4.9.2 ApplicationRunner</h5><p><code>ApplicationRunner</code>的用法和<code>CommandLineRunner</code>基本一致,区别主要体现在<code>run方法</code>的参数上。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Order(98)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyApplicationRunner</span> <span class="keyword">implements</span> <span class="title">ApplicationRunner</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(ApplicationArguments args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//获取没有键的参数，获取到的值和 commandlinerunner 一致</span></span><br><span class="line">        List&lt;String&gt; nonOptionArgs = args.getNonOptionArgs();</span><br><span class="line">        System.out.println(<span class="string">&quot;nonOptionArgs1 = &quot;</span> + nonOptionArgs);</span><br><span class="line">        Set&lt;String&gt; optionNames = args.getOptionNames();</span><br><span class="line">        <span class="keyword">for</span> (String optionName : optionNames) &#123;</span><br><span class="line">            System.out.println(optionName + <span class="string">&quot;-1-&gt;&quot;</span> + args.getOptionValues(optionName));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//获取命令行中的所有参数</span></span><br><span class="line">        String[] sourceArgs = args.getSourceArgs();</span><br><span class="line">        System.out.println(<span class="string">&quot;sourceArgs1 = &quot;</span> + Arrays.toString(sourceArgs));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Order(97)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyApplicationRunner2</span> <span class="keyword">implements</span> <span class="title">ApplicationRunner</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(ApplicationArguments args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//获取没有键的参数，获取到的值和 commandlinerunner 一致</span></span><br><span class="line">        List&lt;String&gt; nonOptionArgs = args.getNonOptionArgs();</span><br><span class="line">        System.out.println(<span class="string">&quot;nonOptionArgs2 = &quot;</span> + nonOptionArgs);</span><br><span class="line">        Set&lt;String&gt; optionNames = args.getOptionNames();</span><br><span class="line">        <span class="keyword">for</span> (String optionName : optionNames) &#123;</span><br><span class="line">            System.out.println(optionName + <span class="string">&quot;-2-&gt;&quot;</span> + args.getOptionValues(optionName));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//获取命令行中的所有参数</span></span><br><span class="line">        String[] sourceArgs = args.getSourceArgs();</span><br><span class="line">        System.out.println(<span class="string">&quot;sourceArgs2 = &quot;</span> + Arrays.toString(sourceArgs));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>@Order注解</code>依然是用来描述执行顺序的,数字越小越优先执行。不同于CommandLineRunner中run方法的String数组参数,这里<code>run方法</code>的参数是一个<code>ApplicationArguments</code>对象,如果想从<code>ApplicationArguments</code>对象中获取入口类中1main方法1接收的参数,调用<code>ApplicationArguments</code>中的<code>getNonOptionArgs方法</code>即可. <code>ApplicationArguments</code>中的<code>getOptionNames方法</code>用来获取项目启动命令行中<code>参数的key</code>,例如将本项目打成<code>jar包</code>,运行<code>java-jar xxx.jar-name-Michael</code>命令来启动项目,此时<code>getOptionNames</code>方法获取到的就是name,而<code>getOptionValues</code>方法则是获取相应的<code>value</code>.</p>
<h3 id="4-10整合Servlet-Filter和Listener"><a href="#4-10整合Servlet-Filter和Listener" class="headerlink" title="4.10整合Servlet, Filter和Listener."></a>4.10整合Servlet, Filter和Listener.</h3><p>Spring Boot中对于整合这些基本的Web组件也提供了很好的支持。在一个Spring Boot Web项目中添加如下三个组件:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebFilter(&quot;/*&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig filterConfig)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;MyFilter&gt;&gt;&gt;init&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;MyFilter&gt;&gt;&gt;doFilter&quot;</span>);</span><br><span class="line">        chain.doFilter(request,response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;MyFilter&gt;&gt;&gt;destroy&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebListener</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyListener</span> <span class="keyword">implements</span> <span class="title">ServletRequestListener</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">requestDestroyed</span><span class="params">(ServletRequestEvent sre)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;MyListener&gt;&gt;&gt;requestDestroyed&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">requestInitialized</span><span class="params">(ServletRequestEvent sre)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;MyListener&gt;&gt;&gt;requestInitialized&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/my&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span>&#123;</span><br><span class="line">        doPost(req,resp);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;name&gt;&gt;&gt;&quot;</span>+req.getParameter(<span class="string">&quot;name&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>启动类需要的配置：<br>在项目入口类上添加<code>@ServletComponentScan注解</code>,实现对<code>Servlet</code>， <code>Filter</code>以及<code>Listener</code>的扫描,代码如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@ServletComponentScan(&quot;org.javaboy.filter&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FilterApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(FilterApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-11-路径映射"><a href="#4-11-路径映射" class="headerlink" title="4.11 路径映射."></a>4.11 路径映射.</h3><p>有一些页面在<code>控制器</code>中不需要加载数据,只是完成·<code>简单的跳转</code>,对于这种页面,可以<code>直接配置路径映射</code>,<code>提高访问速度</code>。例如,有两个<code>Thymeleaf做模板</code>的页面<code>login.html</code>和<code>index.tml</code>,直接在MVC配置中重写<code>addViewControllers</code>方法配置映射关系即可:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebMvcConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> </span>&#123;</span><br><span class="line"><span class="comment">//        registry.addViewController(&quot;/02&quot;).setViewName(&quot;02&quot;);</span></span><br><span class="line">        registry.addViewController(<span class="string">&quot;/02&quot;</span>).setViewName(<span class="string">&quot;02&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-12-配置AOP"><a href="#4-12-配置AOP" class="headerlink" title="4.12 配置AOP"></a>4.12 配置AOP</h3><h5 id="4-12-1-AOP简介"><a href="#4-12-1-AOP简介" class="headerlink" title="4.12.1 AOP简介"></a>4.12.1 AOP简介</h5><h6 id="AOP中的相关知识"><a href="#AOP中的相关知识" class="headerlink" title="AOP中的相关知识"></a><a target="_blank" rel="noopener" href="https://blog.csdn.net/sanhewuyang/article/details/108943497">AOP中的相关知识</a></h6><h5 id="4-12-2-Spring-Boot支持"><a href="#4-12-2-Spring-Boot支持" class="headerlink" title="4.12.2 Spring Boot支持"></a>4.12.2 Spring Boot支持</h5><p><code>Spring Boot</code>在<code>Spring</code>的基础上对<code>AOP</code>的配置提供了<code>自动化配置</code>解决方案<code>spring-boot-starter-aop</code>,使开发者能够更加便捷地在Spring Boot项目中使用AOP,配置步骤如下。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogAspect</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(* org.javaboy.aop.service.*.*(..))&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pc1</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before(&quot;pc1()&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">(JoinPoint jp)</span> </span>&#123;</span><br><span class="line">        String name = jp.getSignature().getName();</span><br><span class="line">        System.out.println(name + <span class="string">&quot; 方法开始执行了...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@After(&quot;pc1()&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">after</span><span class="params">(JoinPoint jp)</span> </span>&#123;</span><br><span class="line">        String name = jp.getSignature().getName();</span><br><span class="line">        System.out.println(name + <span class="string">&quot; 方法执行结束了...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterReturning(value = &quot;pc1()&quot;, returning = &quot;s&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterReturning</span><span class="params">(JoinPoint jp, String s)</span> </span>&#123;</span><br><span class="line">        String name = jp.getSignature().getName();</span><br><span class="line">        System.out.println(name + <span class="string">&quot; 方法的返回值是 &quot;</span> + s);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterThrowing(value = &quot;pc1()&quot;, throwing = &quot;e&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterThrowing</span><span class="params">(JoinPoint jp, Exception e)</span> </span>&#123;</span><br><span class="line">        String name = jp.getSignature().getName();</span><br><span class="line">        System.out.println(name + <span class="string">&quot; 方法抛出了异常 &quot;</span> + e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Around(&quot;pc1()&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">around</span><span class="params">(ProceedingJoinPoint pjp)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//类似于反射中的 invoke 方法</span></span><br><span class="line">            Object proceed = pjp.proceed();</span><br><span class="line">            <span class="keyword">return</span> proceed;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable throwable) &#123;</span><br><span class="line">            throwable.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="4-13-其他"><a href="#4-13-其他" class="headerlink" title="4.13 其他"></a>4.13 其他</h3><h5 id="4-13-1-自定义欢迎页"><a href="#4-13-1-自定义欢迎页" class="headerlink" title="4.13.1 自定义欢迎页"></a>4.13.1 自定义欢迎页</h5><p>Spring Boot项目在启动后,首先会去<code>静态资源</code>路径下查找<code>index.html</code>作为<code>首页文件</code>,若查找不到,则会去查找动态的<code>index文件</code>作为首页文件.</p>
<ul>
<li>使用<code>静态的index.html</code>页面作为项目首页,那么只需在<code>resources/static</code>目录下创建<code>index.html</code>文件即可。</li>
<li>若想使用动态页面作为项目首页,则需在<code>resources/templates</code>目录下创建<code>index.html </code>(使用Thymeleaf模板)或者<code>index.fl (使用FreeMarker模板)</code> ,然后在<code>Controller中返回逻辑视图名</code>,代码如下:</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebMvcConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> </span>&#123;</span><br><span class="line">        registry.addViewController(<span class="string">&quot;/index&quot;</span>).setViewName(<span class="string">&quot;index&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="4-13-2-自定义favicon"><a href="#4-13-2-自定义favicon" class="headerlink" title="4.13.2 自定义favicon"></a>4.13.2 自定义favicon</h5><p><code>favicon.ico</code>是浏览器选项卡左上角的图标,可以放在<code>静态资源路径</code>下或者<code>类路径</code>下,静态资源路径下的<code>favicon.ico</code>优先级<code>高于</code>类路径下的<code>favicon.ico</code>。<br><strong>在线转换网站http:&#x2F;inaconvert.com&#x2F;cn&#x2F;convert-to-ico.php将一张普通图片转为.ico图</strong></p>
<h5 id="4-13-3-除去某个自动配置"><a href="#4-13-3-除去某个自动配置" class="headerlink" title="4.13.3 除去某个自动配置"></a>4.13.3 除去某个自动配置</h5><p><code>Spring Boot</code>中提供了大量的自动化配置类,例如上文提到过的<code>ErrorMvcAutoConfiguration</code>、<code>ThymeleafAutoConfiguration</code>,<code> FreeMarkerAutoConfiguration</code>, <code>MultipartAutoConfiguration</code>等,这些<code>自动化配置</code>可以减少相应<code>操作的配置</code>,达到开箱即用的效果。在<code>Spring Boot</code>的入口类上有一个<code>@Spring BootApplication</code>注解。该注解是一个组合注解, 由<code>@Spring BootConfiguration</code>、<code>@EnableAutoConfiguration</code>以及<code>@ComponentScan</code>组成,其中<code>@EnableAutoConfiguration</code>注解开启自动化配置,相关的自动化配置类就会被使用。如果开发者不想使用某个自动化配置,按如下方式除去相关配置即可.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration(exclude = &#123;ErrorMvcAutoConfiguration.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OtherApplication</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		SpringApplication.run(OtherApplication.class, args);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="4-13-4-使用类型转化器"><a href="#4-13-4-使用类型转化器" class="headerlink" title="4.13.4 使用类型转化器"></a>4.13.4 使用类型转化器</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyDateConverter</span> <span class="keyword">implements</span> <span class="title">Converter</span>&lt;<span class="title">String</span>, <span class="title">Date</span>&gt; </span>&#123;</span><br><span class="line">    SimpleDateFormat sdf = <span class="keyword">new</span> SimpleDateFormat(<span class="string">&quot;yyyy-MM-dd&quot;</span>);</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Date <span class="title">convert</span><span class="params">(String source)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> sdf.parse(source);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ParseException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="第5章Spring-Boot整合持久层技术"><a href="#第5章Spring-Boot整合持久层技术" class="headerlink" title="第5章Spring Boot整合持久层技术."></a>第5章Spring Boot整合持久层技术.</h2><p> <code>Spring Boot</code>中对常见的持久层框架都提供了自动化配置,例如<code>JabcTemplate</code>, <code>JPA</code>等, <code>MyBatis</code>的<code>自动化配置</code>则是MyBatis官方提供的。</p>
<h3 id="5-1-整合JdbcTemplate"><a href="#5-1-整合JdbcTemplate" class="headerlink" title="5.1 整合JdbcTemplate"></a>5.1 整合JdbcTemplate</h3><p><code>JdbcTemplate</code>是<code>Spring</code>提供的一套<code>JDBC模板框架</code>,利用<code>AOP</code>技术来解决直接使用<code>JDBC时大量重复代码</code>的问题。<code>JdbcTemplate</code>虽然没有<code>MyBatis</code>那么灵活,但是比直接使用<code>JDBC</code>要方便很多。<code>Spring Boot</code>中对<code>JdbcTemplate</code>的使用提供了<code>自动化配置类JdbcTemplateConfiguration</code>,部分源码如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(&#123; DataSource.class, JdbcTemplate.class &#125;)</span></span><br><span class="line"><span class="meta">@ConditionalOnSingleCandidate(DataSource.class)</span></span><br><span class="line"><span class="meta">@AutoConfigureAfter(DataSourceAutoConfiguration.class)</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(JdbcProperties.class)</span></span><br><span class="line"><span class="meta">@Import(&#123; DatabaseInitializationDependencyConfigurer.class, JdbcTemplateConfiguration.class,</span></span><br><span class="line"><span class="meta">		NamedParameterJdbcTemplateConfiguration.class &#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdbcTemplateAutoConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(JdbcOperations.class)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">JdbcTemplateConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="meta">@Primary</span></span><br><span class="line">	<span class="function">JdbcTemplate <span class="title">jdbcTemplate</span><span class="params">(DataSource dataSource, JdbcProperties properties)</span> </span>&#123;</span><br><span class="line">		JdbcTemplate jdbcTemplate = <span class="keyword">new</span> JdbcTemplate(dataSource);</span><br><span class="line">		JdbcProperties.Template template = properties.getTemplate();</span><br><span class="line">		jdbcTemplate.setFetchSize(template.getFetchSize());</span><br><span class="line">		jdbcTemplate.setMaxRows(template.getMaxRows());</span><br><span class="line">		<span class="keyword">if</span> (template.getQueryTimeout() != <span class="keyword">null</span>) &#123;</span><br><span class="line">			jdbcTemplate.setQueryTimeout((<span class="keyword">int</span>) template.getQueryTimeout().getSeconds());</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> jdbcTemplate;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>需要的依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>spring-bool-starter-jdbc</code> 中提供了<code>spring-jdbc</code>,另外还加入了<code>数据库驱动依赖</code>和<code>数据库连接池依赖</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 数据源1</span></span><br><span class="line">spring.datasource.one.type=com.alibaba.druid.pool.DruidDataSource</span><br><span class="line">spring.datasource.one.username=root</span><br><span class="line">spring.datasource.one.password=123</span><br><span class="line">spring.datasource.one.url=jdbc:mysql:///chapter05-1</span><br></pre></td></tr></table></figure>
<ul>
<li>创建BookDao,注入<code>JdbcTemplate</code>.由于已经添加了<code>spring-jdbc</code>相关的依赖, <code>JabcTemplate</code>会被自动<code>注册</code>到<code>Spring容器</code>中,因此这里可以直接注入JdbcTemplate使用。</li>
<li>在<code>JdbcTemplate</code>中,<code>增删改</code>三种类型的操作主要使用<code>update</code>和<code>batchUpdate</code>方法来完成.<code>query</code>和<code>queryForObject</code>方法主要用来完成<code>查询</code>功能。另外,还有<code>execute</code>方法可以用来执行任意的<code>sQL</code>. <code>call</code>方法用来调用<code>存储过程</code>等。</li>
<li>在执行查询操作时,需要有一个<code>RowMapper</code>将查询出来的<code>列和实体类</code>中的属性-一对应起来。如果<code>列名</code>和<code>属性名</code>都是相同的,那么可以直接使用<code>BeanPropertyRowMapper</code>;如果列名和属性名不同,就需要开发者自己实现<code>RowMapper接口</code>,将列和实体类属性-一对应起来。<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookDao</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    JdbcTemplate jdbcTemplate;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">addBook</span><span class="params">(Book book)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> jdbcTemplate.update(<span class="string">&quot;INSERT INTO book(name,author) VALUES (?,?)&quot;</span>,</span><br><span class="line">                book.getName(), book.getAuthor());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">updateBook</span><span class="params">(Book book)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> jdbcTemplate.update(<span class="string">&quot;UPDATE book SET name=?,author=? WHERE id=?&quot;</span>,</span><br><span class="line">                book.getName(), book.getAuthor(), book.getId());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">deleteBookById</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> jdbcTemplate.update(<span class="string">&quot;DELETE FROM book WHERE id=?&quot;</span>, id);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Book <span class="title">getBookById</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> jdbcTemplate.queryForObject(<span class="string">&quot;select * from book where id=?&quot;</span>,</span><br><span class="line">                <span class="keyword">new</span> BeanPropertyRowMapper&lt;&gt;(Book.class), id);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Book&gt; <span class="title">getAllBooks</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> jdbcTemplate.query(<span class="string">&quot;select * from book&quot;</span>,</span><br><span class="line">                <span class="keyword">new</span> BeanPropertyRowMapper&lt;&gt;(Book.class));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">addUser2</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">       GeneratedKeyHolder keyHolder = <span class="keyword">new</span> GeneratedKeyHolder();</span><br><span class="line">       <span class="keyword">int</span> result = jdbcTemplate.update(<span class="keyword">new</span> PreparedStatementCreator() &#123;</span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> PreparedStatement <span class="title">createPreparedStatement</span><span class="params">(Connection connection)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">               PreparedStatement ps = connection.prepareStatement(<span class="string">&quot;insert into user (username,address) values(?,?)&quot;</span>, Statement.RETURN_GENERATED_KEYS);</span><br><span class="line">               ps.setString(<span class="number">1</span>, user.getUsername());</span><br><span class="line">               ps.setString(<span class="number">2</span>, user.getAddress());</span><br><span class="line">               <span class="keyword">return</span> ps;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;, keyHolder);</span><br><span class="line">       user.setId(keyHolder.getKey().longValue());</span><br><span class="line">       <span class="keyword">return</span> result;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">getAllUsers</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;User&gt; list = jdbcTemplate.query(<span class="string">&quot;select * from user&quot;</span>, <span class="keyword">new</span> RowMapper&lt;User&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> User <span class="title">mapRow</span><span class="params">(ResultSet resultSet, <span class="keyword">int</span> i)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">                String username = resultSet.getString(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">                String address = resultSet.getString(<span class="string">&quot;address&quot;</span>);</span><br><span class="line">                <span class="keyword">long</span> id = resultSet.getLong(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">                User user = <span class="keyword">new</span> User();</span><br><span class="line">                user.setId(id);</span><br><span class="line">                user.setUsername(username);</span><br><span class="line">                user.setAddress(address);</span><br><span class="line">                <span class="keyword">return</span> user;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="5-2整合MyBatis"><a href="#5-2整合MyBatis" class="headerlink" title="5.2整合MyBatis"></a>5.2整合MyBatis</h3><p><code>MyBatis</code>是一款优秀的持久层框架,原名叫作<code>iBaits</code>, 2010年由ApacheSoftwareFoundation迁移到<code>Google Code</code>并改名为<code>MyBatis,</code> 2013年又迁移到<code>GitHub</code>上。<code>MyBatis</code>支持定制化<code>SQL</code>、<code>存储过程</code>以及<code>高级映射</code>。<code>MyBatis</code>几乎避免了所有的<code>JDBC</code>代码手动设置参数以及获取结果集。在传统的<code>SSM</code>框架整合中,使用MyBatis需要大量的<code>XML</code>配置,而在Spring Boot中, MyBatis官方提供了一套自动化配置方案,可以做到MyBatis开箱即用。具体使用步骤如下。</p>
<ul>
<li>添加MyBatis依赖、数据库驱动依赖以及数据库连接池<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">     <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.9<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">spring.datasource.type=com.alibaba.druid.pool.DruidDataSource</span><br><span class="line">spring.datasource.url=jdbc:mysql:///chapter05</span><br><span class="line">spring.datasource.username=root</span><br><span class="line">spring.datasource.password=123</span><br></pre></td></tr></table></figure></li>
</ul>
<h6 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@MapperScan(basePackages = &quot;org.javaboy.mybatis.mapper&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MybatisApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(MybatisApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>一种简单的方式是在配置类上添加<code>@MapperScan(&quot;org.sang.mapper&quot;)</code>注解,表示扫描<code>org.sang.mapper</code>包下的所有接口作为<code>Mapper</code>,这样就不需要在每个接口上配置<code>@Mapper</code>注解了。<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Select(&quot;select * from user where id=#&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function">User <span class="title">getUserById</span><span class="params">(Long id)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Results(&#123;</span></span><br><span class="line"><span class="meta">            @Result(property = &quot;address&quot;,column = &quot;address1&quot;)</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="meta">@Select(&quot;select * from user&quot;)</span></span><br><span class="line">    <span class="function">List&lt;User&gt; <span class="title">getAllUsers</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Insert(&quot;insert into user (username,address1) values (#&#123;username&#125;,#&#123;address&#125;)&quot;)</span></span><br><span class="line">    <span class="meta">@SelectKey(statement = &quot;select last_insert_id()&quot;,keyProperty = &quot;id&quot;,before = false,resultType = Long.class)</span></span><br><span class="line">    <span class="function">Integer <span class="title">addUser</span><span class="params">(User user)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Delete(&quot;delete from user where id=#&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function">Integer <span class="title">deleteById</span><span class="params">(Long id)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Update(&quot;update user set username=#&#123;username&#125; where id=#&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function">Integer <span class="title">updateById</span><span class="params">(String username, Long id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h5><p>指明该类是一个<code>Mapper</code>:第一种如前面的代码所示,在<code>BookMapper</code>上添加@Mapper注解,表明该接口是一个MyBatis中的Mapper,这种方式需要在每一个Mapper上都添加注解;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BookMapper</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">addBook</span><span class="params">(Book book)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">deleteBookById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">updateBookById</span><span class="params">(Book book)</span></span>;</span><br><span class="line">    <span class="function">Book <span class="title">getBookById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line">    <span class="function">List&lt;Book&gt; <span class="title">getAllBooks</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;org.sang.mapper.BookMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;addBook&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;org.sang.model.Book&quot;</span>&gt;</span></span><br><span class="line">    INSERT INTO book(name,author) VALUES (#&#123;name&#125;,#&#123;author&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteBookById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">        DELETE FROM book WHERE id=#&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateBookById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;org.sang.model.Book&quot;</span>&gt;</span></span><br><span class="line">        UPDATE book set name=#&#123;name&#125;,author=#&#123;author&#125; WHERE id=#&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getBookById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;org.sang.model.Book&quot;</span>&gt;</span></span><br><span class="line">        SELECT * FROM book WHERE id=#&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getAllBooks&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;org.sang.model.Book&quot;</span>&gt;</span></span><br><span class="line">        SELECT * FROM book</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>针对<code>BookMapper</code>接口中的每一个方法都在<code>BookMapper.xml</code>中列出了实现</li>
<li><code>#&#123;&#125;</code>用来代替接口中的参数,实体类中的属性可以直接通过<code>#(实体类属性名&#125;</code>获取。</li>
</ul>
<h6 id="配置pom-xml文件"><a href="#配置pom-xml文件" class="headerlink" title="配置pom.xml文件"></a>配置pom.xml文件</h6><p>在<code>Maven</code>工程中, <code>XML</code>配置文件建议写在<code>resources</code>目录下(同包同级目录),当<code>Mapper.xml</code>文件写在包下, ·<code>Maven</code>在运行时会<code>忽略</code>包下的<code>XML文件</code>,因此需要在<code>pom.xml</code>文件中重新指明<code>资源文件位置</code>,配置如下:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/java<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line">		......</span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span>		</span><br></pre></td></tr></table></figure>
<p>也可以自定义<code>resources</code>下<code>mapper</code>位置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mybatis.mapper-locations=classpath:mapper/*.xml</span><br></pre></td></tr></table></figure>
<h3 id="5-3整合Spring-Data-JPA"><a href="#5-3整合Spring-Data-JPA" class="headerlink" title="5.3整合Spring Data JPA"></a>5.3整合Spring Data JPA</h3><p><code>JPA (Java Persistence API)</code>和<code>Spring Data</code>是两个范畴的概念。<code>JPA</code>则是一种<code>ORM</code>规范, <code>JPA</code>和<code>Hibernate</code>的关系就像<code>JDBC</code>与<code>JDBC驱动</code>的关系,即<code>JPA</code>制定了<code>ORM</code>规范,而<code>Hibernate</code>是这些规范的实现(事实上,是先有Hibernate后有JPA, JPA规范的起草者也是Hibernate的作者) ,因此从功能上来说, <code>JPA</code>相当于<code>Hibernate</code>的一个子集。</p>
<p><code>Spring Data</code>是<code>Spring</code>的一个子项目,致力于<code>简化数据库访问</code>,通过<code>规范的方法名称</code>来分析开发者的意图,进而减少数据库访问层的代码量。<code>Spring Data</code>不仅支持<code>关系型数据库</code>,也支持<code>非关系型数据库</code>。<code>Spring Data JPA</code>可以有效	<code>简化	</code>关系型数据库访问代码。Spring Boot整合<code>Spring Data JPA</code>的步骤如下:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.9<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">spring.datasource.type=com.alibaba.druid.pool.DruidDataSource</span><br><span class="line">spring.datasource.url=jdbc:mysql:///jpa</span><br><span class="line">spring.datasource.username=root</span><br><span class="line">spring.datasource.password=123</span><br><span class="line">spring.jpa.show-sql=<span class="literal">true</span></span><br><span class="line">spring.jpa.database=mysql</span><br><span class="line">spring.jpa.hibernate.ddl-auto=update</span><br><span class="line">spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQL57Dialect</span><br><span class="line"><span class="comment">#spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQL57InnoDBDialect</span></span><br><span class="line"><span class="comment">#spring.jpa.properties.database=mysql</span></span><br><span class="line"><span class="comment">#spring.jpa.properties.hibernate.hbm2ddl.auto=update</span></span><br><span class="line"><span class="comment">#spring.jpa.properties.show-sql= true</span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>@Entity</code>注解表示该类是一个实体类,在项目启动时会根据该类自动生成一张表,表的名称即<code>@Entity</code>注解中<code>name</code>的值,如果不配置name,默认表名为类名。所有的实体类都要有主键, </li>
<li><code>@ld</code>注解表示该属性是一个主键, <code>@GeneratedValue</code>注解表示主键自动生成, <code>strategy</code>则表示主键的生成策略。默认情况下,生成的表中字段的名称就是实体类中属性的名称,通过<code>@Column</code>注解可以定制生成的字段的属性, <code>name</code>表示该属性对应的数据表中字段的名称, <code>nullable</code>表示该字段非空。</li>
<li><code>@Transient</code>注解表示在生成数据库中的表时,该属性被忽略,即不生成对应的字段。<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity(name = &quot;t_book&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Book</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="meta">@Column(name = &quot;book_name&quot;,nullable = false)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String author;</span><br><span class="line">    <span class="keyword">private</span> Float price;</span><br><span class="line">    <span class="meta">@Transient</span></span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line">    <span class="comment">//省略getter/setter</span></span><br><span class="line">&#125;   </span><br></pre></td></tr></table></figure></li>
<li>自定义<code>BookDao</code>继承自<code>JpaRepository</code>. <code>JpaRepository</code>中提供了一些<code>基本的数据操作方法</code>,有基本的增删改查、分页查询、排序查询等。</li>
<li>第<code>2行</code>定义的方法表示查询以某个<code>字符开始</code>的所有书。·</li>
<li>第<code>3行</code>定义的方法表示查询<code>单价大于某个值</code>的所有书。</li>
<li>在<code>Spring Data JPA</code>中,只要方法的定义符合既定规范, <code>Spring Data</code>就能分析出开发者的意图,从而<code>避免开发者定义SQL</code>所谓的既定规范,就是一定的<code>方法命名规则</code>。<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BookDao</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">Book</span>,<span class="title">Integer</span>&gt;</span>&#123;</span><br><span class="line">    <span class="function">List&lt;Book&gt; <span class="title">getBooksByAuthorStartingWith</span><span class="params">(String author)</span></span>;</span><br><span class="line">    <span class="function">List&lt;Book&gt; <span class="title">getBooksByPriceGreaterThan</span><span class="params">(Float price)</span></span>;</span><br><span class="line">    <span class="meta">@Query(value = &quot;select * from t_book where id=(select max(id) from t_book)&quot;,nativeQuery = true)</span></span><br><span class="line">    <span class="function">Book <span class="title">getMaxIdBook</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="meta">@Query(&quot;select b from t_book b where b.id&gt;:id and b.author=:author&quot;)</span></span><br><span class="line">    <span class="function">List&lt;Book&gt; <span class="title">getBookByIdAndAuthor</span><span class="params">(<span class="meta">@Param(&quot;author&quot;)</span> String author, <span class="meta">@Param(&quot;id&quot;)</span> Integer id)</span></span>;</span><br><span class="line">    <span class="meta">@Query(&quot;select b from t_book b where b.id&lt;?2 and b.name like %?1%&quot;)</span></span><br><span class="line">    <span class="function">List&lt;Book&gt; <span class="title">getBooksByIdAndName</span><span class="params">(String name, Integer id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BookDao</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">Book</span>,<span class="title">Long</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function">List&lt;Book&gt; <span class="title">getBookByAuthorIs</span><span class="params">(String author)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Query(nativeQuery = true,value = &quot;select * from t_book where id=(select max(id) from t_book)&quot;)</span></span><br><span class="line">    <span class="function">Book <span class="title">maxIdBook</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Query(&quot;update t_book set b_name=:name where id=:id&quot;)</span></span><br><span class="line">    <span class="meta">@Modifying</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">updateBookById</span><span class="params">(String name, Long id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
支持的命名规则如表所示:<br><img src="https://img-blog.csdnimg.cn/20210618024953534.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3Nhbmhld3V5YW5n,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>部分方法直接由JpaRepository<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    BookDao bookDao;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addBook</span><span class="params">(Book book)</span> </span>&#123;</span><br><span class="line">        bookDao.save(book);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Page&lt;Book&gt; <span class="title">getBookByPage</span><span class="params">(Pageable pageable)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> bookDao.findAll(pageable);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Book&gt; <span class="title">getBooksByAuthorStartingWith</span><span class="params">(String author)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> bookDao.getBooksByAuthorStartingWith(author);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Book&gt; <span class="title">getBooksByPriceGreaterThan</span><span class="params">(Float price)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> bookDao.getBooksByPriceGreaterThan(price);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Book <span class="title">getMaxIdBook</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> bookDao.getMaxIdBook();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Book&gt; <span class="title">getBookByIdAndAuthor</span><span class="params">(String author, Integer id)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> bookDao.getBookByIdAndAuthor(author, id);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Book&gt; <span class="title">getBooksByIdAndName</span><span class="params">(String name, Integer id)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> bookDao.getBooksByIdAndName(name, id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/findAll&quot;)</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       PageRequest pageable = PageRequest.of(<span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">       Page&lt;Book&gt; page = bookService.getBookByPage(pageable);</span><br><span class="line">       System.out.println(<span class="string">&quot;总页数:&quot;</span>+page.getTotalPages());</span><br><span class="line">       System.out.println(<span class="string">&quot;总记录数:&quot;</span>+page.getTotalElements());</span><br><span class="line">       System.out.println(<span class="string">&quot;查询结果:&quot;</span>+page.getContent());</span><br><span class="line">       System.out.println(<span class="string">&quot;当前页数:&quot;</span>+(page.getNumber()+<span class="number">1</span>));</span><br><span class="line">       System.out.println(<span class="string">&quot;当前页记录数:&quot;</span>+page.getNumberOfElements());</span><br><span class="line">       System.out.println(<span class="string">&quot;每页记录数:&quot;</span>+page.getSize());</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="5-4多数据源"><a href="#5-4多数据源" class="headerlink" title="5.4多数据源."></a>5.4多数据源.</h3><p>所谓<code>多数据源</code>,就是一个<code>Java EE</code>项目中采用了<code>不同数据库实例</code>中的<code>多个库</code>,或者同一个数据库实例中多个不同的库。一般来说,采用<code>MyCat</code>等<code>分布式数据库中间件</code>是比较好的解决方案,这样可以把<code>数据库读写分离、分库分表、备份</code>等操作交给中间件去做, Java代码只需要专注于业务即可。不过,这并不意味着无法使用Java代码解决类似的问题,在<code>Spring Framework</code>中就可以配置多数据源, <code>Spring Boot</code>继承其衣钵,只不过配置方式有所变化。</p>
<h5 id="5-4-1-JdbcTemplate多数据源"><a href="#5-4-1-JdbcTemplate多数据源" class="headerlink" title="5.4.1 JdbcTemplate多数据源"></a>5.4.1 JdbcTemplate多数据源</h5><p><code>JdbcTemplate</code>多数据源的配置是比较简单的,因为一个<code>JdbcTemplate</code>对应一个<code>DataSource</code>,开发者只需要手动提供多个<code>DataSource</code>,再手动配置<code>JdbcTemplate</code>即可。具体步骤如下。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 数据源1</span></span><br><span class="line">spring.datasource.one.type=com.alibaba.druid.pool.DruidDataSource</span><br><span class="line">spring.datasource.one.username=root</span><br><span class="line">spring.datasource.one.password=123</span><br><span class="line">spring.datasource.one.url=jdbc:mysql:///chapter05-1</span><br><span class="line"><span class="comment"># 数据源2</span></span><br><span class="line">spring.datasource.two.type=com.alibaba.druid.pool.DruidDataSource</span><br><span class="line">spring.datasource.two.username=root</span><br><span class="line">spring.datasource.two.password=123</span><br><span class="line">spring.datasource.two.url=jdbc:mysql:///chapter05-2</span><br></pre></td></tr></table></figure>
<ul>
<li><code>DataSourceConfig</code>中提供了两个数据源: <code>dsOne</code>和<code>dsTwo</code>,默认方法名即实例名。</li>
<li><code>@ConfigurationProperties</code>注解表示使用不同前缀的配置文件来创建不同的<code>DataSource</code>实例。<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DataSourceConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties(&quot;spring.datasource.one&quot;)</span></span><br><span class="line">    <span class="function">DataSource <span class="title">dsOne</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> DruidDataSourceBuilder.create().build();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties(&quot;spring.datasource.two&quot;)</span></span><br><span class="line">    <span class="function">DataSource <span class="title">dsTwo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> DruidDataSourceBuilder.create().build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdbcTemplateConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function">JdbcTemplate <span class="title">jdbcTemplateOne</span><span class="params">(<span class="meta">@Qualifier(&quot;dsOne&quot;)</span> DataSource dataSource)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> JdbcTemplate(dataSource);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function">JdbcTemplate <span class="title">jdbcTemplateTwo</span><span class="params">(<span class="meta">@Qualifier(&quot;dsTwo&quot;)</span> DataSource dataSource)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> JdbcTemplate(dataSource);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><code>JdbcTemplateConfig</code>中提供两个<code>JdbcTemplate</code>实例。每个<code>JdbcTemplate</code>实例都需要提供-<code>DataSource</code>,由于<code>Spring</code>容器中有两个<code>DataSource</code>实例,因此需要通过方法名查找。<code>@Qualifier</code>注解表示查找不同名称的<code>DataSource</code>实例注入进来<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">@Resource(name = &quot;jdbcTemplateOne&quot;)</span></span><br><span class="line"><span class="comment">//    @Autowired</span></span><br><span class="line">    JdbcTemplate jdbcTemplate;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="meta">@Qualifier(&quot;jdbcTemplateTwo&quot;)</span></span><br><span class="line">    JdbcTemplate jdbcTemplateTwo;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/test1&quot;)</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="5-4-2-MyBatis多数据源"><a href="#5-4-2-MyBatis多数据源" class="headerlink" title="5.4.2 MyBatis多数据源"></a>5.4.2 MyBatis多数据源</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 数据源1</span><br><span class="line">spring.datasource.one.type=com.alibaba.druid.pool.DruidDataSource</span><br><span class="line">spring.datasource.one.username=root</span><br><span class="line">spring.datasource.one.password=123</span><br><span class="line">spring.datasource.one.url=jdbc:mysql:///chapter05-1</span><br><span class="line"># 数据源2</span><br><span class="line">spring.datasource.two.type=com.alibaba.druid.pool.DruidDataSource</span><br><span class="line">spring.datasource.two.username=root</span><br><span class="line">spring.datasource.two.password=123</span><br><span class="line">spring.datasource.two.url=jdbc:mysql:///chapter05-2</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DataSourceConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties(&quot;spring.datasource.one&quot;)</span></span><br><span class="line">    <span class="function">DataSource <span class="title">dsOne</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> DruidDataSourceBuilder.create().build();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties(&quot;spring.datasource.two&quot;)</span></span><br><span class="line">    <span class="function">DataSource <span class="title">dsTwo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> DruidDataSourceBuilder.create().build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@MapperScan(basePackages = &quot;org.javaboy.mybatismulti.mapper1&quot;,sqlSessionFactoryRef = &quot;sqlSessionFactory1&quot;,sqlSessionTemplateRef = &quot;sqlSessionTemplate1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBatisConfigOne</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="meta">@Qualifier(&quot;dsOne&quot;)</span></span><br><span class="line">    DataSource ds;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function">SqlSessionFactory <span class="title">sqlSessionFactory1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        SqlSessionFactory sqlSessionFactory = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            SqlSessionFactoryBean bean = <span class="keyword">new</span> SqlSessionFactoryBean();</span><br><span class="line">            bean.setDataSource(ds);</span><br><span class="line">            sqlSessionFactory = bean.getObject();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sqlSessionFactory;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function">SqlSessionTemplate <span class="title">sqlSessionTemplate1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SqlSessionTemplate(sqlSessionFactory1());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@MapperScan(basePackages = &quot;org.javaboy.mybatismulti.mapper2&quot;,sqlSessionFactoryRef = &quot;sqlSessionFactory2&quot;,sqlSessionTemplateRef = &quot;sqlSessionTemplate2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBatisConfigTwo</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="meta">@Qualifier(&quot;dsTwo&quot;)</span></span><br><span class="line">    DataSource ds;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function">SqlSessionFactory <span class="title">sqlSessionFactory2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        SqlSessionFactory sqlSessionFactory = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            SqlSessionFactoryBean bean = <span class="keyword">new</span> SqlSessionFactoryBean();</span><br><span class="line">            bean.setDataSource(ds);</span><br><span class="line">            sqlSessionFactory = bean.getObject();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sqlSessionFactory;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function">SqlSessionTemplate <span class="title">sqlSessionTemplate2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SqlSessionTemplate(sqlSessionFactory2());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="5-4-3-JPA多数据源"><a href="#5-4-3-JPA多数据源" class="headerlink" title="5.4.3 JPA多数据源"></a>5.4.3 JPA多数据源</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">spring.datasource.one.password=123</span><br><span class="line">spring.datasource.one.username=root</span><br><span class="line">spring.datasource.one.url=jdbc:mysql:///chapter05-1</span><br><span class="line">spring.datasource.one.type=com.alibaba.druid.pool.DruidDataSource</span><br><span class="line"></span><br><span class="line">spring.datasource.two.password=123</span><br><span class="line">spring.datasource.two.username=root</span><br><span class="line">spring.datasource.two.url=jdbc:mysql:///chapter05-2</span><br><span class="line">spring.datasource.two.type=com.alibaba.druid.pool.DruidDataSource</span><br><span class="line"></span><br><span class="line">spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQL57InnoDBDialect</span><br><span class="line">spring.jpa.properties.database=mysql</span><br><span class="line">spring.jpa.properties.hibernate.hbm2ddl.auto=update</span><br><span class="line">spring.jpa.properties.show-sql= <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<p>这里的配置与配置单独的<code>JPA</code>有区别,因为在后文的配置中要从<code>JpaProperties</code>中的<code>getProperties</code>方法中获取所有JPA相关的配置, 因此这里的属性前缀都是<code>spring.jpa.properties</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DataSourceConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties(&quot;spring.datasource.one&quot;)</span></span><br><span class="line">    <span class="meta">@Primary</span></span><br><span class="line">    <span class="function">DataSource <span class="title">dsOne</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> DruidDataSourceBuilder.create().build();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties(&quot;spring.datasource.two&quot;)</span></span><br><span class="line">    <span class="function">DataSource <span class="title">dsTwo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> DruidDataSourceBuilder.create().build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableTransactionManagement</span></span><br><span class="line"><span class="meta">@EnableJpaRepositories(basePackages = &quot;org.sang.dao1&quot;,</span></span><br><span class="line"><span class="meta">        entityManagerFactoryRef = &quot;entityManagerFactoryBeanOne&quot;,</span></span><br><span class="line"><span class="meta">        transactionManagerRef = &quot;platformTransactionManagerOne&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JpaConfigOne</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Resource(name = &quot;dsOne&quot;)</span></span><br><span class="line">    DataSource dsOne;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    JpaProperties jpaProperties;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Primary</span></span><br><span class="line">    <span class="function">LocalContainerEntityManagerFactoryBean <span class="title">entityManagerFactoryBeanOne</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">            EntityManagerFactoryBuilder builder)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> builder.dataSource(dsOne)</span><br><span class="line">                .properties(jpaProperties.getProperties())</span><br><span class="line">                .packages(<span class="string">&quot;org.sang.model&quot;</span>)</span><br><span class="line">                .persistenceUnit(<span class="string">&quot;pu1&quot;</span>)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function">PlatformTransactionManager <span class="title">platformTransactionManagerOne</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">            EntityManagerFactoryBuilder builder)</span> </span>&#123;</span><br><span class="line">        LocalContainerEntityManagerFactoryBean factoryOne = entityManagerFactoryBeanOne(builder);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> JpaTransactionManager(factoryOne.getObject());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>使用<code>@EnableJpaRepositories</code>注解来进行<code>JPA</code>的配置,该注解中主要配置三个属性:<code>basePackages</code>, <code>entityManagerFactoryRef</code>以及<code>transactionManagerRef.</code>其中, <code>basePackages</code>用来指定<code>Repository</code>所在的位置, <code>entityManagerFactoryRef</code>用来指定实体类管理工厂<code>Bean</code>的名称,<code>transactionManagerRef</code>则用来指定<code>事务管理器</code>的引用名称,这里的引用名称就是<code>JpaConfigOne</code>类中注册的<code>Bean</code>的名称(默认的<code>Bean</code>名称为方法名)</li>
<li>创建<code>LocalContainerEntityManagerFactoryBean</code>,该Bean将用来提供<code>EntityManager实例</code>,在该类的创建过程中,首先配置数据源,然后设置<code>JPA</code>相关配置(<code>JpaProperties</code>由系统自动加载),再设置实体类所在的位置,最后配置持久化单元名,若项目中只有一个<code>EntityManagerFactory</code>, 则<code>persistenceUnit</code>可以省略掉,若有多个,则必须明确指定持久化单元名。</li>
<li>由于项目中会提供两个<code>LocalContainerEntityManagerFactoryBean</code>实例,第12行的注解<code>@Primary</code>表示当存在多个<code>LocalContainerEntityManagerFactoryBean</code>实例时,该实例将被优先使用。<br>+<code>PlatformTransactionManager</code>表示创建一个事务管理器。 <code>JpaTransactionManager</code>提供对单个<code>EntityManagerFactory</code>的事务支持,专门用于解决<code>JPA</code>中的事务管理。<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableTransactionManagement</span></span><br><span class="line"><span class="meta">@EnableJpaRepositories(basePackages = &quot;org.sang.dao2&quot;,</span></span><br><span class="line"><span class="meta">entityManagerFactoryRef = &quot;entityManagerFactoryBeanTwo&quot;,</span></span><br><span class="line"><span class="meta">transactionManagerRef = &quot;platformTransactionManagerTwo&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JpaConfigTwo</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Resource(name = &quot;dsTwo&quot;)</span></span><br><span class="line">    DataSource dsTwo;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    JpaProperties jpaProperties;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function">LocalContainerEntityManagerFactoryBean <span class="title">entityManagerFactoryBeanTwo</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">            EntityManagerFactoryBuilder builder)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> builder.dataSource(dsTwo)</span><br><span class="line">                .properties(jpaProperties.getProperties())</span><br><span class="line">                .packages(<span class="string">&quot;org.sang.model&quot;</span>)</span><br><span class="line">                .persistenceUnit(<span class="string">&quot;pu2&quot;</span>)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function">PlatformTransactionManager <span class="title">platformTransactionManagerTwo</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">            EntityManagerFactoryBuilder builder)</span> </span>&#123;</span><br><span class="line">        LocalContainerEntityManagerFactoryBean factoryTwo = entityManagerFactoryBeanTwo(builder);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> JpaTransactionManager(factoryTwo.getObject());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="第6章Spring-Boot整合NosQL"><a href="#第6章Spring-Boot整合NosQL" class="headerlink" title="第6章Spring Boot整合NosQL"></a>第6章Spring Boot整合NosQL</h2><p><code>NoSQL</code>是指<code>非关系型数据库</code>,非关系型数据库和关系型数据库两者存在许多显著的不同点,,其中最重要的是<code>NoSQL</code>不使用<code>SQL</code>作为查询语言。其数据存储可以不需要固定的<code>表格模式</code>,一般.都有<code>水平可扩展性的特征</code>。NoSQL主要有如下几种不同的分类:</p>
<ul>
<li><code>Key/Value</code>键值存储。这种数据存储通常都是无数据结构的,一般被当作<code>字符串</code>或者<code>二进制</code>数据,但是数据<code>加载速度快</code>,典型的使用场景是处理<code>高并发</code>或者用于日志系统等,这一类的数据库有<code>Redis</code>. <code>Tokyo Cabinet</code>等.</li>
<li><code>列存储</code>数据库。列存储数据库功能相对<code>局限</code>,但是查找<code>速度快</code>,容易进行<code>分布式扩展</code>,一般用于<code>分布式文件系统</code>中,这一类的数据库有<code>HBase</code>, <code>Cassandra</code>等。</li>
<li><pre><code>文档型数据库	。和`Key/Value`键值存储类似,文档型数据库也没有严格的`数据格式`,这既是缺点也是优势,因为不需要预先创建表结构,数据格式更加灵活,一般可用在`Web`应用中,这一类数据库有`MongoDB`, `CouchDB`等。
</code></pre>
</li>
<li><pre><code>图形数据库	。图形数据库专注于`构建关系图谱`,例如`社交网络`,`推荐系统`等,这一类的数据库有`Neo4J`、`DEX`等。
</code></pre>
</li>
</ul>
<h3 id="6-1整合Redis"><a href="#6-1整合Redis" class="headerlink" title="6.1整合Redis"></a>6.1整合Redis</h3><p><code>Redis</code>是一个使用<code>C</code>编写的基于<code>内存</code>的<code>NoSQL</code>数据库,它是目前最流行的键值对存储数据库。<code>Redis</code>由一个<code>Key, Value</code>映射的<code>字典</code>构成,与其他NoSQL不同, Redis中<code>Value</code>的类型不局限于<code>字符串</code>,还支持<code>列表</code>、<code>集合</code>、<code>有序集合</code>、<code>散列</code>等。</p>
<h5 id="6-1-1-Redis简介"><a href="#6-1-1-Redis简介" class="headerlink" title="6.1.1 Redis简介"></a>6.1.1 Redis简介</h5><p><code>Redis</code>不仅可以当作缓存使用,也可以配置<code>数据持久化</code>后当作<code>NoSQL</code>数据库使用, 目前支持两种持久化方式:<code>快照持久化</code>和<code>AOF持久化</code>。另一方面, Redis也可以搭建<code>集群</code>或者<code>主从复制</code>结构,在<code>高并发</code>环境下具有<code>高可用性</code>。</p>
<h5 id="6-1-2-Redis安装"><a href="#6-1-2-Redis安装" class="headerlink" title="6.1.2 Redis安装"></a>6.1.2 Redis安装</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Loaded plugins: fastestmirror, product-id, search-disabled-repos, subscription-manager</span><br><span class="line"></span><br><span class="line">This system is not registered with an entitlement server. You can use subscription-manager to register.</span><br><span class="line"></span><br><span class="line">Repository epel is listed more than once <span class="keyword">in</span> the configuration</span><br><span class="line">Repository epel-debuginfo is listed more than once <span class="keyword">in</span> the configuration</span><br><span class="line">Repository epel-source is listed more than once <span class="keyword">in</span> the configuration</span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line"> * base: mirrors.cloud.aliyuncs.com</span><br><span class="line"> * extras: mirrors.cloud.aliyuncs.com</span><br><span class="line"> * updates: mirrors.cloud.aliyuncs.com</span><br><span class="line">Package redis-3.2.12-2.el7.x86_64 already installed and latest version</span><br><span class="line">Nothing to <span class="keyword">do</span></span><br><span class="line">[root@liruilong ~]<span class="comment"># </span></span><br><span class="line">[root@liruilong ~]<span class="comment"># redis-server -v</span></span><br><span class="line">Redis server v=3.2.12 sha=00000000:0 malloc=jemalloc-3.6.0 bits=64 build=7897e7d0e13773f</span><br><span class="line">[root@liruilong ~]<span class="comment"># redis-cli -v</span></span><br><span class="line">redis-cli 3.2.12</span><br></pre></td></tr></table></figure>
<ul>
<li>Redis 远程连接:<a target="_blank" rel="noopener" href="https://www.cnblogs.com/liruilong/p/14531885.html">https://www.cnblogs.com/liruilong/p/14531885.html</a></li>
</ul>
<h5 id="6-1-3-Redis整合Spring-Boot"><a href="#6-1-3-Redis整合Spring-Boot" class="headerlink" title="6.1.3 Redis整合Spring Boot"></a>6.1.3 Redis整合Spring Boot</h5><p><code>Redis</code>的<code>Java</code>客户端有很多,例如<code>Jedis</code>、<code>JRedis</code>、 <code>Spring Data Redis</code>等, <code>Spring Boot</code>借助于<code>Spring. Data Redis</code>为Redis提供了开箱即用<code>自动化配置</code>,开发者只需要添加相关依赖并配置Redis连接信息即可,具体整合步骤如下。</p>
<h5 id="添加如下依赖"><a href="#添加如下依赖" class="headerlink" title="添加如下依赖:"></a>添加如下依赖:</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.lettuce<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lettuce-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>默认情况下,<code> spring-boot-starter-data-redis</code>使用的Redis工具是<code>Lettuce</code>,考虑到有的开发者习惯使用<code>Jedis</code>,因此可以从<code>spring-boot-starter-data-redis</code>中排除<code>Lettuce</code>并引入<code>Jedis</code>,修改为如下依赖:</p>
<h5 id="配置Redis接下来在application-properties-中配置Redis连接信息"><a href="#配置Redis接下来在application-properties-中配置Redis连接信息" class="headerlink" title="配置Redis接下来在application.properties 中配置Redis连接信息"></a>配置Redis接下来在application.properties 中配置Redis连接信息</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#基本连接信息配置</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#表示使用的Redis库的编号, Redis中提供了16个database,编号为0-15</span></span><br><span class="line">spring.redis.database=0</span><br><span class="line">spring.redis.host=192.168.66.130</span><br><span class="line">spring.redis.port=6379</span><br><span class="line">spring.redis.password=123@456</span><br><span class="line"><span class="comment">#连接池信息配置.</span></span><br><span class="line">spring.redis.lettuce.pool.max-active=</span><br><span class="line">spring.redis.lettuce.pool.max-idle=</span><br><span class="line">spring.redis.lettuce.pool.max-wait=</span><br><span class="line">spring.redis.lettuce.pool.min-idle=</span><br><span class="line">spring.redis.lettuce.shutdown-timeout=</span><br><span class="line"><span class="comment">#连接池最大连接数</span></span><br><span class="line">spring.redis.jedis.pool.max-active=8</span><br><span class="line"><span class="comment">#连接池中的最大空闲连接</span></span><br><span class="line">spring.redis.jedis.pool.max-idle=8</span><br><span class="line"><span class="comment">#连接池最大阻塞等待时间(使用负值表示没有限制)</span></span><br><span class="line">spring.redis.jedis.pool.max-wait=-1ms</span><br><span class="line"><span class="comment">#连接池中的最小空闲连接</span></span><br><span class="line">spring.redis.jedis.pool.min-idle=0</span><br></pre></td></tr></table></figure>
<p>在<code>·Spring Boot·</code>的自动配置类中提供了<code>·RedisAutoConfiguration·</code>进行Redis的配置,部分源码<br><img src="https://img-blog.csdnimg.cn/20210618234017580.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3Nhbmhld3V5YW5n,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>由这一段源码可以看到, <code>application.properties</code>中配置的信息将被注入<code>RedisProperties</code>中,如果开发者自己没有提供RedisTemplate或者<code>StringRedis Template</code>实例,则<code>Spring Boot</code>默认会提供这两个实例, <code>RedisTemplate</code>和<code>StringRedisTemplate</code>实例则提供了<code>Redis</code>的基本操作方法。<br><img src="https://img-blog.csdnimg.cn/20210618234108904.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3Nhbmhld3V5YW5n,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    RedisTemplate redisTemplate;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    StringRedisTemplate stringRedisTemplate;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/test1&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ValueOperations&lt;String, String&gt; ops1 = stringRedisTemplate.opsForValue();</span><br><span class="line">        ops1.set(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;三国演义&quot;</span>);</span><br><span class="line">        String name = ops1.get(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        System.out.println(name);</span><br><span class="line">        ValueOperations ops2 = redisTemplate.opsForValue();</span><br><span class="line">        Book b1 = <span class="keyword">new</span> Book();</span><br><span class="line">        b1.setId(<span class="number">1</span>);</span><br><span class="line">        b1.setName(<span class="string">&quot;红楼梦&quot;</span>);</span><br><span class="line">        b1.setAuthor(<span class="string">&quot;曹雪芹&quot;</span>);</span><br><span class="line">        ops2.set(<span class="string">&quot;b1&quot;</span>, b1);</span><br><span class="line">        Book book = (Book) ops2.get(<span class="string">&quot;b1&quot;</span>);</span><br><span class="line">        System.out.println(book);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>StringRedisTemplate</code>是<code>RedisTemplate</code>的子类,<code> StringRedisTemplate</code>中的<code>key</code>和<code>value</code>都是<code>字符串</code>，采用的序列化方案是<code>StringRedisSerializer</code>,而<code>RedisTemplate</code>则可以用来操作对象,<code>RedisTemplate</code>采用的序列化方案是<code>JdkSerializationRedisSerializer.</code>无论是<code>StringRedis Template</code>还是<code>RedisTemplate,</code>操作<code>Redis</code>的方法都是一致的。</li>
<li><code>StringRedisTemplate</code>和<code>RedisTemplate</code>都是通过<code>opsForValue</code>, <code>opsForZSet</code>或者<code>opsForSet</code>等方法首先<code>获取</code>一个<code>操作对象</code>,再使用该<code>操作对象</code>完成数据的读写。</li>
<li>第10行向Redis中存储一条记录,第11行将之读取出来,第18行向Redis中存储一个对象,第19行将之读取出来。</li>
</ul>
<h5 id="6-1-4-Redis集群整合Spring-Boot"><a href="#6-1-4-Redis集群整合Spring-Boot" class="headerlink" title="6.1.4 Redis集群整合Spring Boot."></a>6.1.4 Redis集群整合Spring Boot.</h5><h6 id="1-搭建Redis集群"><a href="#1-搭建Redis集群" class="headerlink" title="1,搭建Redis集群"></a>1,搭建Redis集群</h6><p><code>·(1)集群原理·</code>在<code>Redis集群</code>中,所有的<code>Redis节点</code>彼此<code>互联</code>,节点内部使用<code>二进制协议</code>优化传输速度和带宽。当一个节点挂掉后,集群中<code>超过半数</code>的节点<code>检测失效</code>时才认为该节点<code>已失效</code>。不同于<code>Tomcat集群</code>需要使用<code>反向代理服务器</code>, <code>Redis集群</code>中的<code>任意节点</code>都可以直接和<code>Java客户端连接</code>。</p>
<p><code>Redis集群</code>上的数据分配则是<code>采用哈希槽(HASH SLOT) </code>, <code>Redis集群</code>中内置了<code>16384个哈希槽</code>,当有数据需要<code>存储</code>时, Redis会首先使用<code>CRC16</code>算法对<code>key</code>进行计算,将<code>计算获得的结果</code>对<code>16384</code>取余,这样每一个<code>key</code>都会对应一个取值在0-16383之间的<code>哈希槽</code>, 	<code>Redis</code>则根据这个<code>余数</code>将该条<code>数据存储</code>到对应的<code>Redis节点</code>上,开发者可根据每个<code>Redis实例的性能</code>来调整每个<code>Redis实例上哈希槽</code>的<code>分布范伟</code></p>
<h3 id="6-2-整合MongoDB"><a href="#6-2-整合MongoDB" class="headerlink" title="6.2 整合MongoDB."></a>6.2 整合MongoDB.</h3><h5 id="6-2-1-MongoDB简介"><a href="#6-2-1-MongoDB简介" class="headerlink" title="6.2.1 MongoDB简介"></a>6.2.1 MongoDB简介</h5><p><code>·MongoDB</code>·是一种面向文档的数据库管理系统,它是一个介于关系型数据库和非关系型数据库，之间的产品, <code>·MongoDB·</code>功能丰富,它支持一种类似<code>JSON</code>的<code>BSON</code>数据格式,既可以存储简单的数据格式,也可以存储复杂的数据类型。·<code>MongoDB</code>·最大的特点是它支持的查询语言非常强大,并且还支持对数据建立索引。总体来说, <code>·MongoDB·</code>是一款应用相当广泛的<code>NosQL</code>数据库。</p>
<h5 id="6-2-2-MongoDB安装"><a href="#6-2-2-MongoDB安装" class="headerlink" title="6.2.2 MongoDB安装"></a>6.2.2 MongoDB安装</h5><p>關於Mongodb的學習<a target="_blank" rel="noopener" href="https://blog.csdn.net/sanhewuyang/article/details/107597408">《MongoDB大数据处理权威指南》读书笔记:https://blog.csdn.net/sanhewuyang/article/details/107597408</a></p>
<h5 id="6-2-3-MongoDB整合Spring-Boot"><a href="#6-2-3-MongoDB整合Spring-Boot" class="headerlink" title="6.2.3 MongoDB整合Spring Boot."></a>6.2.3 MongoDB整合Spring Boot.</h5><p>借助于<code>Spring Data MongoD</code>B, <code>Spring Boot</code>为<code>MongoDB</code>也提供了开箱即用的自动化配置方案,具体配置步骤如下</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">     <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-mongodb<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">spring.data.mongodb.authentication-database=admin</span><br><span class="line">spring.data.mongodb.database=<span class="built_in">test</span></span><br><span class="line">spring.data.mongodb.host=192.168.248.144</span><br><span class="line">spring.data.mongodb.port=27017</span><br><span class="line">spring.data.mongodb.username=root</span><br><span class="line">spring.data.mongodb.password=123</span><br><span class="line"><span class="comment">#spring.data.mongodb.uri=mongodb://root:123@192.168.248.144:27017/admin</span></span><br><span class="line"><span class="comment">#spring.data.mongodb.uri=mongodb://192.168.248.144:27017/test</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BookDao</span> <span class="keyword">extends</span> <span class="title">MongoRepository</span>&lt;<span class="title">Book</span>,<span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function">List&lt;Book&gt; <span class="title">findByAuthorContains</span><span class="params">(String author)</span></span>;</span><br><span class="line">    <span class="function">Book <span class="title">findByNameEquals</span><span class="params">(String name)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>使用<code>MongoTemplate</code>除了继承<code>MongoRepository</code>外,<code>Spring Data MongoDB</code>还提供了<code>MongoTemplate</code>用来方便地操作<code>MongoDB</code>。在<code>Spring Boot</code>中,若添加了<code>MongoDB</code>相关的依赖,而开发者并没有提供<code>MongoTemplate </code>,则默认会有一个<code>MongoTemplate</code>注册到<code>Spring容器</code>中,相关配置源码在<code>MongoDataAutoConfiguration</code>类中。因此,用户可以直接使用<code>MongoTemplate</code>,在<code>Controller</code>中直接注入<code>MongoTemplate</code>就可以使用了,添加如下代码到第5步的Controller中:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    BookDao bookDao;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    MongoTemplate mongoTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/test2&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;Book&gt; books = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">       ....</span><br><span class="line">        mongoTemplate.insertAll(books);</span><br><span class="line">        List&lt;Book&gt; list = mongoTemplate.findAll(Book.class);</span><br><span class="line">        System.out.println(list);</span><br><span class="line">        Book book = mongoTemplate.findById(<span class="number">3</span>, Book.class);</span><br><span class="line">        System.out.println(book);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/test1&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;Book&gt; books = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">       ....</span><br><span class="line">        bookDao.insert(books);</span><br><span class="line">        List&lt;Book&gt; books1 = bookDao.findByAuthorContains(<span class="string">&quot;鲁迅&quot;</span>);</span><br><span class="line">        System.out.println(books1);</span><br><span class="line">        Book book = bookDao.findByNameEquals(<span class="string">&quot;朝花夕拾&quot;</span>);</span><br><span class="line">        System.out.println(book);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="6-3-Session共享"><a href="#6-3-Session共享" class="headerlink" title="6.3 Session共享"></a>6.3 Session共享</h3><p>正常情况下, <code>HttpSession</code>是通过<code>Servlet容器</code>创建并进行管理的,创建成功之后都是保存在<code>内存中</code>。如果开发者需要对项目进行<code>横向扩展搭建集群</code>,那么可以利用一些<code>硬件</code>或者<code>软件工具</code>来做<code>负载均衡</code>,此时,来自同一用户的<code>HTTP请求</code>就有可能被<code>分发到不同的实例</code>上去,如何保证<code>各个实例之间Session的同步</code>就成为一个必须解决的问题。</p>
<p><code>Spring Boot</code>提供了自动化的<code>Session共享配置</code>,它结合<code>Redis</code>可以非常方便地解决这个问题。使用<code>Redis</code>解决<code>Session共享问题</code>的原理非常简单,就是把原本<code>存储在不同服务器上</code>的<code>Session</code>拿出来放在<code>一个独立的服务器</code>上.<br><img src="https://img-blog.csdnimg.cn/20210619013755584.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3Nhbmhld3V5YW5n,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>当一个请求到达<code>Nginx</code>服务器后,首先进行<code>请求分发</code>,假设请求被<code>real serverl</code>处理了, <code>real server</code>在处理请求时,无论是存储<code>Session</code>还是读取<code>Session</code>,都去操作<code>Session服务器</code>而不是操作自身<code>内存中的Session</code>,其他<code>real server</code>在处理请求时也是如此,这样就可以实现<code>Session共享</code>了</p>
<h5 id="6-3-1-Session共享配置"><a href="#6-3-1-Session共享配置" class="headerlink" title="6.3.1 Session共享配置"></a>6.3.1 Session共享配置</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.lettuce<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lettuce-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.session<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-session-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>除了<code>Redis依赖</code>之外,这里还要提供<code>spring-session-data-redis</code>依赖, <code>Spring Session</code>可以做到<code>透·明化</code>地<code>替换</code>掉应用的<code>Session容器</code>。项目创建成功后,在<code>application.properties</code>中进行<code>Redis</code>基本连接信息配置,代码如下:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">spring.redis.database=0</span><br><span class="line">spring.redis.host=192.168.66.130</span><br><span class="line">spring.redis.port=6379</span><br><span class="line">spring.redis.password=123@456</span><br><span class="line">spring.redis.jedis.pool.max-active=8</span><br><span class="line">spring.redis.jedis.pool.max-idle=8</span><br><span class="line">spring.redis.jedis.pool.max-wait=-1ms</span><br><span class="line">spring.redis.jedis.pool.min-idle=0</span><br></pre></td></tr></table></figure>
<p>添加··<code>@EnableRedisHttpSession</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * session托管到redis</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableRedisHttpSession(maxInactiveIntervalInSeconds= 3600*24, redisFlushMode = RedisFlushMode.ON_SAVE, redisNamespace = &quot;aurora-web&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisSessionConfig</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>maxInactiveIntervalInSeconds: 设置 Session 失效时间，使用 Redis Session 之后，原 Spring Boot 的server.session.timeout 属性不再生效。</li>
<li>经过上面的配置后，Session调用就会自动去Redis存取。另外，想要达到Session共享的目的，只需要在其他的系统上做同样的配置即可。</li>
</ul>
<h6 id="EnableRedisHttpSession源码"><a href="#EnableRedisHttpSession源码" class="headerlink" title="@EnableRedisHttpSession源码"></a>@EnableRedisHttpSession源码</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE&#125;)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Import(&#123;RedisHttpSessionConfiguration.class&#125;)</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> EnableRedisHttpSession &#123;</span><br><span class="line">    <span class="comment">//Session默认过期时间，单位秒，默认1800秒</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">maxInactiveIntervalInSeconds</span><span class="params">()</span> <span class="keyword">default</span> 1800</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//配置key的namespace，默认的是spring:session，如果不同的应用共用一个redis，应该为应用配置不同的namespace，这样才能区分这个Session是来自哪个应用的</span></span><br><span class="line">    <span class="function">String <span class="title">redisNamespace</span><span class="params">()</span> <span class="keyword">default</span> &quot;spring:session&quot;</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//配置刷新Redis中Session方式，默认是ON_SAVE模式，只有当Response提交后才会将Session提交到Redis,也可以配置成IMMEDIATE模式，即所有对Session的更改会立即更新到Redis</span></span><br><span class="line">    <span class="function">RedisFlushMode <span class="title">redisFlushMode</span><span class="params">()</span> <span class="keyword">default</span> RedisFlushMode.ON_SAVE</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//清理过期Session的定时任务</span></span><br><span class="line">    <span class="function">String <span class="title">cleanupCron</span><span class="params">()</span> <span class="keyword">default</span> &quot;0 * * * * *&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>测试一下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;server.port&#125;&quot;)</span></span><br><span class="line">    String port;</span><br><span class="line">    <span class="meta">@PostMapping(&quot;/save&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">saveName</span><span class="params">(String name, HttpSession session)</span> </span>&#123;</span><br><span class="line">        session.setAttribute(<span class="string">&quot;name&quot;</span>, name);</span><br><span class="line">        <span class="keyword">return</span> port;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/get&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">(HttpSession session)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> port + <span class="string">&quot;:&quot;</span></span><br><span class="line">                + session.getAttribute(<span class="string">&quot;name&quot;</span>).toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="6-3-2-Nginx负载均衡"><a href="#6-3-2-Nginx负载均衡" class="headerlink" title="6.3.2 Nginx负载均衡"></a>6.3.2 Nginx负载均衡</h5><p>关于Nginx，可以访问<a target="_blank" rel="noopener" href="https://blog.csdn.net/sanhewuyang/article/details/114488191">Nginx 学习笔记(《深入理解Nginx:模块开发与架构解析》读书笔记):https://blog.csdn.net/sanhewuyang/article/details/114488191</a><br><code>nginx.conf·</code>配置文件修改：<br><img src="https://img-blog.csdnimg.cn/20210619022854450.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3Nhbmhld3V5YW5n,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">upstream backend &#123;</span><br><span class="line">    server backend1.example.com;</span><br><span class="line">    server backend2.example.com;</span><br><span class="line">    server backend3.example.com;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">    location / &#123;</span><br><span class="line">    proxy_pass http: //backend;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="第7章构建RESTful服务"><a href="#第7章构建RESTful服务" class="headerlink" title="第7章构建RESTful服务"></a>第7章构建RESTful服务</h2><h3 id="7-1-REST简介"><a href="#7-1-REST简介" class="headerlink" title="7.1 REST简介"></a>7.1 REST简介</h3><p><code>REST (Representational State Transfer)</code>是一种<code>Web</code>软件架构风格,它是一种<code>风格</code>,而不是<code>标准</code>,匹配或兼容这种架构风格的网络服务称为<code>REST服务</code>。REST服务简洁并且有层次, REST通常基于<code>HTTP</code>,<code>URI</code>和<code>XML</code>以及<code>HTML</code>这些现有的广泛流行的协议和标准。</p>
<p><code>在REST</code>中,资源是由<code>URI</code>来指定的,对资源的增删改查操作可以通过<code>HTTP</code>协议提供的<code>GET, POST, PUT, DELETE</code>等方法实现。使用REST可以更高效地利用缓存来提高响应速度,同时<code>REST</code>中的通信会话状态由<code>客户端</code>来维护,这可以让不同的服务器处理一系列请求中的不同请求,进而提高服务器的扩展性。在前后端分离项目中,一个设计良好的Web软件架构必然要满足REST风格。在<code>Spring MVC</code>框架中,开发者可以通过<code>@RestController</code>注解开发一个RESTful服务,不过,<code>Spring Boot</code>对此提供了自动化配置方案,开发者只需要添加相关依赖就能快速构建一个<code>RESTful</code>服务。</p>
<h3 id="7-2-JPA实现REST"><a href="#7-2-JPA实现REST" class="headerlink" title="7.2 JPA实现REST"></a>7.2 JPA实现REST</h3><p>在<code>Spring Boot </code>中,使用S<code>pring Data JPA</code>和<code>Spring Data Rest</code>可以快速开发出一个<code>RESTful应用</code>。接下来向读者介绍<code>Spring Boot</code>中非常方便的<code>RESTful应用开发</code>。</p>
<h4 id="7-2-1-基本实现"><a href="#7-2-1-基本实现" class="headerlink" title="7.2.1 基本实现"></a>7.2.1 基本实现</h4><p>这里的依赖除了<code>数据库相关的依赖外</code>,还有<code>Spring Data JPA</code>的依赖以及<code>Spring Data Rest</code>的依赖。项目创建完成后,在<code>application.properties</code> 中配置基本的数据库连接信息:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-rest<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.9<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这里的依赖除了数据库相关的依赖外,还有<code>Spring Data JPA</code>的依赖以及<code>Spring Data Rest</code>的依赖。项目创建完成后,在<code>application.properties</code>中配置基本的数据库连接信息:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">spring.datasource.type=com.alibaba.druid.pool.DruidDataSource</span><br><span class="line">spring.datasource.username=root</span><br><span class="line">spring.datasource.password=123</span><br><span class="line">spring.datasource.url=jdbc:mysql:///jparestful</span><br><span class="line">spring.jpa.hibernate.ddl-auto=update</span><br><span class="line">spring.jpa.database=mysql</span><br><span class="line">spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQL57Dialect</span><br><span class="line">spring.jpa.show-sql=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##每页默认记录数，缺省值为20</span></span><br><span class="line"><span class="comment">#spring.data.rest.default-page-size=2</span></span><br><span class="line"><span class="comment">##分页查询页码参数名，缺省值为page</span></span><br><span class="line"><span class="comment">#spring.data.rest.page-param-name=page</span></span><br><span class="line"><span class="comment">##分页查询记录数参数名，缺省值为size</span></span><br><span class="line"><span class="comment">#spring.data.rest.limit-param-name=size</span></span><br><span class="line"><span class="comment">##分页查询排序参数名，缺省值为sort</span></span><br><span class="line"><span class="comment">#spring.data.rest.sort-param-name=sort</span></span><br><span class="line"><span class="comment">##base-path表示给所有请求路径都加上前缀</span></span><br><span class="line"><span class="comment">#spring.data.rest.base-path=/api</span></span><br><span class="line"><span class="comment">##添加成功时是否返回添加内容</span></span><br><span class="line"><span class="comment">#spring.data.rest.return-body-on-create=true</span></span><br><span class="line"><span class="comment">##更新成功时是否返回更新内容</span></span><br><span class="line"><span class="comment">#spring.data.rest.return-body-on-update=true</span></span><br></pre></td></tr></table></figure>
<p>创建实体类，创建<code>BookRepository</code>类继承<code>JpaRepository</code>, <code>JpaRepository</code>中默认提供了一些基本的操作方法,代码如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">JpaRepository</span>&lt;<span class="title">T</span>, <span class="title">ID</span>&gt; <span class="keyword">extends</span> <span class="title">PagingAndSortingRepository</span>&lt;<span class="title">T</span>, <span class="title">ID</span>&gt;, <span class="title">QueryByExampleExecutor</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function">List&lt;T&gt; <span class="title">findAll</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">List&lt;T&gt; <span class="title">findAll</span><span class="params">(Sort var1)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">List&lt;T&gt; <span class="title">findAllById</span><span class="params">(Iterable&lt;ID&gt; var1)</span></span>;</span><br><span class="line"></span><br><span class="line">    &lt;S extends T&gt; <span class="function">List&lt;S&gt; <span class="title">saveAll</span><span class="params">(Iterable&lt;S&gt; var1)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">flush</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    &lt;S extends T&gt; <span class="function">S <span class="title">saveAndFlush</span><span class="params">(S var1)</span></span>;</span><br><span class="line"></span><br><span class="line">    &lt;S extends T&gt; <span class="function">List&lt;S&gt; <span class="title">saveAllAndFlush</span><span class="params">(Iterable&lt;S&gt; var1)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** <span class="doctag">@deprecated</span> */</span></span><br><span class="line">    <span class="meta">@Deprecated</span></span><br><span class="line">    <span class="function"><span class="keyword">default</span> <span class="keyword">void</span> <span class="title">deleteInBatch</span><span class="params">(Iterable&lt;T&gt; entities)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.deleteAllInBatch(entities);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">deleteAllInBatch</span><span class="params">(Iterable&lt;T&gt; var1)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">deleteAllByIdInBatch</span><span class="params">(Iterable&lt;ID&gt; var1)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">deleteAllInBatch</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** <span class="doctag">@deprecated</span> */</span></span><br><span class="line">    <span class="meta">@Deprecated</span></span><br><span class="line">    <span class="function">T <span class="title">getOne</span><span class="params">(ID var1)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">T <span class="title">getById</span><span class="params">(ID var1)</span></span>;</span><br><span class="line"></span><br><span class="line">    &lt;S extends T&gt; <span class="function">List&lt;S&gt; <span class="title">findAll</span><span class="params">(Example&lt;S&gt; var1)</span></span>;</span><br><span class="line"></span><br><span class="line">    &lt;S extends T&gt; <span class="function">List&lt;S&gt; <span class="title">findAll</span><span class="params">(Example&lt;S&gt; var1, Sort var2)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="7-2-2-自定义请求路径"><a href="#7-2-2-自定义请求路径" class="headerlink" title="7.2.2 自定义请求路径"></a>7.2.2 自定义请求路径</h4><p>默认情况下,请求路径都是<code>实体类名</code>小写加<code>s</code>,如果开发者想对<code>请求路径进行重定义</code>,通过<code>@RepositoryRestResource</code>注解即可实现,下面的案例只需在<code>BookRepository</code>上添加<code>@RepositoryRestResource</code>注解即可:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@CrossOrigin</span></span><br><span class="line"><span class="meta">@RepositoryRestResource(path = &quot;bs&quot;,collectionResourceRel = &quot;bs&quot;,itemResourceRel = &quot;b&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BookRepository</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">Book</span>, <span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line">.....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>@RepositoryRestResource</code>·注解的<code>·path·</code>属性表示将所有请求路径中的<code>books</code>都修改为<code>bs,</code>如<code>http://ocalhost: 8080/bs: </code></li>
<li><code>collectionResourceRel</code>属性表示将返回的<code>JSON</code>集合中<code>book</code>集合的<code>key</code>修改为<code>bs</code>; </li>
<li><code>itemResourceRel</code>表示将返回的<code>JSON</code>集合中的单个book的key修改为b,</li>
</ul>
<h4 id="7-2-3-自定义查询方法"><a href="#7-2-3-自定义查询方法" class="headerlink" title="7.2.3 自定义查询方法."></a>7.2.3 自定义查询方法.</h4><p>默认的查询方法支持<code>分页查询</code>、<code>排序查询</code>以及按照<code>id查询</code>,如果开发者想要按照某个<code>属性查询</code>,只需在<code>BookRepository</code>中定义相关<code>方法并暴露</code>出去即可,代码如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RepositoryRestResource(path = &quot;bs&quot;,collectionResourceRel = &quot;bs&quot;,itemResourceRel = &quot;b&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BookRepository</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">Book</span>, <span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@RestResource(exported = false)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">deleteById</span><span class="params">(Integer integer)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RestResource(path = &quot;author&quot;,rel = &quot;author&quot;)</span></span><br><span class="line">    <span class="function">List&lt;Book&gt; <span class="title">findByAuthorContains</span><span class="params">(<span class="meta">@Param(&quot;author&quot;)</span> String author)</span></span>;</span><br><span class="line">    <span class="meta">@RestResource(path = &quot;name&quot;,rel = &quot;name&quot;)</span></span><br><span class="line">    <span class="function">Book <span class="title">findByNameEquals</span><span class="params">(<span class="meta">@Param(&quot;name&quot;)</span> String name)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>·<code>自定义查询</code>只需要在<code>BookRepository</code>中定义相关查询方法即可,方法定义好之后可以不添加<code>@RestResource</code>注解,默认路径就是<code>方法名</code>。以第4行定义的方法为例,若不添加<code>@RestResource</code>注解, 则默 认 该方法的调用路径为<code>http://ocalhost:8080/bs/search/indByAuthorContains?author=鲁迅</code>。如果想对查询<code>路径进行自定义</code>,只需要添加<code>@RestResource注解</code>即可, <code>path属性</code>即表示最新的路径。还是以第4行的方法为例,添加<code>@RestResource(path = &quot;author&quot;,rel = &quot;author&quot;)</code>注解后的查询路径为”<a target="_blank" rel="noopener" href="http://ocalhost:8080/bs/search/author?author=%E9%B2%81%E8%BF%85&quot;">http://ocalhost:8080/bs/search/author?author=鲁迅&quot;</a>.</li>
<li>用户可以直接访问<code>http/ocalhost:8080/bs/search</code>路径查看该<code>实体类暴露</code>出来了哪些<code>查询方法</code>,默认情况下,在<code>查询方法展示</code>时使用的路径是方法名,通过<code>@RestResource</code>注解中的<code>rel</code>属性可以对这里的<code>路径进行重定义</code>,如图7-6所示。</li>
</ul>
<h4 id="7-2-4-隐藏方法"><a href="#7-2-4-隐藏方法" class="headerlink" title="7.2.4 隐藏方法"></a>7.2.4 隐藏方法</h4><p>默认情况下,凡是继承了<code>Repository接口</code>(或者<code>Repository的子类</code>)的类都会被暴露出来,即开发者可执行<code>基本的增删改查</code>方法。以上文的<code>BookRepository</code>为例,如果开发者提供了<code>BookRepository</code>继承自<code>Repository</code>,就能执行对Book的基本操作,如果开发者继承了<code>Repository</code>但是又不想暴露相关操作,做如下配置即可:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//@RepositoryRestResource(exported = false)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BookRepository</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">Book</span>, <span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@RestResource(exported = false)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">deleteById</span><span class="params">(Integer integer)</span></span>;</span><br><span class="line">....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>将·<code>@RepositoryRestResource</code>注解中的<code>exported</code>属性置为<code>false</code>之后,则<code>增删改查接口</code>都会<code>失效</code>, <code>BookRepository</code>类中定义的相关方法也会失效。若只是单纯地<code>不想暴露某个方法</code>,则在方法上进行配置即可,例如开发者想<code>屏蔽DELETE接口</code>.</p>
<h4 id="7-2-5-配置CORS"><a href="#7-2-5-配置CORS" class="headerlink" title="7.2.5 配置CORS"></a>7.2.5 配置CORS</h4><p>在<code>4.6节</code>已经向读者介绍了<code>CORS</code>两种不同的配置方式,一种是直接在方法上添加<code>@CrosSorigin注解</code>,另一种是<code>全局配置</code>。<code>全局配置</code>在这里依然适用,但是默认的<code>RESTful工程</code>不需要开发者自己<code>提供Controller</code>,因此添加在<code>Controller</code>的方法上的<code>注解</code>可以直接写在<code>BookRepository</code>上,代码如下:接口跨域：<code>@CrossOrigin</code>注解添加到某一个方法上即可。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//@CrossOrigin</span></span><br><span class="line"><span class="meta">@RepositoryRestResource(path = &quot;bs&quot;,collectionResourceRel = &quot;bs&quot;,itemResourceRel = &quot;b&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BookRepository</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">Book</span>, <span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line">   <span class="meta">@CrossOrigin</span></span><br><span class="line">    <span class="function">List&lt;Book&gt; <span class="title">findByAuthorContains</span><span class="params">(<span class="meta">@Param(&quot;author&quot;)</span> String author)</span></span>;</span><br><span class="line">  ....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="7-2-6其他配置"><a href="#7-2-6其他配置" class="headerlink" title="7.2.6其他配置"></a>7.2.6其他配置</h4><h6 id="application-properties配置"><a href="#application-properties配置" class="headerlink" title="application.properties配置"></a><code>application.properties</code>配置</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##每页默认记录数，缺省值为20</span></span><br><span class="line"><span class="comment">#spring.data.rest.default-page-size=2</span></span><br><span class="line"><span class="comment">##分页查询页码参数名，缺省值为page</span></span><br><span class="line"><span class="comment">#spring.data.rest.page-param-name=page</span></span><br><span class="line"><span class="comment">##分页查询记录数参数名，缺省值为size</span></span><br><span class="line"><span class="comment">#spring.data.rest.limit-param-name=size</span></span><br><span class="line"><span class="comment">##分页查询排序参数名，缺省值为sort</span></span><br><span class="line"><span class="comment">#spring.data.rest.sort-param-name=sort</span></span><br><span class="line"><span class="comment">##base-path表示给所有请求路径都加上前缀</span></span><br><span class="line"><span class="comment">#spring.data.rest.base-path=/api</span></span><br><span class="line"><span class="comment">##添加成功时是否返回添加内容</span></span><br><span class="line"><span class="comment">#spring.data.rest.return-body-on-create=true</span></span><br><span class="line"><span class="comment">##更新成功时是否返回更新内容</span></span><br><span class="line"><span class="comment">#spring.data.rest.return-body-on-update=true</span></span><br></pre></td></tr></table></figure>
<p>当然,这些<code>XML配置</code>也可以在<code>Java代码</code>中配置,且代码中配置的优先级高于<code>application.properties</code>配置的优先级,代码如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RestConfig</span> <span class="keyword">extends</span> <span class="title">RepositoryRestConfigurerAdapter</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configureRepositoryRestConfiguration</span><span class="params">(RepositoryRestConfiguration config)</span> </span>&#123;</span><br><span class="line">        config.setDefaultPageSize(<span class="number">2</span>)</span><br><span class="line">                .setPageParamName(<span class="string">&quot;page&quot;</span>)</span><br><span class="line">                .setLimitParamName(<span class="string">&quot;size&quot;</span>)</span><br><span class="line">                .setSortParamName(<span class="string">&quot;sort&quot;</span>)</span><br><span class="line">                .setBasePath(<span class="string">&quot;/api&quot;</span>)</span><br><span class="line">                .setReturnBodyOnCreate(<span class="keyword">true</span>)</span><br><span class="line">                .setReturnBodyOnUpdate(<span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="7-2-7-JPA使用rest自定义链接"><a href="#7-2-7-JPA使用rest自定义链接" class="headerlink" title="7.2.7 JPA使用rest自定义链接"></a>7.2.7 JPA使用rest自定义链接</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyResourceProcessor</span> <span class="keyword">implements</span> <span class="title">ResourceProcessor</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResourceSupport <span class="title">process</span><span class="params">(ResourceSupport resourceSupport)</span> </span>&#123;</span><br><span class="line">        resourceSupport.add(<span class="keyword">new</span> Link(<span class="string">&quot;http://www.baidu.com&quot;</span>, <span class="string">&quot;百度一下&quot;</span>));</span><br><span class="line">        <span class="keyword">return</span> resourceSupport;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="7-3-MongoDB实现REST"><a href="#7-3-MongoDB实现REST" class="headerlink" title="7.3 MongoDB实现REST"></a>7.3 MongoDB实现REST</h3><p><code>MongoDB</code>整合<code>Spring Boot</code>,而使用<code>Spring Boot</code>快速构建<code>RESTful·服务</code>除了结合<code>Spring Data JPA</code>之外,也可以结合<code>Spring Data MongoDB</code>实现。使用<code>Spring DataMongoDB</code>构建<code>RESTful</code>服务也是三个步骤,分别如下。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">     <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-mongodb<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-rest<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这里<code>Spring Data Rest</code>的依赖和7.2节中的一致,只是将<code>Spring Data JPA</code>的依赖变为<code>Spring DataMongoDB</code>的依赖。项目创建成功后,在<code>application.properties</code>中配置<code>MongoDB</code>的基本连接信息,</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">spring.data.mongodb.authentication-database=<span class="built_in">test</span></span><br><span class="line">spring.data.mongodb.database=<span class="built_in">test</span></span><br><span class="line">spring.data.mongodb.username=sang</span><br><span class="line">spring.data.mongodb.password=123</span><br><span class="line">spring.data.mongodb.host=192.168.248.144</span><br><span class="line">spring.data.mongodb.port=27017</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BookRepository</span> <span class="keyword">extends</span> <span class="title">MongoRepository</span>&lt;<span class="title">Book</span>,<span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="第8章开发者工具与单元测试"><a href="#第8章开发者工具与单元测试" class="headerlink" title="第8章开发者工具与单元测试"></a>第8章开发者工具与单元测试</h2><h3 id="8-1-devtools简介"><a href="#8-1-devtools简介" class="headerlink" title="8.1 devtools简介"></a>8.1 devtools简介</h3><p><code>Spring Boot</code>中提供了一组开发工具<code>spring-boot-devtools</code>,可以提高开发者的工作效率,开发者可以将该模块包含在任何项目中, <code>spring-boot-devtools</code>最方便的地方莫过于<code>热部署</code>了。</p>
<h3 id="8-2-devtools实战"><a href="#8-2-devtools实战" class="headerlink" title="8.2 devtools实战"></a>8.2 devtools实战</h3><h4 id="8-2-1-基本用法"><a href="#8-2-1-基本用法" class="headerlink" title="8.2.1 基本用法"></a>8.2.1 基本用法</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>这里多了一个optional选项,是为了防止将<code>devtools依赖传递</code>到其他模块中。当开发者将应用打包运行后, <code>devtools</code>会被自动禁用。</li>
<li>当开发者将<code>spring-boot-devtools</code>引入项目后,只要<code>classpath</code>路径下的<code>文件发生了变化</code>,项目就会自动重启,这极大地提高了项目的开发速度。</li>
</ul>
<h4 id="8-2-2-基本原理"><a href="#8-2-2-基本原理" class="headerlink" title="8.2.2 基本原理"></a>8.2.2 基本原理</h4><p><code>Spring Boot中</code>使用的自动重启技术涉及两个类加载器,一个是<code>baseclassloader,</code>用来<code>加载不会变化的类</code>,例如项目引用的第三方的jar;另一个是<code>restartclassloader</code>,用来加载<code>开发者自己写的会·变化的类</code>。当项目需要重启时, restartclassloader将被一个新创建的类加载器代替,而baseclassloader则继续使用原来的,这种启动方式要比<code>冷启动</code>快很多,因为<code>baseclassloader</code>已经存在并且已经加载好</p>
<h3 id="8-3单元测试"><a href="#8-3单元测试" class="headerlink" title="8.3单元测试"></a>8.3单元测试</h3><h4 id="8-3-1-基本用法"><a href="#8-3-1-基本用法" class="headerlink" title="8.3.1 基本用法"></a>8.3.1 基本用法</h4><p>当开发者使用Intelli IDEA或者在线创建一个Spring Boot项目时,创建成功后,默认都添加了spring-bool-starter-est依赖,并且创建好了测试类。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppTest</span> </span>&#123;</span><br><span class="line">    MockMvc mockMvc;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    WebApplicationContext wac;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    HelloService helloService;</span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        mockMvc = MockMvcBuilders.webAppContextSetup(wac).build();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test2</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        mockMvc.perform(MockMvcRequestBuilders.get(<span class="string">&quot;/hello&quot;</span>, <span class="string">&quot;name=aaa&quot;</span>)).andDo(MockMvcResultHandlers.print());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(helloService.sayHello(<span class="string">&quot;里斯&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>@RunWith</code>注解,该注解将<code>JUnit</code>执行类修改为<code>SpringRunner</code>,而<code>SpringRunner</code>是<code>Spring Framework</code>中测试类<code>SpringJUnit4ClassRunner</code>的别名。</li>
<li><code>@Spring BootTest</code>注解除了提供<code>Spring TestContext</code>中的常规测试功能之外,还提供了其他特性:提供默认的<code>ContextLoader</code>, 自动搜索<code>@Spring BootConfiguration</code>、自定义环境属性、为不同的<code>webEnvironment</code>模式提供支持,这里的<code>webEnvironment</code>模式主要有4种.這裏不説了。</li>
</ul>
<h4 id="8-3-2-Service测试"><a href="#8-3-2-Service测试" class="headerlink" title="8.3.2 Service测试"></a>8.3.2 Service测试</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">sayHello</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hello &quot;</span> + name + <span class="string">&quot; !&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">HelloService helloService;</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextLoads</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    String hello = helloService.sayHello(<span class="string">&quot;Michael&quot;</span>);</span><br><span class="line">    Assert.assertThat(hello, Matchers.is(<span class="string">&quot;Hello Michael !&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="8-3-3-Controller测试"><a href="#8-3-3-Controller测试" class="headerlink" title="8.3.3 Controller测试."></a>8.3.3 Controller测试.</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test2</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">       ObjectMapper om = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">       Book book = <span class="keyword">new</span> Book();</span><br><span class="line">       book.setAuthor(<span class="string">&quot;罗贯中&quot;</span>);</span><br><span class="line">       book.setName(<span class="string">&quot;三国演义&quot;</span>);</span><br><span class="line">       book.setId(<span class="number">1</span>);</span><br><span class="line">       String s = om.writeValueAsString(book);</span><br><span class="line">       MvcResult mvcResult = mockMvc</span><br><span class="line">               .perform(MockMvcRequestBuilders</span><br><span class="line">                       .post(<span class="string">&quot;/book&quot;</span>)</span><br><span class="line">                       .contentType(MediaType.APPLICATION_JSON)</span><br><span class="line">                       .content(s))</span><br><span class="line">               .andExpect(MockMvcResultMatchers.status().isOk())</span><br><span class="line">               .andReturn();</span><br><span class="line">       System.out.println(mvcResult.getResponse().getContentAsString());</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    HelloService helloService;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/hello&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> helloService.sayHello(name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">MockMvc mockMvc;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">WebApplicationContext wac;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">HelloService helloService;</span><br><span class="line"><span class="meta">@Before</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    mockMvc = MockMvcBuilders.webAppContextSetup(wac).build();</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    MvcResult mvcResult = mockMvc.perform(</span><br><span class="line">            MockMvcRequestBuilders</span><br><span class="line">                    .get(<span class="string">&quot;/hello&quot;</span>)</span><br><span class="line">                    .contentType(MediaType.APPLICATION_FORM_URLENCODED)</span><br><span class="line">                    .param(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;Michael&quot;</span>))</span><br><span class="line">            <span class="comment">//返回什么数据        </span></span><br><span class="line">            .andExpect(MockMvcResultMatchers.status().isOk())</span><br><span class="line">            .andDo(MockMvcResultHandlers.print())</span><br><span class="line">            .andReturn();</span><br><span class="line">    System.out.println(mvcResult.getResponse().getContentAsString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>除了<code>MockMvc</code>这种测试方式之外,<code> Spring Boot</code>还专门提供了<code>TestRestTemplate</code>用来实现集成测试,若开发者使用了<code>@Spring BootTest</code>注解,则<code>TestRestTemplate</code>将自动可用,直接在测试类中注入即可。注意,如果要使用<code>TestRestTemplate</code>进行测试,需要将<code>@Spring BootTest</code>注解中<code>webEnvironment</code>属性的默认值由<code>WebEnvironment.MOCK</code>修改为<code>webEnvironment.DEFINED PORT</code>或者<code>WebEnvironment.RANDOM PORT</code>,因为这两种都是使用一个真实的Servlet环境而不是模拟的Serlet环境。其代码如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">TestRestTemplate restTemplate;</span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       ResponseEntity&lt;String&gt; hello = restTemplate.getForEntity(<span class="string">&quot;/hello?name=&#123;0&#125;&quot;</span>, String.class, <span class="string">&quot;Michael&quot;</span>);</span><br><span class="line">       System.out.println(hello.getBody());</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>test2方法演示了POST请求如何传递JSON数据,首先在32行将一个book对象转为一段JSON,然后在36行设置请求的contentType为APPLICATION-JSON,最后在37行设置content为上传的JSON即可。</li>
</ul>
<h4 id="8-3-4-JSON测试"><a href="#8-3-4-JSON测试" class="headerlink" title="8.3.4 JSON测试"></a>8.3.4 JSON测试</h4><p>开发者可以使用<code>@JsonTest</code>测试<code>JSON序列化</code>和<code>反序列化</code>是否工作正常,该注解将<code>自动配置Jackson ObjectMapper</code>.<code>@JsonComponent</code>以及<code>Jackson Modules</code>.如果开发者使用Gson代替Jackson,该注解将配置Gson,具体用法如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@JsonTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JSONTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    JacksonTester&lt;Book&gt; jacksonTester;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSerialize</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Book book = <span class="keyword">new</span> Book();</span><br><span class="line">        book.setId(<span class="number">1</span>);</span><br><span class="line">        book.setName(<span class="string">&quot;三国演义&quot;</span>);</span><br><span class="line">        book.setAuthor(<span class="string">&quot;罗贯中&quot;</span>);</span><br><span class="line">        Assertions.assertThat(jacksonTester.write(book))</span><br><span class="line">                .isEqualToJson(<span class="string">&quot;book.json&quot;</span>);</span><br><span class="line">        Assertions.assertThat(jacksonTester.write(book))</span><br><span class="line">                .hasJsonPathStringValue(<span class="string">&quot;@.name&quot;</span>);</span><br><span class="line">        Assertions.assertThat(jacksonTester.write(book))</span><br><span class="line">                .extractingJsonPathStringValue(<span class="string">&quot;@.name&quot;</span>)</span><br><span class="line">                .isEqualTo(<span class="string">&quot;三国演义&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDeserialize</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String content = <span class="string">&quot;&#123;\&quot;id\&quot;:1,\&quot;name\&quot;:\&quot;三国演义\&quot;,\&quot;author\&quot;:\&quot;罗贯中\&quot;&#125;&quot;</span>;</span><br><span class="line"><span class="comment">//        Book book = new Book();</span></span><br><span class="line"><span class="comment">//        book.setId(1);</span></span><br><span class="line"><span class="comment">//        book.setName(&quot;三国演义&quot;);</span></span><br><span class="line"><span class="comment">//        book.setAuthor(&quot;罗贯中&quot;);</span></span><br><span class="line">        Assertions.assertThat(jacksonTester.parseObject(content).getName())</span><br><span class="line">                .isEqualTo(<span class="string">&quot;三国演义&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="第9章Spring-Boot缓存"><a href="#第9章Spring-Boot缓存" class="headerlink" title="第9章Spring Boot缓存"></a>第9章Spring Boot缓存</h2><p><code>Spring 3.1</code>中开始对<code>缓存</code>提供支持,核心思路是对<code>方法的缓存</code>,当开发者调用一个方法时,将<code>方法的参数</code>和<code>返回值</code>作为<code>key/value</code>缓存起来,当再次调用该方法时,如果<code>缓存中有数据</code>,就直接,从缓存中获取,否则再去执行该方法。但是, Spring中并未提供<code>缓存</code>的实现,而是提供了一套<code>缓存API</code>,开发者可以自由选择缓存的实现, 目前Spring Boot支持的缓存有如下几种:<code>Cache (JSR-107)</code>、<code>EhCache 2.x</code>、<code> Hazelcast</code>、<code>Infinispan</code>、<code>Couchbase </code>、<code>Redis</code>、<code>Caffeine</code>、<code>Simple</code></p>
<h3 id="9-1-Ehcache-2-x缓存"><a href="#9-1-Ehcache-2-x缓存" class="headerlink" title="9.1 Ehcache 2.x缓存."></a>9.1 Ehcache 2.x缓存.</h3><p><code>Ehcache</code>缓存在Java开发领域已是久负盛名,在<code>Spring Boot</code>中,只需要一个配置文件就可以将<code>Ehcache</code>集成到项目中。<code>Ehcache 2.x</code>的使用步骤如下。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-cache<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>net.sf.ehcache<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ehcache<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>2.添加缓存配置文件如果Ehcache的依赖存在,并且在classpath下有一个名为<code>ehcache2.xml</code>的<code>Ehcache配置文件</code>,那么<code>EhCacheCacheManager</code>将会自动作为缓存的实现。因此,在<code>resources</code>目录下创建ehcache.xml文件作为Ehcache缓存的配置文件,代码如下:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ehcache</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">diskStore</span> <span class="attr">path</span>=<span class="string">&quot;java.io.tmpdir/cache&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">defaultCache</span></span></span><br><span class="line"><span class="tag">            <span class="attr">maxElementsInMemory</span>=<span class="string">&quot;10000&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">eternal</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">timeToIdleSeconds</span>=<span class="string">&quot;120&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">timeToLiveSeconds</span>=<span class="string">&quot;120&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">overflowToDisk</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">diskPersistent</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">diskExpiryThreadIntervalSeconds</span>=<span class="string">&quot;120&quot;</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">cache</span> <span class="attr">name</span>=<span class="string">&quot;book_cache&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">maxElementsInMemory</span>=<span class="string">&quot;10000&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">eternal</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">timeToIdleSeconds</span>=<span class="string">&quot;120&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">timeToLiveSeconds</span>=<span class="string">&quot;120&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">overflowToDisk</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">diskPersistent</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">diskExpiryThreadIntervalSeconds</span>=<span class="string">&quot;10&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ehcache</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>这是一个常规的<code>Ehcache</code>配置文件,提供了两个缓存策略,一个是默认的,另一个名为<code>book-cache</code>.其中, </p>
<ul>
<li><code>name</code>表示缓存名称; <code>maxElementsInMemor</code>y表示缓存最大个数: </li>
<li><code>eternal</code>表示缓存对象是否永久有效,一旦设置了<code>永久有效</code>, <code>timeout</code>将不起作用; </li>
<li><code>timeToldleSeconds</code>表示缓存对象在失效前的允许闲置时间(单位:秒) ,当<code>eternal-false</code>对象不是永久有效时,该属性才生效;</li>
<li><code>timeToLiveSeconds</code>表示缓存对象在失效前允许存活的时间(单位:秒),当<code>eternal-false</code>对象不是永久有效时,该属性才生效; </li>
<li><code>overflowToDisk</code>表示当内存中的对象数量达到<code>maxElementsInMemory</code>时, Ehcache是否将对象写到磁盘中; </li>
<li><code>diskExpiryThreadIntervalSeconds</code>表示磁盘失效线程运行时间间隔。</li>
</ul>
<p>另外,如果开发者想自定义Ehcache配置文件的名称和位置,可以在<code>application.properties</code>中添加如下配置:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.cache.ehcache.config=classpath:ehcache2.xml</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableCaching</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CacheApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(CacheApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@CacheConfig(cacheNames = &quot;book_cache&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookDao</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    MyKeyGenerator myKeyGenerator;</span><br><span class="line">    <span class="meta">@Cacheable(keyGenerator = &quot;myKeyGenerator&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Book <span class="title">getBookById</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;getBookById&quot;</span>);</span><br><span class="line">        Book book = <span class="keyword">new</span> Book();</span><br><span class="line">        book.setId(id);</span><br><span class="line">        book.setName(<span class="string">&quot;三国演义&quot;</span>);</span><br><span class="line">        book.setAuthor(<span class="string">&quot;罗贯中&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> book;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@CachePut(key = &quot;#book.id&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Book <span class="title">updateBookById</span><span class="params">(Book book)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;updateBookById&quot;</span>);</span><br><span class="line">        book.setName(<span class="string">&quot;三国演义2&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> book;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@CacheEvict(key = &quot;#id&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteBookById</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;deleteBookById&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="9-2-Redis单机缓存"><a href="#9-2-Redis单机缓存" class="headerlink" title="9.2 Redis单机缓存"></a>9.2 Redis单机缓存</h3><h3 id="9-3-Redis集群缓存"><a href="#9-3-Redis集群缓存" class="headerlink" title="9.3 Redis集群缓存"></a>9.3 Redis集群缓存</h3><h4 id="9-3-1-搭建Redis集群"><a href="#9-3-1-搭建Redis集群" class="headerlink" title="9.3.1 搭建Redis集群."></a>9.3.1 搭建Redis集群.</h4><h4 id="9-3-2-配置缓存"><a href="#9-3-2-配置缓存" class="headerlink" title="9.3.2 配置缓存"></a>9.3.2 配置缓存</h4><h4 id="9-3-3-使用缓存"><a href="#9-3-3-使用缓存" class="headerlink" title="9.3.3 使用缓存"></a>9.3.3 使用缓存</h4><h2 id="第10章-Spring-Boot安全管理…"><a href="#第10章-Spring-Boot安全管理…" class="headerlink" title="第10章 Spring Boot安全管理…"></a>第10章 Spring Boot安全管理…</h2></div><div class="article-licensing box"><div class="licensing-title"><p>《Spring Boot+Vue全栈开发实战》读书笔记</p><p><a href="https://liruilongs.github.io/2021/06/18/Java/《Spring Boot+Vue全栈开发实战》读书笔记/">https://liruilongs.github.io/2021/06/18/Java/《Spring Boot+Vue全栈开发实战》读书笔记/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><a href="https://liruilongs.github.io"><p>山河已无恙</p></a></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2021-06-18</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2023-06-21</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a class="icon" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a><a class="icon" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="recommend-area"><div class="recommend-post"><span class="is-size-6 has-text-grey has-mr-7"># 相关文章</span><br><span>  1.<a class="is-size-6" href="/2024/07/02/K8s/%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2-%E8%BF%90%E7%BB%B4/k8s-%E7%8E%AF%E5%A2%83%E4%B8%8B%E7%9A%84-Java-Springboot-%E9%A1%B9%E7%9B%AE%E5%86%85%E5%AD%98%E6%8C%81%E7%BB%AD%E5%A2%9E%E9%95%BF%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90/" target="_blank">k8s 部署 Java SpringBoot 项目内存持续增长问题分析解决</a><br></span><span>  2.<a class="is-size-6" href="/2022/05/25/Java/%E5%9F%BA%E4%BA%8ESpringBoot%E7%9A%84%E8%BD%BB%E9%87%8F%E3%80%81%E9%9D%9E%E4%BE%B5%E5%85%A5%E5%BC%8F%E6%95%B0%E6%8D%AE%E5%BA%93%E6%95%B0%E6%8D%AE%E5%91%8A%E8%AD%A6%E5%99%A8/" target="_blank">基于SpringBoot的轻量、非侵入式数据库数据告警工具</a><br></span></div><div class="recommend-post"><span class="is-size-6 has-text-grey has-mr-7"># 推荐文章</span><br><span>  1.<a class="is-size-6" href="/2021/08/27/K8s/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/%E3%80%8AKubernetes%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-%E4%BB%8EDocker%E5%88%B0Kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A8%E6%8E%A5%E8%A7%A6%E3%80%8B%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" target="_blank">《Kubernetes权威指南:从Docker到Kubernetes实践全接触》读书笔记</a><br></span><span>  2.<a class="is-size-6" href="/2024/10/10/Git/Git-%E6%8F%90%E4%BA%A4%E4%BB%A3%E7%A0%81-reference-broken-%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86/" target="_blank">Git 提交代码 reference broken 问题处理</a><br></span><span>  3.<a class="is-size-6" href="/2022/11/19/Git/%E5%85%B3%E4%BA%8E-Git-%E9%87%8D%E5%86%99%E5%8E%86%E5%8F%B2%E7%9A%84%E4%B8%80%E4%BA%9B%E7%AC%94%E8%AE%B0/" target="_blank">关于 Git 重写历史的一些笔记</a><br></span><span>  4.<a class="is-size-6" href="/2022/08/02/Git/%E5%85%B3%E4%BA%8EGit%E5%88%86%E6%94%AF%E5%8F%98%E5%9F%BA%E6%93%8D%E4%BD%9C%E7%9A%84%E4%B8%80%E4%BA%9B%E7%AC%94%E8%AE%B0/" target="_blank">关于Git分支变基操作的一些笔记</a><br></span><span>  5.<a class="is-size-6" href="/2022/07/26/Git/%E5%85%B3%E4%BA%8EGit%E5%88%86%E6%94%AF%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E7%9A%84%E4%B8%80%E4%BA%9B%E7%AC%94%E8%AE%B0/" target="_blank">关于Git分支基础知识的一些笔记</a><br></span><span>  6.<a class="is-size-6" href="/2022/08/02/Git/%E5%85%B3%E4%BA%8EGit%E5%88%86%E6%94%AF%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%9A%84%E4%B8%80%E4%BA%9B%E7%AC%94%E8%AE%B0/" target="_blank">关于Git分支工作流的一些笔记</a><br></span></div></div><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/social-share.js/1.0.16/css/share.min.css"><div class="social-share"></div><script src="https://cdnjs.loli.net/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">喜欢这篇文章？打赏一下作者吧</h3><div class="buttons is-centered"><a class="button donate" data-type="alipay"><span class="icon is-small"><i class="fab fa-alipay"></i></span><span>支付宝</span><span class="qrcode"><img src="/img/alipay%EF%BF%A5.png" alt="支付宝"></span></a><a class="button donate" data-type="wechat"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>微信</span><span class="qrcode"><img src="/img/wechat%EF%BF%A5.png" alt="微信"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2021/06/20/anothe/%E8%AE%80%E6%9B%B8%E7%AD%86%E8%A8%98/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">讀書筆記</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2021/06/15/anothe/Openstack%20%E4%BA%91%E8%AE%A1%E7%AE%97%E7%AE%A1%E7%90%86%E5%B9%B3%E5%8F%B0%E2%80%9C%E6%89%AB%E7%9B%B2%E2%80%9C%20%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><span class="level-item">Openstack 云计算管理平台“扫盲“ 学习笔记</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--><div class="card"><div class="card-content"><div class="title is-5">评论</div><div id="comment-container"></div><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/gitalk/1.6.0/gitalk.css"><script> $.getScript('/js/gitalk.min.js', function () { 
            var gitalk = new Gitalk({
            language:'zh-CN',
            id: '5ac3c0993f04578ec4b1e3d5243a2780',
            repo: 'blog_comment',
            owner: 'LIRUILONGS',
            clientID: '9fdc9739266d48d5f62e',
            clientSecret: 'c1cc33697d099a2197650ec9dadcb16bd4904655',
            admin: ["LIRUILONGS"],
            createIssueManually: true,
            distractionFreeMode: true,
            perPage: 10,
            pagerDirection: 'last',
            proxy: 'https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token',
            
            enableHotKey: true,
            isLocked: false
        })
        gitalk.render('comment-container')});</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><li><a class="is-flex is-mobile" href="#写在前面"><span class="mr-2">1</span><span>写在前面</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#使用XML配置搭建SSM项目"><span class="mr-2">1.1</span><span>使用XML配置搭建SSM项目</span></a></li><li><a class="is-flex is-mobile" href="#使用-Java配置类搭建SSM项目"><span class="mr-2">1.2</span><span>使用 Java配置类搭建SSM项目</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#第1章Spring-Boot入门"><span class="mr-2">2</span><span>第1章Spring Boot入门</span></a></li><li><a class="is-flex is-mobile" href="#第2章-Spring-Boot基础配置"><span class="mr-2">3</span><span>第2章 Spring Boot基础配置</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#2-1不使用spring-boot-starter-parent"><span class="mr-2">3.1</span><span>2.1不使用spring-boot-starter-parent</span></a></li><li><a class="is-flex is-mobile" href="#2-2-Spring-BootApplication"><span class="mr-2">3.2</span><span>2.2 @Spring BootApplication.</span></a></li><li><a class="is-flex is-mobile" href="#2-3定制banner"><span class="mr-2">3.3</span><span>2.3定制banner</span></a></li><li><a class="is-flex is-mobile" href="#2-4-Web容器配置"><span class="mr-2">3.4</span><span>2.4 Web容器配置</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#2-4-3-Undertow配置"><span class="mr-2">3.4.1</span><span>2.4.3 Undertow配置</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#2-5-Properties配置"><span class="mr-2">3.5</span><span>2.5 Properties配置</span></a></li><li><a class="is-flex is-mobile" href="#2-6类型安全配置属性"><span class="mr-2">3.6</span><span>2.6类型安全配置属性.</span></a></li><li><a class="is-flex is-mobile" href="#2-7-YAML配置"><span class="mr-2">3.7</span><span>2.7 YAML配置</span></a></li><li><a class="is-flex is-mobile" href="#2-8-Profile"><span class="mr-2">3.8</span><span>2.8 Profile</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#不同的环境指定不同的配置文件"><span class="mr-2">3.8.1</span><span>不同的环境指定不同的配置文件</span></a></li></ul></li></ul></li><li><a class="is-flex is-mobile" href="#第3章Spring-Boot整合视图层技术"><span class="mr-2">4</span><span>第3章Spring Boot整合视图层技术</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#3-1整合Thymeleaf"><span class="mr-2">4.1</span><span>3.1整合Thymeleaf</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#2．配置Thymeleaf"><span class="mr-2">4.1.1</span><span>2．配置Thymeleaf</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#3-2整合FreeMarke"><span class="mr-2">4.2</span><span>3.2整合FreeMarke</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#配置FreeMarker"><span class="mr-2">4.2.1</span><span>配置FreeMarker</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#3-3-整合-JSP"><span class="mr-2">4.3</span><span>3.3 整合 JSP</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#第4章-Spring-Boot整合Web开发"><span class="mr-2">5</span><span>第4章 Spring Boot整合Web开发.</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#4-1返回JSON数据"><span class="mr-2">5.1</span><span>4.1返回JSON数据</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#fastison"><span class="mr-2">5.1.1</span><span>fastison</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#4-2静态资源访问"><span class="mr-2">5.2</span><span>4.2静态资源访问</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#4-2-2自定义策略"><span class="mr-2">5.2.1</span><span>4.2.2自定义策略</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#4-3文件上传"><span class="mr-2">5.3</span><span>4.3文件上传.</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#4-3-3AJAX文件上传"><span class="mr-2">5.3.1</span><span>4.3.3AJAX文件上传</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#4-4-ControllerAdvice"><span class="mr-2">5.4</span><span>4.4 @ControllerAdvice</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#4-4-3-请求参数预处理"><span class="mr-2">5.4.1</span><span>4.4.3 请求参数预处理</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#4-5-自定义错误页"><span class="mr-2">5.5</span><span>4.5 自定义错误页</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#3-完全自定义"><span class="mr-2">5.5.1</span><span>3,完全自定义</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#4-6-CORS支持"><span class="mr-2">5.6</span><span>4.6 CORS支持</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#3-配置跨域"><span class="mr-2">5.6.1</span><span>3.配置跨域</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#4-7配置类与XML配置"><span class="mr-2">5.7</span><span>4.7配置类与XML配置.</span></a></li><li><a class="is-flex is-mobile" href="#4-8注册拦截器"><span class="mr-2">5.8</span><span>4.8注册拦截器</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#配置拦截器。定义配置类进行拦截器的配置-代码如下"><span class="mr-2">5.8.1</span><span>配置拦截器。定义配置类进行拦截器的配置,代码如下:</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#4-9启动系统任务"><span class="mr-2">5.9</span><span>4.9启动系统任务</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#4-9-2-ApplicationRunner"><span class="mr-2">5.9.1</span><span>4.9.2 ApplicationRunner</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#4-10整合Servlet-Filter和Listener"><span class="mr-2">5.10</span><span>4.10整合Servlet, Filter和Listener.</span></a></li><li><a class="is-flex is-mobile" href="#4-11-路径映射"><span class="mr-2">5.11</span><span>4.11 路径映射.</span></a></li><li><a class="is-flex is-mobile" href="#4-12-配置AOP"><span class="mr-2">5.12</span><span>4.12 配置AOP</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#4-12-2-Spring-Boot支持"><span class="mr-2">5.12.1</span><span>4.12.2 Spring Boot支持</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#4-13-其他"><span class="mr-2">5.13</span><span>4.13 其他</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#4-13-4-使用类型转化器"><span class="mr-2">5.13.1</span><span>4.13.4 使用类型转化器</span></a></li></ul></li></ul></li><li><a class="is-flex is-mobile" href="#第5章Spring-Boot整合持久层技术"><span class="mr-2">6</span><span>第5章Spring Boot整合持久层技术.</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#5-1-整合JdbcTemplate"><span class="mr-2">6.1</span><span>5.1 整合JdbcTemplate</span></a></li><li><a class="is-flex is-mobile" href="#5-2整合MyBatis"><span class="mr-2">6.2</span><span>5.2整合MyBatis</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#配置pom-xml文件"><span class="mr-2">6.2.1</span><span>配置pom.xml文件</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#5-3整合Spring-Data-JPA"><span class="mr-2">6.3</span><span>5.3整合Spring Data JPA</span></a></li><li><a class="is-flex is-mobile" href="#5-4多数据源"><span class="mr-2">6.4</span><span>5.4多数据源.</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#5-4-3-JPA多数据源"><span class="mr-2">6.4.1</span><span>5.4.3 JPA多数据源</span></a></li></ul></li></ul></li><li><a class="is-flex is-mobile" href="#第6章Spring-Boot整合NosQL"><span class="mr-2">7</span><span>第6章Spring Boot整合NosQL</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#6-1整合Redis"><span class="mr-2">7.1</span><span>6.1整合Redis</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#1-搭建Redis集群"><span class="mr-2">7.1.1</span><span>1,搭建Redis集群</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#6-2-整合MongoDB"><span class="mr-2">7.2</span><span>6.2 整合MongoDB.</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#6-2-3-MongoDB整合Spring-Boot"><span class="mr-2">7.2.1</span><span>6.2.3 MongoDB整合Spring Boot.</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#6-3-Session共享"><span class="mr-2">7.3</span><span>6.3 Session共享</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#6-3-2-Nginx负载均衡"><span class="mr-2">7.3.1</span><span>6.3.2 Nginx负载均衡</span></a></li></ul></li></ul></li><li><a class="is-flex is-mobile" href="#第7章构建RESTful服务"><span class="mr-2">8</span><span>第7章构建RESTful服务</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#7-1-REST简介"><span class="mr-2">8.1</span><span>7.1 REST简介</span></a></li><li><a class="is-flex is-mobile" href="#7-2-JPA实现REST"><span class="mr-2">8.2</span><span>7.2 JPA实现REST</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#7-2-1-基本实现"><span class="mr-2">8.2.1</span><span>7.2.1 基本实现</span></a></li><li><a class="is-flex is-mobile" href="#7-2-2-自定义请求路径"><span class="mr-2">8.2.2</span><span>7.2.2 自定义请求路径</span></a></li><li><a class="is-flex is-mobile" href="#7-2-3-自定义查询方法"><span class="mr-2">8.2.3</span><span>7.2.3 自定义查询方法.</span></a></li><li><a class="is-flex is-mobile" href="#7-2-4-隐藏方法"><span class="mr-2">8.2.4</span><span>7.2.4 隐藏方法</span></a></li><li><a class="is-flex is-mobile" href="#7-2-5-配置CORS"><span class="mr-2">8.2.5</span><span>7.2.5 配置CORS</span></a></li><li><a class="is-flex is-mobile" href="#application-properties配置"><span class="mr-2">8.2.6</span><span>application.properties配置</span></a></li><li><a class="is-flex is-mobile" href="#7-2-7-JPA使用rest自定义链接"><span class="mr-2">8.2.7</span><span>7.2.7 JPA使用rest自定义链接</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#7-3-MongoDB实现REST"><span class="mr-2">8.3</span><span>7.3 MongoDB实现REST</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#第8章开发者工具与单元测试"><span class="mr-2">9</span><span>第8章开发者工具与单元测试</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#8-1-devtools简介"><span class="mr-2">9.1</span><span>8.1 devtools简介</span></a></li><li><a class="is-flex is-mobile" href="#8-2-devtools实战"><span class="mr-2">9.2</span><span>8.2 devtools实战</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#8-2-1-基本用法"><span class="mr-2">9.2.1</span><span>8.2.1 基本用法</span></a></li><li><a class="is-flex is-mobile" href="#8-2-2-基本原理"><span class="mr-2">9.2.2</span><span>8.2.2 基本原理</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#8-3单元测试"><span class="mr-2">9.3</span><span>8.3单元测试</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#8-3-1-基本用法"><span class="mr-2">9.3.1</span><span>8.3.1 基本用法</span></a></li><li><a class="is-flex is-mobile" href="#8-3-2-Service测试"><span class="mr-2">9.3.2</span><span>8.3.2 Service测试</span></a></li><li><a class="is-flex is-mobile" href="#8-3-3-Controller测试"><span class="mr-2">9.3.3</span><span>8.3.3 Controller测试.</span></a></li><li><a class="is-flex is-mobile" href="#8-3-4-JSON测试"><span class="mr-2">9.3.4</span><span>8.3.4 JSON测试</span></a></li></ul></li></ul></li><li><a class="is-flex is-mobile" href="#第9章Spring-Boot缓存"><span class="mr-2">10</span><span>第9章Spring Boot缓存</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#9-1-Ehcache-2-x缓存"><span class="mr-2">10.1</span><span>9.1 Ehcache 2.x缓存.</span></a></li><li><a class="is-flex is-mobile" href="#9-2-Redis单机缓存"><span class="mr-2">10.2</span><span>9.2 Redis单机缓存</span></a></li><li><a class="is-flex is-mobile" href="#9-3-Redis集群缓存"><span class="mr-2">10.3</span><span>9.3 Redis集群缓存</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#9-3-1-搭建Redis集群"><span class="mr-2">10.3.1</span><span>9.3.1 搭建Redis集群.</span></a></li><li><a class="is-flex is-mobile" href="#9-3-2-配置缓存"><span class="mr-2">10.3.2</span><span>9.3.2 配置缓存</span></a></li><li><a class="is-flex is-mobile" href="#9-3-3-使用缓存"><span class="mr-2">10.3.3</span><span>9.3.3 使用缓存</span></a></li></ul></li></ul></li><li><a class="is-flex is-mobile" href="#第10章-Spring-Boot安全管理…"><span class="mr-2">11</span><span>第10章 Spring Boot安全管理…</span></a></li></ul></div></div><style>.menu-list > li > a.is-active + .menu-list { display: block; }.menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="card widget" data-type="profile"><div class="card-content"><nav class=""><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7.jpg" alt="山河已无恙"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">山河已无恙</p><p class="is-size-6 is-block">爱自己，是终生浪漫的开始</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>中国·呼和浩特</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">442</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">144</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">191</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://mp.weixin.qq.com/s?__biz=MzkyNjIxNTYwMw==&amp;mid=2247496480&amp;idx=1&amp;sn=a9971fed3962ef2a1aeda1f0bda65f86&amp;chksm=c2380ffcf54f86eaba8daac6caca72a70f38e61a8d25dc2a66d3a17b87c02530e326dcaea14b#rd" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/LIRUILONGS"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="CSDN" href="https://liruilong.blog.csdn.net/"><i class="fa fa-code"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Email" href="mailto:1224965096@qq.com"><i class="fa fa-envelope"></i></a></div></div></div><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://liruilong.blog.csdn.net/?t=1&amp;type=blog" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">CSDN</span></span><span class="level-right"><span class="level-item tag">liruilong.blog.csdn.net</span></span></a></li><li><a class="level is-mobile" href="https://www.cnblogs.com/liruilong/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">博客园</span></span><span class="level-right"><span class="level-item tag">www.cnblogs.com</span></span></a></li><li><a class="level is-mobile" href="https://github.com/LIRUILONGS" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Githup</span></span><span class="level-right"><span class="level-item tag">github.com</span></span></a></li><li><a class="level is-mobile" href="https://gitee.com/liruilonger" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">码云</span></span><span class="level-right"><span class="level-item tag">gitee.com</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><h3 class="menu-label">最新评论</h3><span class="body_hot_comment">加载中，最新评论有1分钟缓存...</span></div></div><div class="card widget"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-05-12T11:03:27.000Z">2025-05-12</time></p><p class="title"><a href="/2025/05/12/%E5%BE%85%E5%8F%91%E5%B8%83/%E8%85%BE%E8%AE%AFAI%E6%99%BA%E8%83%BD%E7%BC%96%E7%A8%8B%E4%BC%99%E4%BC%B4-CodeBuddy-%E5%B0%9D%E9%B2%9C%EF%BC%8C%E5%B8%A6%E4%BD%A0%E8%AE%A4%E8%AF%86%E4%B8%AD%E5%9B%BD%E7%89%88-Cursor/">腾讯云代码助手 CodeBuddy 尝鲜，带你认识中国版 Cursor</a></p><p class="categories"><a href="/categories/test3/">test3</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-04-17T23:32:10.000Z">2025-04-18</time></p><p class="title"><a href="/2025/04/18/%E5%BE%85%E5%8F%91%E5%B8%83/%E8%AE%A4%E8%AF%86%20Linux%20%E5%86%85%E5%AD%98%E6%9E%84%E6%88%90%EF%BC%9ALinux%20%E5%86%85%E5%AD%98%E8%B0%83%E4%BC%98%E4%B9%8B%E9%A1%B5%E8%A1%A8%E3%80%81TLB%E3%80%81%E5%A4%A7%E9%A1%B5%E8%AE%A4%E7%9F%A5/">认识 Linux 内存构成：Linux 内存调优之页表、TLB、缺页异常、大页认知</a></p><p class="categories"><a href="/categories/Linux/">Linux</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-04-13T14:50:54.000Z">2025-04-13</time></p><p class="title"><a href="/2025/04/13/%E5%BE%85%E5%8F%91%E5%B8%83/%E8%B0%B7%E6%AD%8C68%E9%A1%B5%E7%99%BD%E7%9A%AE%E4%B9%A6%E8%A7%A3%E5%AF%86%EF%BC%9A%E6%8F%90%E7%A4%BA%E5%B7%A5%E7%A8%8B%E5%A6%82%E4%BD%95%E9%87%8D%E5%A1%91AI%E4%BA%A4%E4%BA%92%E9%80%BB%E8%BE%91/">谷歌68页白皮书解密：提示工程如何重塑AI交互逻辑</a></p><p class="categories"><a href="/categories/LLM/">LLM</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-04-11T11:38:12.000Z">2025-04-11</time></p><p class="title"><a href="/2025/04/11/%E5%BE%85%E5%8F%91%E5%B8%83/Linux%20%E7%B3%BB%E7%BB%9F%E5%86%85%E5%AD%98%E7%9B%91%E6%8E%A7%EF%BC%9ALinux%20%E5%86%85%E5%AD%98%E8%B0%83%E4%BC%98%E4%B9%8B%E7%B3%BB%E7%BB%9F%E5%86%85%E5%AD%98%E5%85%A8%E9%9D%A2%E7%9B%91%E6%8E%A7/">Linux 系统内存监控：Linux 内存调优之系统内存全面监控</a></p><p class="categories"><a href="/categories/Linux/">Linux</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-04-11T11:38:12.000Z">2025-04-11</time></p><p class="title"><a href="/2025/04/11/%E5%BE%85%E5%8F%91%E5%B8%83/Linux-%E8%BF%9B%E7%A8%8B%E5%86%85%E5%AD%98%E7%9B%91%E6%8E%A7%EF%BC%9ALinux-%E5%86%85%E5%AD%98%E8%B0%83%E4%BC%98%E4%B9%8B%E8%BF%9B%E7%A8%8B%E5%86%85%E5%AD%98%E6%B7%B1%E5%BA%A6%E7%9B%91%E6%8E%A7/">Linux 进程内存监控：Linux 内存调优之进程内存深度监控</a></p><p class="categories"><a href="/categories/Linux/">Linux</a></p></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/categories/AIGC/"><span class="level-start"><span class="level-item">AIGC</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/AdaFace/"><span class="level-start"><span class="level-item">AdaFace</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Ajax/"><span class="level-start"><span class="level-item">Ajax</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Ansible/"><span class="level-start"><span class="level-item">Ansible</span></span><span class="level-end"><span class="level-item tag">23</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/AppCube/"><span class="level-start"><span class="level-item">AppCube</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/BPF/"><span class="level-start"><span class="level-item">BPF</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Bind9/"><span class="level-start"><span class="level-item">Bind9</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/CI-CD/"><span class="level-start"><span class="level-item">CI/CD</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/CSS/"><span class="level-start"><span class="level-item">CSS</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Ceph/"><span class="level-start"><span class="level-item">Ceph</span></span><span class="level-end"><span class="level-item tag">22</span></span></a></li><a class="level is-mobile is-marginless" href="/categories/"><span class="level-start"><span class="level-item">查看全部&gt;&gt;</span></span></a></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/archives/2025/05/"><span class="level-start"><span class="level-item">五月 2025</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2025/04/"><span class="level-start"><span class="level-item">四月 2025</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2025/03/"><span class="level-start"><span class="level-item">三月 2025</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2025/02/"><span class="level-start"><span class="level-item">二月 2025</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2025/01/"><span class="level-start"><span class="level-item">一月 2025</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><a class="level is-mobile is-marginless" href="/archives/"><span class="level-start"><span class="level-item">查看全部&gt;&gt;</span></span></a></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/Kubernetes/"><span class="tag">Kubernetes</span><span class="tag is-grey-lightest">98</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Linux/"><span class="tag">Linux</span><span class="tag is-grey-lightest">57</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Ansible/"><span class="tag">Ansible</span><span class="tag is-grey-lightest">25</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Ceph/"><span class="tag">Ceph</span><span class="tag is-grey-lightest">22</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Python/"><span class="tag">Python</span><span class="tag is-grey-lightest">15</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Docker/"><span class="tag">Docker</span><span class="tag is-grey-lightest">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Git/"><span class="tag">Git</span><span class="tag is-grey-lightest">8</span></a></div><div class="control"><a class="tags has-addons" href="/tags/JAVA/"><span class="tag">JAVA</span><span class="tag is-grey-lightest">8</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%8D%8E%E4%B8%BA%E4%BA%91/"><span class="tag">华为云</span><span class="tag is-grey-lightest">8</span></a></div><div class="control"><a class="tags has-addons" href="/tags/BPF/"><span class="tag">BPF</span><span class="tag is-grey-lightest">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CPU/"><span class="tag">CPU</span><span class="tag is-grey-lightest">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Mysql/"><span class="tag">Mysql</span><span class="tag is-grey-lightest">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Go/"><span class="tag">Go</span><span class="tag is-grey-lightest">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/LLM/"><span class="tag">LLM</span><span class="tag is-grey-lightest">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/OpenShift/"><span class="tag">OpenShift</span><span class="tag is-grey-lightest">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%A8%8B%E5%BA%8F%E4%BA%BA%E7%94%9F/"><span class="tag">程序人生</span><span class="tag is-grey-lightest">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/DNS/"><span class="tag">DNS</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/OKD/"><span class="tag">OKD</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%91%84%E5%BD%B1%E6%9B%9D%E5%85%89/"><span class="tag">摄影曝光</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/selenium/"><span class="tag">selenium</span><span class="tag is-grey-lightest">4</span></a></div></div><div class="field is-grouped is-grouped-multiline"><a class="tags has-addons" href="/tags/"><span class="tag">查看全部&gt;&gt;</span></a></div></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">订阅更新</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="订阅"></div></div></form></div></div></div><!--!--><div class="column-right-shadow is-hidden-widescreen is-sticky"></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.png" alt="山河已无恙" height="28"></a><p class="size-small"><span>&copy; 2025 山河已无恙</span>  Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank">Icarus</a> &amp; <a href="https://github.com/removeif/hexo-theme-amazing" target="_blank">Amazing</a> <br><span>© <a href="http://www.beian.miit.gov.cn/" target="_blank">备案中</a><br></span><span>© 版权说明：[本网站所有内容均收集于互联网或自己创作,<br />&nbsp;&nbsp;&nbsp;&nbsp;方便于网友与自己学习交流，如有侵权，请<a href="/message" target="_blank">留言</a>，立即处理]<br /></span><span><span id="statistic-times">loading...</span><script>function createTime(time) {
            var n = new Date(time);
            now.setTime(now.getTime() + 250),
                days = (now - n) / 1e3 / 60 / 60 / 24,
                dnum = Math.floor(days),
                hours = (now - n) / 1e3 / 60 / 60 - 24 * dnum,
                hnum = Math.floor(hours),
            1 == String(hnum).length && (hnum = "0" + hnum),
                minutes = (now - n) / 1e3 / 60 - 1440 * dnum - 60 * hnum,
                mnum = Math.floor(minutes),
            1 == String(mnum).length && (mnum = "0" + mnum),
                seconds = (now - n) / 1e3 - 86400 * dnum - 3600 * hnum - 60 * mnum,
                snum = Math.round(seconds),
            1 == String(snum).length && (snum = "0" + snum),
                document.getElementById("statistic-times").innerHTML = "❤️本站自 <strong>"+time.split(" ")[0].replace(/\//g,".")+"</strong> 已运行 <strong>" + dnum + "</strong> 天 <strong>" + hnum + "</strong> 小时 <strong>" + mnum + "</strong> 分 <strong>" + snum + "</strong> 秒！❤️";
        }var now = new Date();setInterval("createTime('2021/6/26 21:27:00')", 250,"");</script><br></span><div class="size-small"><span>❤️感谢 <strong><span id="busuanzi_value_site_uv">99+</span></strong> 小伙伴的 <strong><span id="busuanzi_value_site_pv">99+</span></strong> 次光临！❤️</span></div></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/removeif/hexo-theme-amazing"><i class="fab fa-github"></i></a></p></div><div class="sideMusic"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="/js/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script><meting-js style="width: auto;height: 2000px;" server="netease" type="playlist" id="2364053447" theme="#2980b9" loop="all" autoplay="false" order="list" storageName="aplayer-setting" lrctype="0" list-max-height="400px" fixed="true"></meting-js></div></div></div></div></footer><script src="https://cdnjs.loli.net/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script><script src="https://cdnjs.loli.net/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" async></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><!--!--><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><script src="https://cdnjs.loli.net/ajax/libs/lightgallery/1.6.8/js/lightgallery.min.js" defer></script><script src="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.7.0/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/KaTeX/0.11.1/katex.min.css"><script src="https://cdnjs.loli.net/ajax/libs/KaTeX/0.11.1/katex.min.js" defer></script><script src="https://cdnjs.loli.net/ajax/libs/KaTeX/0.11.1/contrib/auto-render.min.js" defer></script><script src="https://cdnjs.loli.net/ajax/libs/KaTeX/0.11.1/contrib/mhchem.js" defer></script><script>window.addEventListener("load", function() {
            document.querySelectorAll('[role="article"] > .content').forEach(function(element) {
                renderMathInElement(element);
            });
        });</script><script type="text/x-mathjax-config">MathJax.Hub.Config({
            'HTML-CSS': {
                matchFontHeight: false
            },
            SVG: {
                matchFontHeight: false
            },
            CommonHTML: {
                matchFontHeight: false
            },
            tex2jax: {
                inlineMath: [
                    ['$','$'],
                    ['\\(','\\)']
                ]
            }
        });</script><script src="https://cdnjs.loli.net/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><div id="outdated"><h6>Your browser is out-of-date!</h6><p>Update your browser to view this website correctly.&amp;npsb;<a id="btnUpdateBrowser" target="_blank" rel="noopener" href="http://outdatedbrowser.com/">Update my browser now </a></p><p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">×</a></p></div><script src="https://cdnjs.loli.net/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.js" defer></script><script>window.addEventListener("load", function () {
            outdatedBrowser({
                bgColor: '#f25648',
                color: '#ffffff',
                lowerThan: 'object-fit' // display on IE11 or below
            });
        });</script><!--!--><script src="/js/main.js" defer></script><script>$.getScript('/js/comment-issue-data.js',function(){loadIssueData('9fdc9739266d48d5f62e','c1cc33697d099a2197650ec9dadcb16bd4904655','LIRUILONGS','blog_comment',false);})</script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.js"></script><script type="text/javascript">var pjax = new Pjax({
            elements: "a",//代表点击链接就更新
            selectors: [  //代表要更新的节点
                ".section",
                "title"
            ],
            cache: true,
            cacheBust:false
        })

        function loadBusuanzi(){
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js", function () {});
        }

        function loadMathJax() { //加载mathjax
            $.getScript("//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML", function () {
                MathJax.Hub.Config({ tex2jax: { inlineMath: [['$', '$'], ['\(', '\)']] } });
                var math = document.getElementsByClassName("entry-content")[0];
                MathJax.Hub.Queue(["Typeset", MathJax.Hub, math]);
            });
        };

        // 开始 PJAX 执行的函数
        document.addEventListener('pjax:send', function () {
        });
        
        // PJAX 完成之后执行的函数，可以和上面的重载放在一起
        document.addEventListener('pjax:complete', function () {
            $(".section").css({opacity:1});
            if(true){
                $.getScript('/js/comment-issue-data.js',function(){loadIssueData('9fdc9739266d48d5f62e','c1cc33697d099a2197650ec9dadcb16bd4904655','LIRUILONGS','blog_comment',false);});
            }
            if(false){
                loadMathJax();
            }
            loadMainJs(jQuery, window.moment, window.ClipboardJS, window.IcarusThemeSettings);
            loadBackTop();
            loadBusuanzi();
            if(typeof loadBanner == 'function'){
                loadBanner();
            }
        });</script></body></html>