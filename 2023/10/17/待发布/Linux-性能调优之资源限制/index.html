<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Linux 性能调优之资源限制 - 山河已无恙</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="山河已无恙"><meta name="msapplication-TileImage" content="https://cdn.jsdelivr.net/gh/removeif/removeif-demo@latest/img/favicon.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="山河已无恙"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta description="对每个人而言，真正的职责只有一个：找到自我。然后在心中坚守其一生，全心全意，永不停息。所有其它的路都是不完整的，是人的逃避方式，是对大众理想的懦弱回归，是随波逐流，是对内心的恐惧 ——赫尔曼·黑塞《德米安》"><meta property="og:type" content="blog"><meta property="og:title" content="山河已无恙"><meta property="og:url" content="https://liruilong.blog.csdn.net/?t=1&amp;type=blog"><meta property="og:site_name" content="山河已无恙"><meta property="og:description" content="对每个人而言，真正的职责只有一个：找到自我。然后在心中坚守其一生，全心全意，永不停息。所有其它的路都是不完整的，是人的逃避方式，是对大众理想的懦弱回归，是随波逐流，是对内心的恐惧 ——赫尔曼·黑塞《德米安》"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://liruilong.blog.csdn.net/img/头像.jpg"><meta property="article:published_time" content="2023-10-17T11:31:42.000Z"><meta property="article:modified_time" content="2023-11-02T12:52:54.319Z"><meta property="article:author" content="LIRUILONGS"><meta property="article:tag" content="Linux"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/头像.jpg"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://liruilongs.github.io/2023/10/17/%E5%BE%85%E5%8F%91%E5%B8%83/Linux-%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98%E4%B9%8B%E8%B5%84%E6%BA%90%E9%99%90%E5%88%B6/"},"headline":"山河已无恙","image":["https://img-blog.csdnimg.cn/85078e99a6734c2690f72626956af4df.png"],"datePublished":"2023-10-17T11:31:42.000Z","dateModified":"2023-11-02T12:52:54.319Z","author":{"@type":"Person","name":"山河已无恙"},"description":"对每个人而言，真正的职责只有一个：找到自我。然后在心中坚守其一生，全心全意，永不停息。所有其它的路都是不完整的，是人的逃避方式，是对大众理想的懦弱回归，是随波逐流，是对内心的恐惧 ——赫尔曼·黑塞《德米安》"}</script><link rel="canonical" href="https://liruilongs.github.io/2023/10/17/%E5%BE%85%E5%8F%91%E5%B8%83/Linux-%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98%E4%B9%8B%E8%B5%84%E6%BA%90%E9%99%90%E5%88%B6/"><link rel="alternate" href="/path/to/atom.xml" title="山河已无恙" type="application/atom+xml"><link rel="icon" href="https://cdn.jsdelivr.net/gh/removeif/removeif-demo@latest/img/favicon.png"><meta name="referrer" content="no-referrer-when-downgrade"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/5.12.0/css/all.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/highlight.js/9.12.0/styles/dracula.min.css"><link rel="stylesheet" href="https://fonts.loli.net/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/5.12.0/css/all.min.css"><link rel="stylesheet" href="https://fonts.loli.net/css?family=Ubuntu:400,600|Source+Code+Pro|Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Microsoft YaHei:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&amp;amp;subset=latin,latin-ext|Inconsolata|Itim|Lobster.css"><script src="https://cdnjs.loli.net/ajax/libs/jquery/3.3.1/jquery.min.js"></script><script src="/js/globalUtils.js"></script><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><script>var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?3f06f2b732a5b1034c989f74e28d0eea";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();</script><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.7.0/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.css"><script src="https://cdnjs.loli.net/ajax/libs/pace/1.0.2/pace.min.js"></script><meta name="generator" content="Hexo 5.4.2"></head><body class="is-3-column has-navbar-fixed-top"><nav class="navbar navbar-main is-fixed-top"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.png" alt="山河已无恙" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">首页</a><a class="navbar-item" href="/archives">归档</a><a class="navbar-item" href="/categories">分类</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/media">影音</a><a class="navbar-item" href="/album">相册</a><a class="navbar-item" href="/friend">友链</a><a class="navbar-item" href="/self-talking">生活小记</a><a class="navbar-item" href="/message">留言墙</a><a class="navbar-item" href="/about">关于</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Gitee" href="https://gitee.com/liruilonger"><i class="fab fa-git-square fa-1x"></i></a><a class="navbar-item" target="_blank" rel="noopener" title="GitHub" href="https://github.com/LIRUILONGS"><i class="fab fa-github fa-1x"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul fa-1x"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search fa-1x"></i></a><a class="navbar-item" id="night-nav" title="Night Mode" href="javascript:;"><i class="fas fa-moon fa-1x" id="night-icon"></i></a></div></div></div></nav><script type="text/javascript" src="/js/theme-setting.js"></script><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-9-widescreen"><!--!--><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2023-10-17  <a class="commentCountImg" href="/2023/10/17/%E5%BE%85%E5%8F%91%E5%B8%83/Linux-%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98%E4%B9%8B%E8%B5%84%E6%BA%90%E9%99%90%E5%88%B6/#comment-container"><span class="display-none-class">4b494ce09d687054bdf99ad4180942a7</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="4b494ce09d687054bdf99ad4180942a7">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>1 小时  <i class="fas fa-pencil-alt"> </i>9.3 k</span><span class="level-item" id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span>次访问</span></div></div><h1 class="title is-3 is-size-4-mobile">Linux 性能调优之资源限制</h1><div class="content"><p><strong><font color="009688"> 对每个人而言，真正的职责只有一个：找到自我。然后在心中坚守其一生，全心全意，永不停息。所有其它的路都是不完整的，是人的逃避方式，是对大众理想的懦弱回归，是随波逐流，是对内心的恐惧 ——赫尔曼·黑塞《德米安》</strong></font></p>
<span id="more"></span>
<h2 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h2><hr>
<ul>
<li>考试整理相关笔记</li>
<li>博文内容涉及 Linux 中资源限制的两种方式简单介绍<ul>
<li>用户<code>会话资源</code>限制</li>
<li><code>进程资源</code>限制</li>
</ul>
</li>
<li>理解不足小伙伴帮忙指正</li>
</ul>
<p><strong><font color="009688"> 对每个人而言，真正的职责只有一个：找到自我。然后在心中坚守其一生，全心全意，永不停息。所有其它的路都是不完整的，是人的逃避方式，是对大众理想的懦弱回归，是随波逐流，是对内心的恐惧 ——赫尔曼·黑塞《德米安》</strong></font></p>
<hr>
<h1 id="使用-Cgroups-和-ulimit-管理资源限制"><a href="#使用-Cgroups-和-ulimit-管理资源限制" class="headerlink" title="使用 Cgroups 和 ulimit 管理资源限制"></a>使用 Cgroups 和 ulimit 管理资源限制</h1><p>在 Linux 中，资源控制有两种方式：</p>
<ul>
<li>一种是基于 <code>POSIX(依赖于PAM模块)</code>，<code>用户会话资源限制</code></li>
<li>一种基于 <code>Cgroup</code> ，主要用于<code>进程资源限制</code></li>
</ul>
<p>通过<code>资源限制</code>，可以对<code>单个进程</code>或者<code>用户会话</code>的资源的使用进行管理，保证系统的<code>稳定性</code>，以及系统上其他的用户和进程的 <code>QOS</code>，所以<code>调整合理的资源限制</code>也可以达到<code>调优</code>的作用。</p>
<h2 id="ulimit-会话资源限制"><a href="#ulimit-会话资源限制" class="headerlink" title="ulimit 会话资源限制"></a>ulimit 会话资源限制</h2><p>对于<code>多用户</code>的系统<code>不限制资源</code>本身可能就是一种<code>不公平</code>， 限制系统资源比较老的方式是使用 <code>ulimit</code>，由 <code>PAM</code> 模块在<code>登录</code>和<code>会话启动时</code>强制实施，<code>ulimit</code> 命令是<code>bash</code> 内置命令，主要限制了 <code>shell</code> 及其<code>子进程</code>可用的资源</p>
<h3 id="ulimit-如何限制资源"><a href="#ulimit-如何限制资源" class="headerlink" title="ulimit 如何限制资源"></a>ulimit 如何限制资源</h3><p>在<code>/etc/pam.d/system-auth</code> 文件中调用了 <code>pam_limits</code> 模块，此模块读取 <code>/etc/security/limits.conf</code> 和<br> <code>/etc/security/limits.d/</code>，按配置文件设置资源限制。 查看模块帮助文档 <code>man pam limits</code></p>
<p><strong><code>/etc/pam.d/system-auth</code> 是什么？</strong></p>
<p><code>/etc/pam.d/system-auth</code> 是一个 <code>PAM（Pluggable Authentication Modules）</code>配置文件。在 Linux 系统中，PAM 提供了一种灵活的方式来配置<code>用户认证、授权和会话管理</code></p>
<p>该文件是一个包含 <code>PAM</code> 配置行的文本文件，用于定义不同的认证、授权和会话模块及其参数。<code>PAM 模块</code>负责处理<code>用户登录、密码验证、权限检查</code>等操作。</p>
<p>查看文件中资源限制相关的模块，有时候我们做一些基线整改，可能需要修改该文件的相关配置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$cat</span> /etc/pam.d/system-auth  | grep pam_limits</span><br><span class="line">session     required                                     pam_limits.so</span><br><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─$</span><br></pre></td></tr></table></figure>

<p>在<code>PAM</code>配置中，<code>pam_limits.so</code> 模块被要求进行<code>会话限制</code></p>
<p><code>PAM（Pluggable Authentication Modules）</code>是一个用于对用户进行认证的系统级框架。<code>pam_limits.so</code> 模块是 PAM 框架的一部分，它用于设置<code>会话级别的资源限制</code>，例如<code>进程可打开的文件数、进程可使用的内存</code>等。</p>
<p><code>ulimit</code> 命令是用于限制<code>用户级别资源</code>的工具，它通常用于<code>控制 shell 进程</code>及其<code>子进程</code>的资源使用。修改 ulimit 值只会对当前 shell 会话有效，对其他用户或系统进程不会产生影响(不一定)</p>
<p>通过 ulimit 是限制系统资源的一种途径，ulimit 支持 <code>hard</code> 和 <code>soft</code> 限制</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&lt;type&gt; can have the two values:</span></span><br><span class="line"><span class="comment">#        - &quot;soft&quot; for enforcing the soft limits</span></span><br><span class="line"><span class="comment">#        - &quot;hard&quot; for enforcing hard limits</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#&lt;item&gt; can be one of the following:</span></span><br><span class="line"><span class="comment">#        - core - limits the core file size (KB)</span></span><br><span class="line"><span class="comment">#        - data - max data size (KB)</span></span><br><span class="line"><span class="comment">#        - fsize - maximum filesize (KB)</span></span><br><span class="line"><span class="comment">#        - memlock - max locked-in-memory address space (KB)</span></span><br><span class="line"><span class="comment">#        - nofile - max number of open file descriptors</span></span><br><span class="line"><span class="comment">#        - rss - max resident set size (KB)</span></span><br><span class="line"><span class="comment">#        - stack - max stack size (KB)</span></span><br><span class="line"><span class="comment">#        - cpu - max CPU time (MIN)</span></span><br><span class="line"><span class="comment">#        - nproc - max number of processes</span></span><br><span class="line"><span class="comment">#        - as - address space limit (KB)</span></span><br><span class="line"><span class="comment">#        - maxlogins - max number of logins for this user</span></span><br><span class="line"><span class="comment">#        - maxsyslogins - max number of logins on the system</span></span><br><span class="line"><span class="comment">#        - priority - the priority to run user process with</span></span><br><span class="line"><span class="comment">#        - locks - max number of file locks the user can hold</span></span><br><span class="line"><span class="comment">#        - sigpending - max number of pending signals</span></span><br><span class="line"><span class="comment">#        - msgqueue - max memory used by POSIX message queues (bytes)</span></span><br><span class="line"><span class="comment">#        - nice - max nice priority allowed to raise to values: [-20, 19]</span></span><br><span class="line"><span class="comment">#        - rtprio - max realtime priority</span></span><br></pre></td></tr></table></figure>

<p>普通用户可以设置自己的<code>软限制</code>，但不能高于<code>硬限制</code>。可以使用 <code>ulimit -a</code> 查看资源限制列表</p>
<p><code>软限制 (soft maxlogins)</code>：软限制是一个警告阈值，当达到或超过该限制时，系统会发出警告信息，但不会阻止用户登录。<br><code>硬限制 (hard maxlogins)</code>：硬限制是一个严格的限制，当达到或超过该限制时，系统将阻止用户登录。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$ulimit</span> -Hn <span class="comment">#限制数</span></span><br><span class="line">262144</span><br><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$ulimit</span> -Sn <span class="comment">#限制数</span></span><br><span class="line">1024</span><br><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─$</span><br></pre></td></tr></table></figure>

<p>当指定<code>限制数</code>时限制，不指定时输出当前<code>设置</code></p>
<p>通过配置文件的方式对登录次数进行限制,配置 <code>kiosk</code> 组 在多个终端中<code>只能同时登录 2 次</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$cat</span> /etc/security/limits.conf | grep -v ^<span class="comment"># | grep -v ^$</span></span><br><span class="line">@kiosk soft maxlogins 2</span><br><span class="line">@kiosk hard maxlogins 2</span><br><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─$</span><br></pre></td></tr></table></figure>

<p>其他的一些资源限制</p>
<ul>
<li><code>core</code>：核心文件大小限制（以 KB 为单位）</li>
<li><code>data</code>：最大数据大小限制（以 KB 为单位）</li>
<li><code>fsize</code>：最大文件大小限制（以 KB 为单位）</li>
<li><code>memlock</code>：最大锁定内存地址空间限制（以 KB 为单位）</li>
<li><code>nofile</code>：最大打开文件描述符数限制</li>
<li><code>rss</code>：最大常驻集大小限制（以 KB 为单位）</li>
<li><code>stack</code>：最大堆栈大小限制（以 KB 为单位）</li>
<li><code>cpu</code>：最大 CPU 时间限制（以分钟为单位）</li>
<li><code>nproc</code>：最大进程数限制</li>
<li><code>as</code>：地址空间限制（以 KB 为单位）</li>
<li><code>maxlogins</code>：此用户的最大登录数限制(单个用户)</li>
<li><code>maxsyslogins</code>：系统上的最大登录数限制(系统所有用户)</li>
<li><code>priority</code>：以给定优先级运行用户进程</li>
<li><code>locks</code>：用户可以持有的最大文件锁数限制</li>
<li><code>sigpending</code>：最大待处理信号数限制</li>
<li><code>msgqueue</code>：POSIX 消息队列使用的最大内存限制（以字节为单位）</li>
<li><code>nice</code>：允许提高到的最大 nice 优先级值（范围：-20 到 19）</li>
<li><code>rtprio</code>：最大实时优先级</li>
</ul>
<p>依次来看一下：</p>
<h4 id="core-limits-the-core-file-size-KB"><a href="#core-limits-the-core-file-size-KB" class="headerlink" title="core - limits the core file size (KB):"></a><code>core - limits the core file size (KB)</code>:</h4><p><code>corefile</code> 文件是对正在运行的进程的内存镜像(主要目的是当进程崩溃后，可以通过 <code>corefile</code> 排错)，默认值为 0(禁止 corefile)</p>
<p>核心文件是在程序发生崩溃或异常终止时生成的一种特殊文件。它包含了程序崩溃时的内存转储信息，可以用于调试和分析程序故障。通过设置 core 参数，你可以控制系统允许生成的核心文件的最大大小.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example limits.conf entry</span></span><br><span class="line">*      soft    core    0</span><br><span class="line">*      hard    core    unlimited</span><br></pre></td></tr></table></figure>

<p><code>soft core 0</code> 表示对所有用户（通配符 *）的核心文件大小进行软限制，将其限制为 0 KB。这意味着禁止生成任何核心文件。<br><code>hard core unlimited</code> 表示对所有用户的核心文件大小进行硬限制，允许生成无限大小的核心文件。</p>
<p>使用 <code>ulimit -c</code> 命令可以查看当前用户允许生成的核心文件的最大大小。如果该值为非零，则表示核心文件是启用的，并且发生崩溃时将在当前工作目录中生成。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$ulimit</span> -c</span><br><span class="line">unlimited</span><br><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─$</span><br></pre></td></tr></table></figure>

<p>核心文件的处理程序和命名规则,核心文件将由<code> /usr/lib/systemd/systemd-coredump</code> 程序进行处理，该程序根据提供的参数将核心转储保存到相应的位置<code>。%P：进程 ID（PID）,%e：错误代码 </code>…</p>
<p>保存位置参数</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$cat</span> /proc/sys/kernel/core_pattern</span><br><span class="line">|/usr/lib/systemd/systemd-coredump %P %u %g %s %t %c %h %e</span><br><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─$</span><br></pre></td></tr></table></figure>

<p>核心转储文件的保存位置：<code>systemd-coredump</code> 可以根据配置将核心转储文件保存到指定的位置。通常情况下，它们会被保存在 <code>/var/lib/systemd/coredump/</code> 目录下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$cd</span> /var/lib/systemd/coredump/</span><br><span class="line">┌──[root@liruilongs.github.io]-[/var/lib/systemd/coredump]</span><br><span class="line">└─<span class="variable">$ls</span></span><br></pre></td></tr></table></figure>

<h4 id="data-max-data-size-KB"><a href="#data-max-data-size-KB" class="headerlink" title="data - max data size (KB)"></a><code>data - max data size (KB)</code></h4><p>用于限制单个进程的<code>数据段（data segment）</code>的最大大小，以 KB 为单位。数据段是进程在运行过程中存储全局变量、静态变量和堆分配的<code>内存的区域</code>。</p>
<p><img src="https://img-blog.csdnimg.cn/85078e99a6734c2690f72626956af4df.png" alt="在这里插入图片描述"></p>
<ul>
<li><code>Text(文本)</code>: 存储可执行的代码:</li>
<li><code>Data(数据)</code>: Data 初始化数据 (如变量)BSS 初始化 0 数据(初始化数据为 0)</li>
<li><code>Heap(堆)</code>: 通过内存的 malloc 方法，动态内存分配(一般放数据)</li>
<li><code>Stack (栈)</code>: 存储局部变量，函数等</li>
</ul>
<p>查看当前用户限制值，并且修改</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$ulimit</span> -d</span><br><span class="line">unlimited</span><br><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$ulimit</span> -d 4194305</span><br><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$ulimit</span> -d</span><br><span class="line">4194305</span><br></pre></td></tr></table></figure>

<p>查看当前系统中的 <code>data - max data size</code> 参数值</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$sysctl</span> kernel.pid_max</span><br><span class="line">kernel.pid_max = 4194304</span><br><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─$</span><br></pre></td></tr></table></figure>

<h4 id="stack-max-stack-size-KB"><a href="#stack-max-stack-size-KB" class="headerlink" title="stack - max stack size (KB)"></a><code>stack - max stack size (KB)</code></h4><p>用于<code>限制单个进程的栈（stack）</code>的最大大小，以 KB 为单位。栈是用于存放函数调用和局部变量的内存区域。</p>
<p>查看配置 栈大小</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$ulimit</span> -s</span><br><span class="line">8192</span><br><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$ulimit</span> -s6</span><br><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$ulimit</span> -s</span><br><span class="line">6</span><br></pre></td></tr></table></figure>
<p>这里我们配置 单个进程栈大小为  <code>16</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$ulimit</span> -s 16</span><br><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$ulimit</span>  -a | grep stack</span><br><span class="line">stack size              (kbytes, -s) 16</span><br></pre></td></tr></table></figure>

<p>运行 <code>ls /etc/</code> 命令时，发生了段错误，并生成了一个核心转储文件。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$ls</span> /etc/</span><br><span class="line">Segmentation fault (core dumped)</span><br></pre></td></tr></table></figure>
<p>因为我们上面设置了 栈的大小，执行的命令存在栈溢出的情况，所以提示</p>
<p><code>Segmentation fault (core dumped)</code> 是一个错误消息，通常表示程序在访问无效的内存区域时发生了段错误。这可能是由于编程错误、内存损坏、栈溢出或其他原因导致的。</p>
<p>这里正好遇到第一个看到的 限制参数 <code>corefile</code> , 一起排查一下</p>
<p>到 <code>corefile</code> 的文件位置，可以看到生成了一个崩溃文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌──[root@liruilongs.github.io]-[/var/lib/systemd/coredump]</span><br><span class="line">└─<span class="variable">$ls</span></span><br><span class="line">core.ls.0.b8a76ac3ad1b411385973f9bcd0358e5.6767.1695224215000000.lz4</span><br></pre></td></tr></table></figure>

<p>也可以通过命令行的方式查看 <code>coredumpctl list</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">┌──[root@liruilongs.github.io]-[/var/lib/systemd/coredump]</span><br><span class="line">└─<span class="variable">$coredumpctl</span> list</span><br><span class="line">TIME                            PID   UID   GID SIG COREFILE  EXE</span><br><span class="line">Wed 2023-09-20 23:36:55 CST    6767     0     0  11 present   /usr/bin/ls</span><br></pre></td></tr></table></figure>

<p>运行以下命令以启动 <code>gdb</code> 并加载核心转储文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">┌──[root@liruilongs.github.io]-[/var/lib/systemd/coredump]</span><br><span class="line">└─<span class="variable">$coredumpctl</span> gbd 6767</span><br><span class="line">Unknown operation gbd.</span><br><span class="line">┌──[root@liruilongs.github.io]-[/var/lib/systemd/coredump]</span><br><span class="line">└─<span class="variable">$coredumpctl</span> gdb 6767</span><br><span class="line">           PID: 6767 (ls)</span><br><span class="line">           UID: 0 (root)</span><br><span class="line">           GID: 0 (root)</span><br><span class="line">        Signal: 11 (SEGV)</span><br><span class="line">     Timestamp: Wed 2023-09-20 23:36:55 CST (2min 38s ago)</span><br><span class="line">    Executable: /usr/bin/ls</span><br><span class="line"> Control Group: /user.slice/user-0.slice/session-5.scope</span><br><span class="line">          Unit: session-5.scope</span><br><span class="line">         Slice: user-0.slice</span><br><span class="line">       Session: 5</span><br><span class="line">     Owner UID: 0 (root)</span><br><span class="line">       Boot ID: b8a76ac3ad1b411385973f9bcd0358e5</span><br><span class="line">    Machine ID: 84136345e7d24e3286fd7c657f4e1cda</span><br><span class="line">      Hostname: liruilongs.github.io</span><br><span class="line">       Storage: /var/lib/systemd/coredump/core.ls.0.b8a76ac3ad1b411385973f9bcd0358e5.6767.1695224215000000.lz4</span><br><span class="line">       Message: Process 6767 (ls) of user 0 dumped core.</span><br><span class="line"></span><br><span class="line">                Stack trace of thread 6767:</span><br><span class="line">                <span class="comment">#0  0x00007fb8c122a53b n/a (n/a)</span></span><br><span class="line"></span><br><span class="line">Failed to invoke gdb: No such file or directory</span><br></pre></td></tr></table></figure>

<p>被告知 没有 <code>gdb</code> 这个文件，所有我们安装一下, 通过上面的输出信息，可以看到</p>
<ul>
<li><code>Signal 11 (SEGV)</code> 关键字，表示发生了<code>段错误</code>。段错误通常是由于程序访问了无效的<code>内存地址</code>导致的。</li>
<li><code>Executable: /usr/bin/ls</code>: 错误发生在 ls 可执行文件<code>（/usr/bin/ls）</code>中</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">┌──[root@liruilongs.github.io]-[/var/lib/systemd/coredump]</span><br><span class="line">└─<span class="variable">$yum</span> -y install gdb</span><br><span class="line">Updating Subscription Management repositories.</span><br><span class="line">Unable to <span class="built_in">read</span> consumer identity</span><br><span class="line">This system is not registered to Red Hat Subscription Management. You can use subscription-manager to register.</span><br><span class="line">Last metadata expiration check: 1:39:24 ago on Wed 20 Sep 2023 10:02:04 PM CST.</span><br><span class="line">Dependencies resolved.</span><br><span class="line">=======================================================================================================</span><br><span class="line"> Package              Arch        Version              Repository                                 Size</span><br><span class="line">=======================================================================================================</span><br><span class="line">Installing:</span><br><span class="line"> gdb                  x86_64      8.2-11.el8           ucf-rhel-8-for-x86_64-appstream-rpms      297 k</span><br><span class="line">Installing dependencies:</span><br><span class="line"> annobin              x86_64      8.90-1.el8           ucf-rhel-8-for-x86_64-appstream-rpms      202 k</span><br><span class="line"> cpp                  x86_64      8.3.1-5.el8          ucf-rhel-8-for-x86_64-appstream-rpms       10 M</span><br><span class="line"> gc                   x86_64      7.6.4-3.el8          ucf-rhel-8-for-x86_64-appstream-rpms      109 k</span><br><span class="line"> gcc                  x86_64      8.3.1-5.el8          ucf-rhel-8-for-x86_64-appstream-rpms       23 M</span><br><span class="line"> gdb-headless         x86_64      8.2-11.el8           ucf-rhel-8-for-x86_64-appstream-rpms      3.7 M</span><br><span class="line"> .....................</span><br></pre></td></tr></table></figure>

<p>安装好之后在次运行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">┌──[root@liruilongs.github.io]-[/var/lib/systemd/coredump]</span><br><span class="line">└─<span class="variable">$coredumpctl</span> gdb 6767</span><br><span class="line">           PID: 6767 (ls)</span><br><span class="line">           UID: 0 (root)</span><br><span class="line">           GID: 0 (root)</span><br><span class="line">        Signal: 11 (SEGV)</span><br><span class="line">     Timestamp: Wed 2023-09-20 23:36:55 CST (5min ago)</span><br><span class="line">    Executable: /usr/bin/ls</span><br><span class="line"> Control Group: /user.slice/user-0.slice/session-5.scope</span><br><span class="line">          Unit: session-5.scope</span><br><span class="line">         Slice: user-0.slice</span><br><span class="line">       Session: 5</span><br><span class="line">     Owner UID: 0 (root)</span><br><span class="line">       Boot ID: b8a76ac3ad1b411385973f9bcd0358e5</span><br><span class="line">    Machine ID: 84136345e7d24e3286fd7c657f4e1cda</span><br><span class="line">      Hostname: liruilongs.github.io</span><br><span class="line">       Storage: /var/lib/systemd/coredump/core.ls.0.b8a76ac3ad1b411385973f9bcd0358e5.6767.1695224215000000.lz4</span><br><span class="line">       Message: Process 6767 (ls) of user 0 dumped core.</span><br><span class="line"></span><br><span class="line">                Stack trace of thread 6767:</span><br><span class="line">                <span class="comment">#0  0x00007fb8c122a53b n/a (n/a)</span></span><br><span class="line"></span><br><span class="line">GNU gdb (GDB) Red Hat Enterprise Linux 8.2-11.el8</span><br><span class="line">Copyright (C) 2018 Free Software Foundation, Inc.</span><br><span class="line">License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;</span><br><span class="line">This is free software: you are free to change and redistribute it.</span><br><span class="line">There is NO WARRANTY, to the extent permitted by law.</span><br><span class="line">Type <span class="string">&quot;show copying&quot;</span> and <span class="string">&quot;show warranty&quot;</span> <span class="keyword">for</span> details.</span><br><span class="line">This GDB was configured as <span class="string">&quot;x86_64-redhat-linux-gnu&quot;</span>.</span><br><span class="line">Type <span class="string">&quot;show configuration&quot;</span> <span class="keyword">for</span> configuration details.</span><br><span class="line">For bug reporting instructions, please see:</span><br><span class="line">&lt;http://www.gnu.org/software/gdb/bugs/&gt;.</span><br><span class="line">Find the GDB manual and other documentation resources online at:</span><br><span class="line">    &lt;http://www.gnu.org/software/gdb/documentation/&gt;.</span><br><span class="line"></span><br><span class="line">For <span class="built_in">help</span>, <span class="built_in">type</span> <span class="string">&quot;help&quot;</span>.</span><br><span class="line">Type <span class="string">&quot;apropos word&quot;</span> to search <span class="keyword">for</span> commands related to <span class="string">&quot;word&quot;</span>...</span><br><span class="line">Reading symbols from /usr/bin/ls...Reading symbols from .gnu_debugdata <span class="keyword">for</span> /usr/bin/ls...(no debugging symbols found)...<span class="keyword">done</span>.</span><br><span class="line">(no debugging symbols found)...<span class="keyword">done</span>.</span><br><span class="line">[New LWP 6767]</span><br><span class="line">Core was generated by `ls --color=auto /etc LS_COLORS=rs=0:di=38;5;33:ln=38;5;51:mh=00:pi=40;38;5;11:s<span class="string">&#x27;.</span></span><br><span class="line"><span class="string">Program terminated with signal SIGSEGV, Segmentation fault.</span></span><br><span class="line"><span class="string">#0  0x00007fb8c122a53b in ?? ()</span></span><br><span class="line"><span class="string">Missing separate debuginfos, use: yum debuginfo-install coreutils-8.30-6.el8.x86_64</span></span><br><span class="line"><span class="string">(gdb) bt</span></span><br><span class="line"><span class="string">#0  0x00007fb8c122a53b in ?? ()</span></span><br><span class="line"><span class="string">Backtrace stopped: Cannot access memory at address 0x7ffc1adcfdb8</span></span><br><span class="line"><span class="string">(gdb)</span></span><br></pre></td></tr></table></figure>

<p>堆栈跟踪显示崩溃发生在地址 <code>0x00007fb8c122a53b</code> 处，但该地址没有可用的符号信息。使用 <code>gdb</code> 调试器分析核心转储文件。</p>
<p>当在 <code>gdb</code> 中执行 <code>bt</code> 命令时，它试图提供程序在崩溃点处的执行回溯。然而，在这种情况下，它无法访问地址 <code>0x7ffc1adcfdb8</code> 处的内存</p>
<p>OK ,先看到这里,我们还原一下配置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$ulimit</span> -s8192</span><br></pre></td></tr></table></figure>

<h4 id="fsize-maximum-filesize-KB"><a href="#fsize-maximum-filesize-KB" class="headerlink" title="fsize - maximum filesize (KB)"></a><code>fsize - maximum filesize (KB)</code></h4><p><code>fsize</code> 通常是指<code>文件大小</code>的<code>最大限制</code>。文件大小通常以字节为单位进行表示</p>
<p>查看修改配置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$ulimit</span> -f</span><br><span class="line">unlimited</span><br></pre></td></tr></table></figure>

<p>修改配置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$ulimit</span> -f 1500</span><br><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$ulimit</span> -Hf</span><br><span class="line">1500</span><br></pre></td></tr></table></figure>

<p>设置软限制大于硬限制，提示无法调整(<code>软限制不可以超过硬限制</code>)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$ulimit</span> -Sf 1600</span><br><span class="line">-bash: <span class="built_in">ulimit</span>: file size: cannot modify <span class="built_in">limit</span>: Invalid argument</span><br></pre></td></tr></table></figure>

<p>如果配置太小的话，创建一个文件会提示 超过了文件大小限制</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$dd</span> <span class="keyword">if</span>=/dev/zero of=a bs=3M count=1</span><br><span class="line">File size <span class="built_in">limit</span> exceeded (core dumped)</span><br><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─$</span><br></pre></td></tr></table></figure>

<p>查看文件大小的限制的 软限制和硬限制</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$ulimit</span> -f 1500</span><br><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$ulimit</span> -H -f</span><br><span class="line">1500</span><br><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$ulimit</span> -S -f</span><br><span class="line">1500</span><br><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─$</span><br></pre></td></tr></table></figure>

<h4 id="memlock-max-locked-in-memory-address-space-KB"><a href="#memlock-max-locked-in-memory-address-space-KB" class="headerlink" title="memlock - max locked-in-memory address space (KB)"></a>memlock - max locked-in-memory address space (KB)</h4><p><code>memlock</code> 参数用于设置进程的最大锁定内存地址空间（locked-in-memory address space）的大小。<code>锁定内存</code>是指将内存页固定在物理内存中，防止其被交换到磁盘上，<code>从而提高对这些内存页的访问速度</code>。</p>
<p>查看设置 <code>memlock</code> 配置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">┌──[root@liruilongs.github.io]-[/usr/lib/tuned]</span><br><span class="line">└─<span class="variable">$ulimit</span>  -l</span><br><span class="line">64</span><br><span class="line">┌──[root@liruilongs.github.io]-[/usr/lib/tuned]</span><br><span class="line">└─<span class="variable">$ulimit</span>  -Hl</span><br><span class="line">64</span><br><span class="line">┌──[root@liruilongs.github.io]-[/usr/lib/tuned]</span><br><span class="line">└─<span class="variable">$ulimit</span>  -Sl</span><br><span class="line">64</span><br><span class="line">┌──[root@liruilongs.github.io]-[/usr/lib/tuned]</span><br><span class="line">└─<span class="variable">$ulimit</span>  -l 1500</span><br><span class="line">┌──[root@liruilongs.github.io]-[/usr/lib/tuned]</span><br><span class="line">└─<span class="variable">$ulimit</span>  -Hl</span><br><span class="line">1500</span><br><span class="line">┌──[root@liruilongs.github.io]-[/usr/lib/tuned]</span><br><span class="line">└─$</span><br></pre></td></tr></table></figure>

<h4 id="nofile-max-number-of-open-file-descriptors"><a href="#nofile-max-number-of-open-file-descriptors" class="headerlink" title="nofile - max number of open file descriptors"></a>nofile - max number of open file descriptors</h4><p><code>nofile</code> 参数用于设置进程的<code>最大打开文件描述符数</code>（max number of open file descriptors）。文件描述符是用于<code>访问文件</code>或输入&#x2F;输出设备的整数标识符。</p>
<p>修改进程打开文件描述符为 3</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$ulimit</span> -n</span><br><span class="line">1024</span><br><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$ulimit</span> -n 3</span><br></pre></td></tr></table></figure>

<p>查看文件直接保存</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$cat</span> /et-bash: /dev/null: Too many open files</span><br><span class="line">-bash: redirection error: cannot duplicate fd: Too many open files</span><br><span class="line">-bash: 2: Too many open files</span><br><span class="line">-bash: /dev/null: Too many open files</span><br><span class="line">-bash: redirection error: cannot duplicate fd: Too many open files</span><br><span class="line">-bash: 2: Too many open files</span><br><span class="line"></span><br><span class="line">-bash: start_pipeline: pgrp pipe: Too many open files</span><br><span class="line">cat: error <span class="keyword">while</span> loading shared libraries: libc.so.6: cannot open shared object file: Error 24</span><br></pre></td></tr></table></figure>

<p>系统中打开的<code>文件描述符数量已达到或超过了限制</code>，导致无法再打开更多的文件</p>
<p>恢复配置,正常生产情况下  <code>nofile</code> 会配置相对大一点，尤其部署了数据库相关应用</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$ulimit</span> -n 1024</span><br><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$cat</span> /etc/</span><br><span class="line">Display all 289 possibilities? (y or n)^C</span><br><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─$</span><br></pre></td></tr></table></figure>

<h4 id="rss-max-resident-set-size-KB"><a href="#rss-max-resident-set-size-KB" class="headerlink" title="rss - max resident set size (KB)"></a>rss - max resident set size (KB)</h4><p><code>rss</code> 参数用于设置进程的<code>最大驻留集大小（max resident set size）</code>。驻留集是指进程当前在<code>物理内存</code>中使用的<code>内存量</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">┌──[kiosk@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$ulimit</span>  -m</span><br><span class="line">1000</span><br><span class="line">┌──[kiosk@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$ulimit</span> -m 500</span><br><span class="line">┌──[kiosk@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$ulimit</span>  -m</span><br><span class="line">500</span><br><span class="line">┌──[kiosk@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$ulimit</span>  -Hm</span><br><span class="line">500</span><br><span class="line">┌──[kiosk@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$ulimit</span>  -Sm</span><br><span class="line">500</span><br></pre></td></tr></table></figure>

<h4 id="cpu-max-CPU-time-MIN"><a href="#cpu-max-CPU-time-MIN" class="headerlink" title="cpu - max CPU time (MIN)"></a>cpu - max CPU time (MIN)</h4><p><code>ulimit -t &lt;minutes&gt;</code> 限制进程能够使用的 CPU 时间,设置的最大 CPU 时间限制,以分钟为单位</p>
<p>看一个 Demo，，这个 Demo 中，我们设置 最大 CPU 时间为 1 分钟，但是我们写了一个 特别消耗 CPU 的 脚本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$ulimit</span>  -t 1</span><br><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$ulimit</span>  -Ht</span><br><span class="line">1</span><br><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$python3</span> cpu_demo.py</span><br><span class="line">Killed</span><br><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$cat</span> /var/<span class="built_in">log</span>/messages | grep -i  Killed</span><br><span class="line">Oct  1 12:37:27 liruilongs rhsmd[60537]: rhsmd process exceeded runtime and was killed.</span><br></pre></td></tr></table></figure>

<p>执行时间超过一分钟，所以会被 Kill 掉。我们可以看日志提示，超过运行时间被 Kill 掉</p>
<p>测试的 py 脚本</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─$cat cpu_demo.py</span><br><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">@File    :   cpu_demo.py</span></span><br><span class="line"><span class="string">@Time    :   2023/10/20 07:07:04</span></span><br><span class="line"><span class="string">@Author  :   Li Ruilong</span></span><br><span class="line"><span class="string">@Version :   1.0</span></span><br><span class="line"><span class="string">@Contact :   liruilonger@gmail.com</span></span><br><span class="line"><span class="string">@Desc    :   CPU 限制测试脚本</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cpu_intensive_task</span>():</span></span><br><span class="line">    start_time = time.time()</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="comment"># 模拟计算密集型任务</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000000</span>):</span><br><span class="line">            result = i * i</span><br><span class="line">        elapsed_time = time.time() - start_time</span><br><span class="line">        <span class="keyword">if</span> elapsed_time &gt;= <span class="number">70</span>:  <span class="comment"># 设置运行时间为1分钟多一点</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    cpu_intensive_task()</span><br></pre></td></tr></table></figure>


<p>修改 cpu 参数时间为 15 分钟，脚本顺利执行。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$ulimit</span>  -t 15</span><br><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$ulimit</span>  -Ht</span><br><span class="line">15</span><br><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$python3</span> cpu_demo.py</span><br><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─$</span><br></pre></td></tr></table></figure>


<h4 id="nproc-max-number-of-processes"><a href="#nproc-max-number-of-processes" class="headerlink" title="nproc - max number of processes"></a>nproc - max number of processes</h4><p><code>最大进程数设置</code>，对普通用户有效，设置运行的最大进程数,超过最大进程数，会提示资源暂时不可用。</p>
<p>这里写个 shell，创建 30 个 sleep 进程</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$cat</span> demo.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> `seq 30`</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">        sleep 100 &amp;</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">┌──[kiosk@liruilongs.github.io]-[~]</span><br><span class="line">└─$</span><br></pre></td></tr></table></figure>

<p>修改最大进程数为 5 ,运行脚本，提示资源暂时不可用。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$ulimit</span> -u 5</span><br><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$chmod</span> 777 demo.sh</span><br><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─$./demo.sh</span><br><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$cp</span> demo.sh /home/kiosk/</span><br><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$su</span> kiosk</span><br><span class="line">┌──[kiosk@liruilongs.github.io]-[/root]</span><br><span class="line">└─<span class="variable">$cd</span> ~</span><br><span class="line">┌──[kiosk@liruilongs.github.io]-[~]</span><br><span class="line">└─$./demo.sh</span><br><span class="line">./demo.sh: fork: retry: Resource temporarily unavailable</span><br><span class="line">./demo.sh: fork: retry: Resource temporarily unavailable</span><br><span class="line">./demo.sh: fork: retry: Resource temporarily unavailable</span><br><span class="line">^C</span><br></pre></td></tr></table></figure>

<p>调整 nproc 的参数，可以顺利执行。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">┌──[kiosk@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$exit</span></span><br><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$ulimit</span> -u 158240</span><br><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$su</span> kiosk</span><br><span class="line">┌──[kiosk@liruilongs.github.io]-[/root]</span><br><span class="line">└─<span class="variable">$cd</span> ~</span><br><span class="line">┌──[kiosk@liruilongs.github.io]-[~]</span><br><span class="line">└─$./demo.sh</span><br></pre></td></tr></table></figure>

<p>这是一个生产中比较常见的一个场景，一般是开发代码的有问题，比如 SFTP 连接一直创建，不关闭</p>
<h4 id="as-address-space-limit-KB"><a href="#as-address-space-limit-KB" class="headerlink" title="as - address space limit (KB)"></a>as - address space limit (KB)</h4><p>进程的<code>虚拟地址空间限制</code>，以 KB 为单位</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$ulimit</span> -v 8186</span><br><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$ls</span></span><br><span class="line">ls: error <span class="keyword">while</span> loading shared libraries: libc.so.6: failed to map segment from shared object</span><br></pre></td></tr></table></figure>

<p>修改 as 的大小之后，提示 <code>ls</code> 命令无法加载共享库 libc.so.6，并且无法从共享对象映射段</p>
<p>在此调整提示段错误，可能存在内存溢出，</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$ulimit</span> -v 1024</span><br><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$ls</span></span><br><span class="line">Segmentation fault</span><br></pre></td></tr></table></figure>

<p>出现了段错误，调整为默认值，可以正常展示</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$ulimit</span> -v unlimited</span><br><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$ls</span></span><br><span class="line">a                                                         Documents                                                  Public</span><br><span class="line">anaconda-ks.cfg                                           Downloads                                                  report.out</span><br><span class="line">ClassPrep-8.x-7.r2020120320gitbe9ba2b.txt                 foundation0-config-8.x-</span><br><span class="line">.............</span><br><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─$                                                  </span><br></pre></td></tr></table></figure>

<h4 id="maxlogins-max-number-of-logins-for-this-user"><a href="#maxlogins-max-number-of-logins-for-this-user" class="headerlink" title="maxlogins - max number of logins for this user"></a>maxlogins - max number of logins for this user</h4><p>用户的最大登录数限制 ,这个我们前面有讲到，用于限制单个用户的最多登录次数，</p>
<p>这个没有快捷方式，只能通配置文件的方式，需要修改配置文件 <code>/etc/security/limits.conf</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;username&gt; hard maxlogins &lt;value&gt;</span><br></pre></td></tr></table></figure>

<h4 id="maxsyslogins-max-number-of-logins-on-the-system"><a href="#maxsyslogins-max-number-of-logins-on-the-system" class="headerlink" title="maxsyslogins - max number of logins on the system"></a>maxsyslogins - max number of logins on the system</h4><p>系统最多允许几个人登录，只对普通用户有效。没有快捷方式，只能通过配置文件的方式</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*        hard    maxlogins      &lt;number&gt;</span><br></pre></td></tr></table></figure>

<h4 id="priority-the-priority-to-run-user-process-with-scheduling-priority"><a href="#priority-the-priority-to-run-user-process-with-scheduling-priority" class="headerlink" title="priority - the priority to run user process with(scheduling priority)"></a>priority - the priority to run user process with(scheduling priority)</h4><p>限制 nice 优先级的范围，这个值仅对 普通用户有效，管理员无效，在用户启动进程的时候，可以通过 <code>nice</code> 命令调整进程的优先级。</p>
<p>这个 Demo 有问题，没有做出来，时间关系之后在看下一下</p>
<h4 id="nice-max-nice-priority-allowed-to-raise-to-values-20-19"><a href="#nice-max-nice-priority-allowed-to-raise-to-values-20-19" class="headerlink" title="nice - max nice priority allowed to raise to values: [-20, 19]"></a>nice - max nice priority allowed to raise to values: [-20, 19]</h4><p>允许调节的 nice 值的范围，默认值为 <code>-20 到 19</code>, 对普通用户有效，这个值和上面的值不太明白</p>
<h4 id="locks-max-number-of-file-locks-the-user-can-hold"><a href="#locks-max-number-of-file-locks-the-user-can-hold" class="headerlink" title="locks - max number of file locks the user can hold"></a>locks - max number of file locks the user can hold</h4><p>每个用户最多可以拥有多少个文件锁</p>
<h4 id="sigpending-max-number-of-pending-signals"><a href="#sigpending-max-number-of-pending-signals" class="headerlink" title="sigpending - max number of pending signals"></a>sigpending - max number of pending signals</h4><p>最大挂起的信号数量，对所有用户有效，信号已经产生但未处理的信号为挂起信号</p>
<p>当前 Linux 支持的所有的信号</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$kill</span> -l</span><br><span class="line"> 1) SIGHUP       2) SIGINT       3) SIGQUIT      4) SIGILL       5) SIGTRAP</span><br><span class="line"> 6) SIGABRT      7) SIGBUS       8) SIGFPE       9) SIGKILL     10) SIGUSR1</span><br><span class="line">11) SIGSEGV     12) SIGUSR2     13) SIGPIPE     14) SIGALRM     15) SIGTERM</span><br><span class="line">16) SIGSTKFLT   17) SIGCHLD     18) SIGCONT     19) SIGSTOP     20) SIGTSTP</span><br><span class="line">21) SIGTTIN     22) SIGTTOU     23) SIGURG      24) SIGXCPU     25) SIGXFSZ</span><br><span class="line">26) SIGVTALRM   27) SIGPROF     28) SIGWINCH    29) SIGIO       30) SIGPWR</span><br><span class="line">31) SIGSYS      34) SIGRTMIN    35) SIGRTMIN+1  36) SIGRTMIN+2  37) SIGRTMIN+3</span><br><span class="line">38) SIGRTMIN+4  39) SIGRTMIN+5  40) SIGRTMIN+6  41) SIGRTMIN+7  42) SIGRTMIN+8</span><br><span class="line">43) SIGRTMIN+9  44) SIGRTMIN+10 45) SIGRTMIN+11 46) SIGRTMIN+12 47) SIGRTMIN+13</span><br><span class="line">48) SIGRTMIN+14 49) SIGRTMIN+15 50) SIGRTMAX-14 51) SIGRTMAX-13 52) SIGRTMAX-12</span><br><span class="line">53) SIGRTMAX-11 54) SIGRTMAX-10 55) SIGRTMAX-9  56) SIGRTMAX-8  57) SIGRTMAX-7</span><br><span class="line">58) SIGRTMAX-6  59) SIGRTMAX-5  60) SIGRTMAX-4  61) SIGRTMAX-3  62) SIGRTMAX-2</span><br><span class="line">63) SIGRTMAX-1  64) SIGRTMAX</span><br><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─$</span><br></pre></td></tr></table></figure>

<h4 id="msgqueue-max-memory-used-by-POSIX-message-queues-bytes"><a href="#msgqueue-max-memory-used-by-POSIX-message-queues-bytes" class="headerlink" title="msgqueue - max memory used by POSIX message queues (bytes)"></a>msgqueue - max memory used by POSIX message queues (bytes)</h4><p>设置消息队列能够使用的内存大小，也就是最大创建多大的消息队列(默认 800KB )</p>
<p><code>消息队列</code>是<code>IPC(进程间通信)</code>的一种方式，如<code>管道</code>就可以实现<code>进程间通信</code>，<code>消息队列</code>也可以实现进程间通信。</p>
<p>进程间通信的方式:<code>管道，共享内存，socket，消息队列，堆栈，信号</code></p>
<p>但不同的是，管道要求发送消息时，对方进程必须在监听管道接受消息而消息队列允许一个进程发送消息到队列(第一个进程可以关闭了)，随后任意时间另一个进程启动，接着到队列中读取消息.</p>
<h4 id="rtprio-max-realtime-priority"><a href="#rtprio-max-realtime-priority" class="headerlink" title="rtprio - max realtime priority"></a>rtprio - max realtime priority</h4><p>rtprio 是一个与实时优先级相关的参数，在 Linux 系统中用于设定最大实时优先级。</p>
<h2 id="Systemd-使用Cgroup进行资源限制"><a href="#Systemd-使用Cgroup进行资源限制" class="headerlink" title="Systemd 使用Cgroup进行资源限制"></a>Systemd 使用Cgroup进行资源限制</h2><p>Systemd 是 Linux 中第一个启动的进程，PID 为 1 ，可以看做是其他进程的引导进程，通过 systemd 可以实现下面三种种方式的资源限制，这里实际上是都是基于 <code>Cgroup</code> 来做的。</p>
<ul>
<li>直接把限制的配置文件写到 <code>unit</code> 文件中</li>
<li>通过 <code>drop-in</code> 文件设置参数</li>
<li>使用 <code>systemctl set-property</code> 限制</li>
</ul>
<p>关于 <code>Cgroup</code> 是什么这里不多介绍，文末会简单说明一下</p>
<h3 id="通过-unit-单元文件进行限制"><a href="#通过-unit-单元文件进行限制" class="headerlink" title="通过 unit 单元文件进行限制"></a>通过 unit 单元文件进行限制</h3><p>先来看第一种，直接把配置文件写到 unit 文件中，创建下面的 service unit 配置文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$systemctl</span> cat demo.service</span><br><span class="line"><span class="comment"># /etc/systemd/system/demo.service</span></span><br><span class="line">[Unit]</span><br><span class="line">Description=Demo Service,这是一个 资源限制的Demo服务</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">ExecStart= sleep 300</span><br><span class="line">CPUAccounting=<span class="literal">true</span></span><br><span class="line">MemoryLimit=1G</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─$</span><br></pre></td></tr></table></figure>

<p>这里我们对 CPU 和内存做了限制，启用了 CPU 账户和内存限制，运行服务后，查看服务状态</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$systemctl</span> status demo.service</span><br><span class="line">● demo.service - Demo Service,这是一个 资源限制的Demo服务</span><br><span class="line">   Loaded: loaded (/etc/systemd/system/demo.service; disabled; vendor preset: disabled)</span><br><span class="line">   Active: active (running) since Tue 2023-10-03 17:27:32 CST; 2min 24s ago</span><br><span class="line"> Main PID: 20256 (sleep)</span><br><span class="line">    Tasks: 1 (<span class="built_in">limit</span>: 253184)</span><br><span class="line">   Memory: 168.0K (<span class="built_in">limit</span>: 1.0G)</span><br><span class="line">      CPU: 1ms</span><br><span class="line">   CGroup: /system.slice/demo.service</span><br><span class="line">           └─20256 /usr/bin/sleep 300</span><br><span class="line"></span><br><span class="line">Oct 03 17:27:32 liruilongs.github.io systemd[1]: Started Demo Service,这是一个 资源限制的Demo服务.</span><br></pre></td></tr></table></figure>

<p>从服务状态的信息中可以看到，默认如果没有定义 slice 的话，当前 service 文件会在当前系统的 <code>slice</code> 下面。</p>
<p>也可以通过下面查看对应的层级关系</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$systemctl</span> show demo.service -p Slice</span><br><span class="line">Slice=system.slice</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$systemctl</span> status system.slice | grep -A 1 demo</span><br><span class="line">           ├─demo.service</span><br><span class="line">           │ └─20560 /usr/bin/sleep 300</span><br><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─$</span><br></pre></td></tr></table></figure>

<p>如果希望查看对应的 cgroup 限制，可以在 <code>/proc</code> 目录下找对对应的 CGROUP 信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$cat</span> /proc/20256/cgroup</span><br><span class="line">12:devices:/system.slice</span><br><span class="line">11:perf_event:/</span><br><span class="line">10:rdma:/</span><br><span class="line">9:blkio:/system.slice</span><br><span class="line">8:hugetlb:/</span><br><span class="line">7:net_cls,net_prio:/</span><br><span class="line">6:cpuset:/</span><br><span class="line">5:pids:/system.slice/demo.service</span><br><span class="line">4:freezer:/</span><br><span class="line">3:cpu,cpuacct:/system.slice/demo.service</span><br><span class="line">2:memory:/system.slice/demo.service</span><br><span class="line">1:name=systemd:/system.slice/demo.service</span><br><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$systemctl</span> show demo.service -p Slice</span><br><span class="line">Slice=system.slice</span><br></pre></td></tr></table></figure>

<p>我们在 demo.service 中定义了对应的 CPU 和内存的资源限制，所以可以看到 <code>cpu ，memory</code> 的资源限制都是由 <code>demo.service</code> 来控制的。其他一些限制有 Cgroup 父层级 system.slice 控制。</p>
<p>当然，也可以定义自己的 <code>slice</code>，在一般情况下，为了对进程进行独立控制，都会创建独立的 <code>slice</code> 。在看一个 Demo</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$systemctl</span>  cat demo.slice</span><br><span class="line"><span class="comment"># /etc/systemd/system/demo.slice</span></span><br><span class="line">[Unit]</span><br><span class="line">Description=Demo Service Slice</span><br><span class="line"></span><br><span class="line">[Slice]</span><br><span class="line">CPUAccounting=<span class="literal">true</span></span><br><span class="line">MemoryLimit=2G</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>创建了一个 <code>slice</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$systemctl</span>  cat demo.service</span><br><span class="line"><span class="comment"># /etc/systemd/system/demo.service</span></span><br><span class="line">[Unit]</span><br><span class="line">Description=Demo Service,这是一个 资源限制的Demo服务</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">ExecStart= sleep 300</span><br><span class="line">Slice=demo.slice</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─$</span><br></pre></td></tr></table></figure>

<p>我们重写了 <code>serivce unit</code> 单元文件，并且添加了对应的 <code>demo.slice</code> 文件，重启服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$systemctl</span> status demo.service</span><br><span class="line">● demo.service - Demo Service,这是一个 资源限制的Demo服务</span><br><span class="line">   Loaded: loaded (/etc/systemd/system/demo.service; disabled; vendor preset: disabled)</span><br><span class="line">   Active: active (running) since Tue 2023-10-03 18:03:18 CST; 28s ago</span><br><span class="line"> Main PID: 21189 (sleep)</span><br><span class="line">    Tasks: 1 (<span class="built_in">limit</span>: 253184)</span><br><span class="line">   Memory: 164.0K</span><br><span class="line">   CGroup: /demo.slice/demo.service</span><br><span class="line">           └─21189 /usr/bin/sleep 300</span><br><span class="line"></span><br><span class="line">Oct 03 18:03:18 liruilongs.github.io systemd[1]: Started Demo Service,这是一个 资源限制的Demo服务.</span><br></pre></td></tr></table></figure>

<p>可以发现 <code>dmoe.service</code> 的上层 Cgroup 为 <code>demo.slice</code> ，不是前面的 <code>system.slice</code></p>
<p>查看 Cgroup slice 相关配置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$systemctl</span> show demo.service -p Slice</span><br><span class="line">Slice=demo.slice</span><br><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$cat</span> /proc/21189/cgroup</span><br><span class="line">12:devices:/demo.slice</span><br><span class="line">11:perf_event:/</span><br><span class="line">10:rdma:/</span><br><span class="line">9:blkio:/demo.slice</span><br><span class="line">8:hugetlb:/</span><br><span class="line">7:net_cls,net_prio:/</span><br><span class="line">6:cpuset:/</span><br><span class="line">5:pids:/demo.slice/demo.service</span><br><span class="line">4:freezer:/</span><br><span class="line">3:cpu,cpuacct:/demo.slice</span><br><span class="line">2:memory:/demo.slice/demo.service</span><br><span class="line">1:name=systemd:/demo.slice/demo.service</span><br></pre></td></tr></table></figure>

<p>这里 demo.slice 这个 Cgroup 层级只是为 demo.service 服务的，所以我们可以直接查看</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$systemctl</span> status demo.slice</span><br><span class="line">● demo.slice - Demo Service Slice</span><br><span class="line">   Loaded: loaded (/etc/systemd/system/demo.slice; disabled; vendor preset: disabled)</span><br><span class="line">   Active: active since Tue 2023-10-03 18:03:18 CST; 1min 23s ago</span><br><span class="line">    Tasks: 1</span><br><span class="line">   Memory: 164.0K (<span class="built_in">limit</span>: 2.0G)</span><br><span class="line">      CPU: 1ms</span><br><span class="line">   CGroup: /demo.slice</span><br><span class="line">           └─demo.service</span><br><span class="line">             └─21189 /usr/bin/sleep 300</span><br><span class="line"></span><br><span class="line">Oct 03 18:03:18 liruilongs.github.io systemd[1]: Created slice Demo Service Slice.</span><br><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─$</span><br></pre></td></tr></table></figure>

<h3 id="通过-drop-in-文件进行设置"><a href="#通过-drop-in-文件进行设置" class="headerlink" title="通过 drop-in 文件进行设置"></a>通过 drop-in 文件进行设置</h3><p>在限制之前，我们看一个服务的单元文件。下面为 k8s 中 kubelet 服务的单元文件，在 k8s 中 kubelet 可以看做是一个 Node 上的代理服务，用于计算节点和控制节点交互。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">┌──[root@vms82.liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$systemctl</span> status kubelet.service</span><br><span class="line">● kubelet.service - kubelet: The Kubernetes Node Agent</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/kubelet.service; enabled; vendor preset: disabled)</span><br><span class="line">  Drop-In: /usr/lib/systemd/system/kubelet.service.d</span><br><span class="line">           └─10-kubeadm.conf</span><br><span class="line">   Active: active (running) since Sun 2022-06-12 14:58:48 CST; 1 months 1 days ago</span><br><span class="line">     Docs: https://kubernetes.io/docs/</span><br><span class="line"> Main PID: 970 (kubelet)</span><br><span class="line">   Memory: 194.4M</span><br><span class="line">   CGroup: /system.slice/kubelet.service</span><br><span class="line">           └─970 /usr/bin/kubelet --bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.conf --kubeconfig=/etc/kubernetes/kubelet.conf --pod-manifest-path=/etc/kubernetes/kubelet.d --config=/var/lib/kubelet/config.yaml --network-plugin=cni --pod-infra-container-image=registry.aliyuncs.com/google_containers/pause:3.5</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>可以看到，区别于其他的配置文件，这里多了一个 下面的配置，这就是 <code>drop-in</code> 的方式，</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Drop-In: /usr/lib/systemd/system/kubelet.service.d</span><br><span class="line">          └─10-kubeadm.conf</span><br></pre></td></tr></table></figure>

<p><code>Drop-In</code>目录 <code>/usr/lib/systemd/system/kubelet.service.d</code> 。这个目录中所有后缀为 <code>&quot;.conf&quot;</code> 的文件将在<code>单元文件本身被解析之后被解析</code>,所以说 <code>kubelet.service</code> 单元文件的值可能会被覆盖。</p>
<p>看一个 Demo ,任然使用之前的 <code>demo.service 服务</code></p>
<p>新建对应服务的目录，然后创建对应的 <code>*.conf</code> 文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$mkdir</span> /etc/systemd/system/demo.service.d/</span><br><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$vim</span> /etc/systemd/system/demo.service.d/demo.conf</span><br><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$systemctl</span> daemon-reload</span><br><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$systemctl</span> start demo.service</span><br><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$systemctl</span> status demo.service</span><br><span class="line">● demo.service - Demo Service,这是一个 资源限制的Demo服务</span><br><span class="line">   Loaded: loaded (/etc/systemd/system/demo.service; disabled; vendor preset: disabled)</span><br><span class="line">  Drop-In: /etc/systemd/system/demo.service.d</span><br><span class="line">           └─demo.conf</span><br><span class="line">   Active: active (running) since Tue 2023-10-03 18:46:32 CST; 9s ago</span><br><span class="line"> Main PID: 21879 (sleep)</span><br><span class="line">    Tasks: 1 (<span class="built_in">limit</span>: 253184)</span><br><span class="line">   Memory: 164.0K</span><br><span class="line">   CGroup: /demo.slice/demo.service</span><br><span class="line">           └─21879 /usr/bin/sleep 300</span><br><span class="line"></span><br><span class="line">Oct 03 18:46:32 liruilongs.github.io systemd[1]: Started Demo Service,这是一个 资源限制的Demo服务.</span><br></pre></td></tr></table></figure>

<p>可以看到加载了 prod-in 配置文件，通过 <code>systemctl cat</code> 命令我们可以查看全部的配置信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─<span class="variable">$systemctl</span>  cat demo.service</span><br><span class="line"><span class="comment"># /etc/systemd/system/demo.service</span></span><br><span class="line">[Unit]</span><br><span class="line">Description=Demo Service,这是一个 资源限制的Demo服务</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">ExecStart= sleep 300</span><br><span class="line">Slice=demo.slice</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># /etc/systemd/system/demo.service.d/demo.conf</span></span><br><span class="line">[Service]</span><br><span class="line">LimitCPU=20s</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>添加了一个 CPU 使用时间的限制</p>
<h3 id="使用-systemctl-set-property-方式"><a href="#使用-systemctl-set-property-方式" class="headerlink" title="使用 systemctl set-property 方式"></a>使用 systemctl set-property 方式</h3><p>使用命令列来限定 httpd.service 的 CPU 和内存占用量</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如需使用命令列来限定 httpd.service 的 CPU 和内存占用量，请输入：</span></span><br><span class="line">systemctl set-property httpd.service CPUShares=600 MemoryLimit=500M</span><br></pre></td></tr></table></figure>
<p>此更改为临时更改，请添加 –runtime </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如希望此更改为临时更改，请添加 --runtime 选项：</span></span><br><span class="line">systemctl set-property --runtime httpd.service CPUShares=600 MemoryLimit=500M</span><br></pre></td></tr></table></figure>
<p>查看修改，我们会发现没有直接写入<code>httpd.service</code>配置文件，而是写入到目录下的文件里</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─$ systemctl set-property httpd.service BlockIOAccounting=<span class="literal">true</span></span><br><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─$ systemctl set-property httpd.service CPUShares=600 MemoryLimit=500M</span><br><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─$ cat  /etc/systemd/system/httpd.service.d/50-CPUShares.conf</span><br><span class="line">[Service]</span><br><span class="line">CPUShares=600</span><br><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─$ cat  /etc/systemd/system/httpd.service.d/50-MemoryLimit.conf</span><br><span class="line">[Service]</span><br><span class="line">MemoryLimit=524288000</span><br><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─$ cat  /etc/systemd/system/httpd.service.d/50-BlockIOAccounting.conf</span><br><span class="line">[Service]</span><br><span class="line">BlockIOAccounting=yes</span><br><span class="line">┌──[root@liruilongs.github.io]-[~]</span><br><span class="line">└─$</span><br></pre></td></tr></table></figure>




<h2 id="Cgroup-Control-Groups"><a href="#Cgroup-Control-Groups" class="headerlink" title="Cgroup(Control Groups)"></a>Cgroup(Control Groups)</h2><p><code>Cgroup(Control Groups)</code>最早由 google 开发，后来内置到了 Linux 内核中，是<code>Linux kernel(Linux内核)</code>的一项功能,目前是很多虚拟化容器技术的底层核心技术。</p>
<p><code>容器内存限制：-m 200M </code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">┌──[root@liruilongs.github.io]-[/]</span><br><span class="line">└─$ docker run -itd --name=c2 -m 200M  centos</span><br><span class="line">3b2df1738e84159f4fa02dadbfc285f6da8ddde4d94cb449bc775c9a70eaa4ea</span><br><span class="line">┌──[root@liruilongs.github.io]-[/]</span><br><span class="line">└─$ docker stats</span><br><span class="line">CONTAINER ID   NAME      CPU %     MEM USAGE / LIMIT     MEM %     NET I/O     BLOCK I/O         PIDS</span><br><span class="line">3b2df1738e84   c2        0.00%     528KiB / 200MiB       0.26%     648B / 0B   0B / 0B           1</span><br><span class="line">55e45b34d93d   c1        0.00%     8.684MiB / 3.843GiB   0.22%     648B / 0B   30.5MB / 11.5MB   2</span><br></pre></td></tr></table></figure>

<p><code>对容器CPU的限制：-cpuset-cpus 0</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">┌──[root@liruilongs.github.io]-[/]</span><br><span class="line">└─$ ps mo pid,psr $(pgrep cat)</span><br><span class="line">┌──[root@liruilongs.github.io]-[/]</span><br><span class="line">└─$ docker run -itd --name=c3 --cpuset-cpus 0 -m 200M  centos</span><br><span class="line">a771eed8c7c39cd410bd6f43909a67bfcf181d87fcafffe57001f17f3fdff408</span><br></pre></td></tr></table></figure>

<p>在一个系统中运行的<code>层级制进程组</code>,<code>Cgroup</code> 可对其进行<code>资源分配(如CPU时间、系统内存、网络带宽或者这些资源的组合)</code>。</p>
<p>通过使用<code>cgroup</code> ,系统管理员在分配、排序、拒绝、管理和监控系统资源等方面,可以进行精细化控制。硬件资源可以在应用程序和用户间智能分配,从而增加整体效率。</p>
<p><code>Cgroup</code>可对<code>进程</code>进行<code>层级式分组并标记</code>,并对其<code>可用资源进行限制</code>。</p>
<p><code>传统情况下</code>,所有的进程分得的<code>系统资源数量相近</code>,管理员用<code>进程niceness值</code>进行调节。</p>
<p>但是用<code>niceness</code>值进行调节,包含大量进程的应用程序可以比包含少量进程的应用程序获得更多资源,这与应用程序的重要程度无关。</p>
<p>通过将<code>cgroup</code>层级系统与<code>systemd</code>单位树捆绑, Linux 可以把资源管理设置从<code>进程级别</code>移至<code>应用程序</code>级别。</p>
<p>可以使用systemctl指令,或者通过修改systemd单位文件来管理系统资源。</p>
<p>为了控制重要的内核资源，<code>systemd</code> 会自动挂载<code>/sys/fs/cgroup </code>目录实现 <code>cgroup</code> 分层架构,Linux 内核的资源管理器，也叫 CGroup 子系统，代表某一种单一资源(如 CPU 时间或内存等</p>
<p>Linux 内核提供了一系列资源管理器，由 <code>systemd</code> 自动挂载。如果需要查看已经挂载的资源管理器列表，可以参考<code>/proc/cgroups</code></p>
<h3 id="可用的资源管理器"><a href="#可用的资源管理器" class="headerlink" title="可用的资源管理器:"></a>可用的资源管理器:</h3><p>可以进行限制的资源列表</p>
<ul>
<li><code>blkio</code>: 对块设备的输入、输出进行限制</li>
<li><code>cpu</code>: 使用 CPU 调度程序让 cgruop 的任务可用获取合理的 CPU 时间，她与 cpuacct 管理器一起挂载在同一目录上。</li>
<li><code>cpuacct</code>:自动生成 cgruop 中任务占用 CPU 资源的报告</li>
<li><code>cpuset</code>: 给 cgroup 中的任务分配独立的 CPU 和内存节点</li>
<li><code>devices</code>:允许或禁止 cgroup 中的任务读写设备。</li>
<li><code>freezer</code>: 暂停或恢复 cgroup 中的任务。</li>
<li><code>memory</code>: 对 cgroup 中的任务使用内存量进行限制，并且自动生成任务占用内存资源的报告</li>
<li><code>net_cls</code>: 使用等级标识符(classid)标记网络数据包，可以让 Linux 流量控制器识别特定 cgroup 任务的数据包。</li>
<li><code>perf-event</code>:许使用 pef 工具监控 <code>cgroup</code>。</li>
<li><code>hugetlb</code>:允许使用大的虚拟内存页，并为这些内存设置强制可用资源量</li>
</ul>
<p>在安装了 kernel-doc 软件包后，可以在<code>/usr/share/doc/kernel-doc-&lt;version&gt;/Documentation/cgroup </code>目录下找相关管理器的说明文档，从而配置合适的资源限制</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">┌──[root@liruilongs.github.io]-[/usr/share/doc/kernel-doc-4.18.0/Documentation/cgroup-v1]</span><br><span class="line">└─<span class="variable">$ls</span></span><br><span class="line">00-INDEX              cgroups.txt  cpusets.txt  freezer-subsystem.txt  memcg_test.txt  net_cls.txt   pids.txt</span><br><span class="line">blkio-controller.txt  cpuacct.txt  devices.txt  hugetlb.txt            memory.txt      net_prio.txt  rdma.txt</span><br><span class="line">┌──[root@liruilongs.github.io]-[/usr/share/doc/kernel-doc-4.18.0/Documentation/cgroup-v1]</span><br><span class="line">└─<span class="variable">$ll</span></span><br><span class="line">total 184</span><br><span class="line">-r--r--r--. 1 root root   939 Mar 27  2020 00-INDEX</span><br><span class="line">-r--r--r--. 1 root root 15532 Mar 27  2020 blkio-controller.txt</span><br><span class="line">-r--r--r--. 1 root root 26828 Mar 27  2020 cgroups.txt</span><br><span class="line">-r--r--r--. 1 root root  1972 Mar 27  2020 cpuacct.txt</span><br><span class="line">-r--r--r--. 1 root root 37219 Mar 27  2020 cpusets.txt</span><br><span class="line">-r--r--r--. 1 root root  4370 Mar 27  2020 devices.txt</span><br><span class="line">-r--r--r--. 1 root root  4909 Mar 27  2020 freezer-subsystem.txt</span><br><span class="line">-r--r--r--. 1 root root  1714 Mar 27  2020 hugetlb.txt</span><br><span class="line">-r--r--r--. 1 root root  8480 Mar 27  2020 memcg_test.txt</span><br><span class="line">-r--r--r--. 1 root root 37743 Mar 27  2020 memory.txt</span><br><span class="line">-r--r--r--. 1 root root  1267 Mar 27  2020 net_cls.txt</span><br><span class="line">-r--r--r--. 1 root root  2513 Mar 27  2020 net_prio.txt</span><br><span class="line">-r--r--r--. 1 root root  3108 Mar 27  2020 pids.txt</span><br><span class="line">-r--r--r--. 1 root root  4410 Mar 27  2020 rdma.txt</span><br></pre></td></tr></table></figure>

<p>简单的信息可以通过索引文件的了解</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">┌──[root@liruilongs.github.io]-[/usr/share/doc/kernel-doc-4.18.0/Documentation/cgroup-v1]</span><br><span class="line">└─<span class="variable">$cat</span> 00-INDEX</span><br><span class="line">00-INDEX</span><br><span class="line">        - this file</span><br><span class="line">blkio-controller.txt</span><br><span class="line">        - Description <span class="keyword">for</span> Block IO Controller, implementation and usage details.</span><br><span class="line">cgroups.txt</span><br><span class="line">        - Control Groups definition, implementation details, examples and API.</span><br><span class="line">cpuacct.txt</span><br><span class="line">        - CPU Accounting Controller; account CPU usage <span class="keyword">for</span> groups of tasks.</span><br><span class="line">cpusets.txt</span><br><span class="line">        - documents the cpusets feature; assign CPUs and Mem to a <span class="built_in">set</span> of tasks.</span><br><span class="line">admin-guide/devices.rst</span><br><span class="line">        - Device Whitelist Controller; description, interface and security.</span><br><span class="line">freezer-subsystem.txt</span><br><span class="line">        - checkpointing; rationale to not use signals, interface.</span><br><span class="line">hugetlb.txt</span><br><span class="line">        - HugeTLB Controller implementation and usage details.</span><br><span class="line">memcg_test.txt</span><br><span class="line">        - Memory Resource Controller; implementation details.</span><br><span class="line">memory.txt</span><br><span class="line">        - Memory Resource Controller; design, accounting, interface, testing.</span><br><span class="line">net_cls.txt</span><br><span class="line">        - Network classifier cgroups details and usages.</span><br><span class="line">net_prio.txt</span><br><span class="line">        - Network priority cgroups details and usages.</span><br><span class="line">pids.txt</span><br><span class="line">        - Process number cgroups details and usages.</span><br><span class="line">┌──[root@liruilongs.github.io]-[/usr/share/doc/kernel-doc-4.18.0/Documentation/cgroup-v1]</span><br><span class="line">└─$</span><br></pre></td></tr></table></figure>

<p>关于 Linux 资源限制就和小伙伴分享到这里，生活加油哦 <code>^_^</code></p>
<h2 id="博文部分内容参考"><a href="#博文部分内容参考" class="headerlink" title="博文部分内容参考"></a>博文部分内容参考</h2><p>© 文中涉及参考链接内容版权归原作者所有，如有侵权请告知 :)</p>
<hr>
<p><a target="_blank" rel="noopener" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html-single/resource_management_guide/index">https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux&#x2F;7&#x2F;html-single&#x2F;resource_management_guide&#x2F;index</a></p>
<p><a href="#">《 Red Hat Performance Tuning 442 》</a></p>
<hr>
<p>© 2018-2023 <a href="mailto:&#108;&#105;&#114;&#117;&#x69;&#108;&#111;&#x6e;&#x67;&#101;&#114;&#64;&#x67;&#109;&#x61;&#x69;&#x6c;&#x2e;&#99;&#x6f;&#x6d;">&#108;&#105;&#114;&#117;&#x69;&#108;&#111;&#x6e;&#x67;&#101;&#114;&#64;&#x67;&#109;&#x61;&#x69;&#x6c;&#x2e;&#99;&#x6f;&#x6d;</a>, All rights reserved. 保持署名-非商用-相同方式共享(CC BY-NC-SA 4.0)</p>
</div><div class="article-licensing box"><div class="licensing-title"><p>Linux 性能调优之资源限制</p><p><a href="https://liruilongs.github.io/2023/10/17/待发布/Linux-性能调优之资源限制/">https://liruilongs.github.io/2023/10/17/待发布/Linux-性能调优之资源限制/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><a href="https://liruilongs.github.io"><p>山河已无恙</p></a></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2023-10-17</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2023-11-02</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a class="icon" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a><a class="icon" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="recommend-area"><div class="recommend-post"><span class="is-size-6 has-text-grey has-mr-7"># 相关文章</span><br><span>  1.<a class="is-size-6" href="/2023/10/07/%E5%BE%85%E5%8F%91%E5%B8%83/Linux%20%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98%E4%B9%8B%E7%BD%91%E7%BB%9C%E5%86%85%E6%A0%B8%E5%8F%82%E6%95%B0%E4%BC%98%E5%8C%96/" target="_blank">Linux 性能调优之网络内核参数优化</a><br></span><span>  2.<a class="is-size-6" href="/2023/10/07/%E5%BE%85%E5%8F%91%E5%B8%83/Linux%20%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98%E4%B9%8B%E7%A1%AC%E4%BB%B6%E8%B5%84%E6%BA%90%E7%9B%91%E6%8E%A7/" target="_blank">Linux 性能调优之硬件资源监控</a><br></span><span>  3.<a class="is-size-6" href="/2022/12/06/Linux/What-is-the-difference-between-the-iptables-command-and-iptables-service/" target="_blank">iptables 命令和 iptables.service 服务的区别是上面 ?</a><br></span><span>  4.<a class="is-size-6" href="/2022/12/03/Linux/%E5%85%B3%E4%BA%8E%20Linux%20%E4%B8%AD%20firewalld%20%E7%9A%84%E4%B8%80%E4%BA%9B%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86/" target="_blank">关于 Linux 中 firewalld 的一些笔记整理</a><br></span><span>  5.<a class="is-size-6" href="/2022/10/03/%E5%BE%85%E5%8F%91%E5%B8%83/%E3%80%8ALinux-Basics-for-Hackers-Getting-Started-with-Networking-Scripting-and-Security-in-Kali-%E3%80%8B%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" target="_blank">《Linux Basics for Hackers：Getting Started with Networking, Scripting, and Security in Kali 》读书笔记</a><br></span><span>  6.<a class="is-size-6" href="/2022/09/05/rhca/RH442/%E5%85%B3%E4%BA%8ELinux%E4%B8%AD%E4%BD%BF%E7%94%A8USE(%E4%BD%BF%E7%94%A8%E7%8E%87%E3%80%81%E9%A5%B1%E5%92%8C%E5%BA%A6%E3%80%81%E9%94%99%E8%AF%AF)%E6%96%B9%E6%B3%95%E5%88%86%E6%9E%90%E7%B3%BB%E7%BB%9F%E6%80%A7%E8%83%BD%E7%9A%84%E4%B8%80%E4%BA%9B%E7%AC%94%E8%AE%B0/" target="_blank">关于Linux中使用USE(使用率/饱和度/错误)方法分析系统性能的一些笔记</a><br></span><span>  7.<a class="is-size-6" href="/2022/07/31/rhca/RH442/Linux%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98%E4%B8%AD%E5%86%85%E5%AD%98%E8%B0%83%E4%BC%98%E5%B7%A5%E5%85%B7%E7%9A%84%E4%B8%80%E4%BA%9B%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86/" target="_blank">Linux性能调优中内存调优工具的一些笔记整理</a><br></span><span>  8.<a class="is-size-6" href="/2022/07/23/rhca/RH442/%E5%85%B3%E4%BA%8E%20Linux%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98%E4%B9%8B%E5%86%85%E5%AD%98%E8%B4%9F%E8%BD%BD%E8%B0%83%E4%BC%98/" target="_blank">关于Linux性能调优之内存负载调优</a><br></span></div><div class="recommend-post"><span class="is-size-6 has-text-grey has-mr-7"># 推荐文章</span><br><span>  1.<a class="is-size-6" href="/2021/08/27/K8s/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/%E3%80%8AKubernetes%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-%E4%BB%8EDocker%E5%88%B0Kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A8%E6%8E%A5%E8%A7%A6%E3%80%8B%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" target="_blank">《Kubernetes权威指南:从Docker到Kubernetes实践全接触》读书笔记</a><br></span><span>  2.<a class="is-size-6" href="/2020/07/30/Java/Java%E4%B8%ADtry%7B%7Dcatch%E7%9A%84%E9%9A%90%E8%97%8F(%E5%A6%82%E4%BD%95%E4%BC%98%E9%9B%85%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%BC%82%E5%B8%B8%E5%9D%97)/" target="_blank">Java中try{}catch的隐藏(如何优雅的实现异常块)</a><br></span><span>  3.<a class="is-size-6" href="/2021/07/04/Java/%E3%80%8A%E5%88%86%E5%B8%83%E5%BC%8F%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%AE%9E%E8%B7%B5%E3%80%8B%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" target="_blank">《分布式消息中间件实践》 读书笔记</a><br></span><span>  4.<a class="is-size-6" href="/2021/07/01/Java/%E3%80%8A%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E3%80%8B%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" target="_blank">《微服务架构设计模式》读书笔记</a><br></span><span>  5.<a class="is-size-6" href="/2022/02/11/Java/%E3%80%90JAVA%E5%86%B7%E7%9F%A5%E8%AF%86%E3%80%91JAVA%E7%9C%9F%E7%9A%84%E4%B8%8D%E6%94%AF%E6%8C%81%E5%A4%9A%E7%BB%A7%E6%89%BF%E5%90%97%EF%BC%9F%E7%94%A8%E5%86%85%E9%83%A8%E7%B1%BB%E5%8E%BB%E5%AE%9E%E7%8E%B0%E5%AE%83%E5%90%A7%EF%BC%81/" target="_blank">【JAVA冷知识】JAVA居然支持多继承吗？让我们用内部类去吧</a><br></span><span>  6.<a class="is-size-6" href="/2022/02/11/Java/%E3%80%90JAVA%E5%86%B7%E7%9F%A5%E8%AF%86%E3%80%91%E4%BB%80%E4%B9%88%E6%98%AF%E9%80%86%E5%8F%98(contravariant)&amp;%E5%8D%8F%E5%8F%98(covariant)%EF%BC%9F%E6%95%B0%E7%BB%84%E6%94%AF%E6%8C%81%E5%8D%8F%E5%8F%98&amp;%E9%80%86%E5%8F%98%E5%90%97%EF%BC%9F%E6%B3%9B%E5%9E%8B%E5%91%A2%EF%BC%9F/" target="_blank">【JAVA冷知识】什么是逆变(contravariant)与协变(covariant)？数组支持协变&amp;逆变吗？泛型呢？</a><br></span></div></div><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/social-share.js/1.0.16/css/share.min.css"><div class="social-share"></div><script src="https://cdnjs.loli.net/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">喜欢这篇文章？打赏一下作者吧</h3><div class="buttons is-centered"><a class="button donate" data-type="alipay"><span class="icon is-small"><i class="fab fa-alipay"></i></span><span>支付宝</span><span class="qrcode"><img src="/img/alipay%EF%BF%A5.png" alt="支付宝"></span></a><a class="button donate" data-type="wechat"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>微信</span><span class="qrcode"><img src="/img/wechat%EF%BF%A5.png" alt="微信"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2023/11/03/%E5%BE%85%E5%8F%91%E5%B8%83/FastAPI%20%E5%BC%82%E6%AD%A5%E5%90%8E%E5%8F%B0%E4%BB%BB%E5%8A%A1%E9%98%BB%E5%A1%9E%E5%85%B6%E4%BB%96%E8%AF%B7%E6%B1%82%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86%EF%BC%9F/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">FastAPI 异步后台任务阻塞其他请求如何处理？</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2023/10/16/%E5%BE%85%E5%8F%91%E5%B8%83/%E6%95%B0%E6%8D%AE%E5%BA%8F%E5%88%97%E5%8C%96%E5%8D%8F%E8%AE%AE%20Protocol%20Buffers(Protobuf)%20%20%E8%AE%A4%E7%9F%A5/"><span class="level-item">数据序列化协议 Protocol Buffers(Protobuf)  认知</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--><div class="card"><div class="card-content"><div class="title is-5">评论</div><div id="comment-container"></div><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/gitalk/1.6.0/gitalk.css"><script> $.getScript('/js/gitalk.min.js', function () { 
            var gitalk = new Gitalk({
            language:'zh-CN',
            id: '4b494ce09d687054bdf99ad4180942a7',
            repo: 'blog_comment',
            owner: 'LIRUILONGS',
            clientID: '9fdc9739266d48d5f62e',
            clientSecret: 'c1cc33697d099a2197650ec9dadcb16bd4904655',
            admin: ["LIRUILONGS"],
            createIssueManually: true,
            distractionFreeMode: true,
            perPage: 10,
            pagerDirection: 'last',
            proxy: 'https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token',
            
            enableHotKey: true,
            isLocked: false
        })
        gitalk.render('comment-container')});</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><ul class="menu-list"><li><a class="is-flex is-mobile" href="#写在前面"><span class="mr-2">1.1</span><span>写在前面</span></a></li></ul><li><a class="is-flex is-mobile" href="#使用-Cgroups-和-ulimit-管理资源限制"><span class="mr-2">2</span><span>使用 Cgroups 和 ulimit 管理资源限制</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#ulimit-会话资源限制"><span class="mr-2">2.1</span><span>ulimit 会话资源限制</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#rtprio-max-realtime-priority"><span class="mr-2">2.1.1</span><span>rtprio - max realtime priority</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#Systemd-使用Cgroup进行资源限制"><span class="mr-2">2.2</span><span>Systemd 使用Cgroup进行资源限制</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#通过-unit-单元文件进行限制"><span class="mr-2">2.2.1</span><span>通过 unit 单元文件进行限制</span></a></li><li><a class="is-flex is-mobile" href="#通过-drop-in-文件进行设置"><span class="mr-2">2.2.2</span><span>通过 drop-in 文件进行设置</span></a></li><li><a class="is-flex is-mobile" href="#使用-systemctl-set-property-方式"><span class="mr-2">2.2.3</span><span>使用 systemctl set-property 方式</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#Cgroup-Control-Groups"><span class="mr-2">2.3</span><span>Cgroup(Control Groups)</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#可用的资源管理器"><span class="mr-2">2.3.1</span><span>可用的资源管理器:</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#博文部分内容参考"><span class="mr-2">2.4</span><span>博文部分内容参考</span></a></li></ul></li></ul></div></div><style>.menu-list > li > a.is-active + .menu-list { display: block; }.menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="card widget" data-type="profile"><div class="card-content"><nav class=""><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7.jpg" alt="山河已无恙"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">山河已无恙</p><p class="is-size-6 is-block">爱自己，是终生浪漫的开始</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>中国·呼和浩特</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">312</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">102</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">153</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://liruilong.blog.csdn.net/?t=1&amp;type=blog" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/LIRUILONGS"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="CSDN" href="https://liruilong.blog.csdn.net/"><i class="fa fa-code"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Email" href="mailto:1224965096@qq.com"><i class="fa fa-envelope"></i></a></div></div></div><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://liruilong.blog.csdn.net/?t=1&amp;type=blog" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">CSDN</span></span><span class="level-right"><span class="level-item tag">liruilong.blog.csdn.net</span></span></a></li><li><a class="level is-mobile" href="https://www.cnblogs.com/liruilong/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">博客园</span></span><span class="level-right"><span class="level-item tag">www.cnblogs.com</span></span></a></li><li><a class="level is-mobile" href="https://github.com/LIRUILONGS" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Githup</span></span><span class="level-right"><span class="level-item tag">github.com</span></span></a></li><li><a class="level is-mobile" href="https://gitee.com/liruilonger" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">码云</span></span><span class="level-right"><span class="level-item tag">gitee.com</span></span></a></li></ul></div></div></div><!--!--><div class="card widget"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-11-10T07:55:27.000Z">2023-11-10</time></p><p class="title"><a href="/2023/11/10/%E5%BE%85%E5%8F%91%E5%B8%83/Linux-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E4%B9%8B%E4%BD%BF%E7%94%A8-Tuned-%E9%85%8D%E7%BD%AE%E4%BC%98%E5%8C%96%E6%96%B9%E6%A1%88/">Linux 性能优化之使用 Tuned 配置优化方案</a></p><p class="categories"><a href="/categories/test3/">test3</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-11-03T09:41:50.000Z">2023-11-03</time></p><p class="title"><a href="/2023/11/03/%E5%BE%85%E5%8F%91%E5%B8%83/FastAPI%20%E5%BC%82%E6%AD%A5%E5%90%8E%E5%8F%B0%E4%BB%BB%E5%8A%A1%E9%98%BB%E5%A1%9E%E5%85%B6%E4%BB%96%E8%AF%B7%E6%B1%82%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86%EF%BC%9F/">FastAPI 异步后台任务阻塞其他请求如何处理？</a></p><p class="categories"><a href="/categories/FastAPI/">FastAPI</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-10-17T11:31:42.000Z">2023-10-17</time></p><p class="title"><a href="/2023/10/17/%E5%BE%85%E5%8F%91%E5%B8%83/Linux-%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98%E4%B9%8B%E8%B5%84%E6%BA%90%E9%99%90%E5%88%B6/">Linux 性能调优之资源限制</a></p><p class="categories"><a href="/categories/Linux/">Linux</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-10-17T03:16:10.000Z">2023-10-16</time></p><p class="title"><a href="/2023/10/16/%E5%BE%85%E5%8F%91%E5%B8%83/%E6%95%B0%E6%8D%AE%E5%BA%8F%E5%88%97%E5%8C%96%E5%8D%8F%E8%AE%AE%20Protocol%20Buffers(Protobuf)%20%20%E8%AE%A4%E7%9F%A5/">数据序列化协议 Protocol Buffers(Protobuf)  认知</a></p><p class="categories"><a href="/categories/Protobuf/">Protobuf</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-10-16T21:14:36.000Z">2023-10-16</time></p><p class="title"><a href="/2023/10/16/%E5%BE%85%E5%8F%91%E5%B8%83/Ceph%EF%BC%9A%E5%85%B3%E4%BA%8ECeph-%E4%B8%AD%E5%88%9B%E5%BB%BA%E5%92%8C%E7%AE%A1%E7%90%86%E8%87%AA%E5%AE%9A%E4%B9%89-CRUSH-map%E7%9A%84%E4%B8%80%E4%BA%9B%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86/">Ceph：关于Ceph 中创建和管理自定义 CRUSH map的一些笔记整理</a></p><p class="categories"><a href="/categories/Ceph/">Ceph</a></p></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/categories/AdaFace/"><span class="level-start"><span class="level-item">AdaFace</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Ajax/"><span class="level-start"><span class="level-item">Ajax</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Ansible/"><span class="level-start"><span class="level-item">Ansible</span></span><span class="level-end"><span class="level-item tag">23</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/AppCube/"><span class="level-start"><span class="level-item">AppCube</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Bind9/"><span class="level-start"><span class="level-item">Bind9</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/CI-CD/"><span class="level-start"><span class="level-item">CI/CD</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/CSS/"><span class="level-start"><span class="level-item">CSS</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Ceph/"><span class="level-start"><span class="level-item">Ceph</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/DAD-3DHeads/"><span class="level-start"><span class="level-item">DAD-3DHeads</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/DNS/"><span class="level-start"><span class="level-item">DNS</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><a class="level is-mobile is-marginless" href="/categories/"><span class="level-start"><span class="level-item">查看全部&gt;&gt;</span></span></a></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/archives/2023/11/"><span class="level-start"><span class="level-item">十一月 2023</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2023/10/"><span class="level-start"><span class="level-item">十月 2023</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2023/09/"><span class="level-start"><span class="level-item">九月 2023</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2023/08/"><span class="level-start"><span class="level-item">八月 2023</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2023/07/"><span class="level-start"><span class="level-item">七月 2023</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><a class="level is-mobile is-marginless" href="/archives/"><span class="level-start"><span class="level-item">查看全部&gt;&gt;</span></span></a></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/Kubernetes/"><span class="tag">Kubernetes</span><span class="tag is-grey-lightest">89</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Linux/"><span class="tag">Linux</span><span class="tag is-grey-lightest">32</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Ansible/"><span class="tag">Ansible</span><span class="tag is-grey-lightest">25</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Python/"><span class="tag">Python</span><span class="tag is-grey-lightest">14</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Ceph/"><span class="tag">Ceph</span><span class="tag is-grey-lightest">11</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Docker/"><span class="tag">Docker</span><span class="tag is-grey-lightest">8</span></a></div><div class="control"><a class="tags has-addons" href="/tags/JAVA/"><span class="tag">JAVA</span><span class="tag is-grey-lightest">8</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Git/"><span class="tag">Git</span><span class="tag is-grey-lightest">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/OpenShift/"><span class="tag">OpenShift</span><span class="tag is-grey-lightest">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%A8%8B%E5%BA%8F%E4%BA%BA%E7%94%9F/"><span class="tag">程序人生</span><span class="tag is-grey-lightest">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/DNS/"><span class="tag">DNS</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Go/"><span class="tag">Go</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/OKD/"><span class="tag">OKD</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%AE%B9%E5%99%A8/"><span class="tag">容器</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%BD%91%E7%BB%9C/"><span class="tag">网络</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CKA/"><span class="tag">CKA</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ISCSI/"><span class="tag">ISCSI</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/NFS/"><span class="tag">NFS</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/selenium/"><span class="tag">selenium</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/shell/"><span class="tag">shell</span><span class="tag is-grey-lightest">3</span></a></div></div><div class="field is-grouped is-grouped-multiline"><a class="tags has-addons" href="/tags/"><span class="tag">查看全部&gt;&gt;</span></a></div></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">订阅更新</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="订阅"></div></div></form></div></div></div><!--!--><div class="column-right-shadow is-hidden-widescreen is-sticky"></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.png" alt="山河已无恙" height="28"></a><p class="size-small"><span>&copy; 2023 山河已无恙</span>  Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank">Icarus</a> &amp; <a href="https://github.com/removeif/hexo-theme-amazing" target="_blank">Amazing</a> <br><span>© <a href="http://www.beian.miit.gov.cn/" target="_blank">备案号</a><br></span><span>© 版权说明：[本网站所有内容均收集于互联网或自己创作,<br />&nbsp;&nbsp;&nbsp;&nbsp;方便于网友与自己学习交流，如有侵权，请<a href="/message" target="_blank">留言</a>，立即处理]<br /></span><span><span id="statistic-times">loading...</span><script>function createTime(time) {
            var n = new Date(time);
            now.setTime(now.getTime() + 250),
                days = (now - n) / 1e3 / 60 / 60 / 24,
                dnum = Math.floor(days),
                hours = (now - n) / 1e3 / 60 / 60 - 24 * dnum,
                hnum = Math.floor(hours),
            1 == String(hnum).length && (hnum = "0" + hnum),
                minutes = (now - n) / 1e3 / 60 - 1440 * dnum - 60 * hnum,
                mnum = Math.floor(minutes),
            1 == String(mnum).length && (mnum = "0" + mnum),
                seconds = (now - n) / 1e3 - 86400 * dnum - 3600 * hnum - 60 * mnum,
                snum = Math.round(seconds),
            1 == String(snum).length && (snum = "0" + snum),
                document.getElementById("statistic-times").innerHTML = "❤️本站自 <strong>"+time.split(" ")[0].replace(/\//g,".")+"</strong> 已运行 <strong>" + dnum + "</strong> 天 <strong>" + hnum + "</strong> 小时 <strong>" + mnum + "</strong> 分 <strong>" + snum + "</strong> 秒！❤️";
        }var now = new Date();setInterval("createTime('2021/6/26 21:27:00')", 250,"");</script><br></span><div class="size-small"><span>❤️感谢 <strong><span id="busuanzi_value_site_uv">99+</span></strong> 小伙伴的 <strong><span id="busuanzi_value_site_pv">99+</span></strong> 次光临！❤️</span></div></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/removeif/hexo-theme-amazing"><i class="fab fa-github"></i></a></p></div><div class="sideMusic"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="/js/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script><meting-js style="width: auto;height: 2000px;" server="netease" type="playlist" id="2364053447" theme="#2980b9" loop="all" autoplay="false" order="list" storageName="aplayer-setting" lrctype="0" list-max-height="400px" fixed="true"></meting-js></div></div></div></div></footer><script src="https://cdnjs.loli.net/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script><script src="https://cdnjs.loli.net/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" async></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><!--!--><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><script src="https://cdnjs.loli.net/ajax/libs/lightgallery/1.6.8/js/lightgallery.min.js" defer></script><script src="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.7.0/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/KaTeX/0.11.1/katex.min.css"><script src="https://cdnjs.loli.net/ajax/libs/KaTeX/0.11.1/katex.min.js" defer></script><script src="https://cdnjs.loli.net/ajax/libs/KaTeX/0.11.1/contrib/auto-render.min.js" defer></script><script src="https://cdnjs.loli.net/ajax/libs/KaTeX/0.11.1/contrib/mhchem.js" defer></script><script>window.addEventListener("load", function() {
            document.querySelectorAll('[role="article"] > .content').forEach(function(element) {
                renderMathInElement(element);
            });
        });</script><script type="text/x-mathjax-config">MathJax.Hub.Config({
            'HTML-CSS': {
                matchFontHeight: false
            },
            SVG: {
                matchFontHeight: false
            },
            CommonHTML: {
                matchFontHeight: false
            },
            tex2jax: {
                inlineMath: [
                    ['$','$'],
                    ['\\(','\\)']
                ]
            }
        });</script><script src="https://cdnjs.loli.net/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><div id="outdated"><h6>Your browser is out-of-date!</h6><p>Update your browser to view this website correctly.&amp;npsb;<a id="btnUpdateBrowser" target="_blank" rel="noopener" href="http://outdatedbrowser.com/">Update my browser now </a></p><p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">×</a></p></div><script src="https://cdnjs.loli.net/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.js" defer></script><script>window.addEventListener("load", function () {
            outdatedBrowser({
                bgColor: '#f25648',
                color: '#ffffff',
                lowerThan: 'object-fit' // display on IE11 or below
            });
        });</script><!--!--><script src="/js/main.js" defer></script><script>$.getScript('/js/comment-issue-data.js',function(){loadIssueData('9fdc9739266d48d5f62e','c1cc33697d099a2197650ec9dadcb16bd4904655','LIRUILONGS','blog_comment',false);})</script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.js"></script><script type="text/javascript">var pjax = new Pjax({
            elements: "a",//代表点击链接就更新
            selectors: [  //代表要更新的节点
                ".section",
                "title"
            ],
            cache: true,
            cacheBust:false
        })

        function loadBusuanzi(){
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js", function () {});
        }

        function loadMathJax() { //加载mathjax
            $.getScript("//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML", function () {
                MathJax.Hub.Config({ tex2jax: { inlineMath: [['$', '$'], ['\(', '\)']] } });
                var math = document.getElementsByClassName("entry-content")[0];
                MathJax.Hub.Queue(["Typeset", MathJax.Hub, math]);
            });
        };

        // 开始 PJAX 执行的函数
        document.addEventListener('pjax:send', function () {
        });
        
        // PJAX 完成之后执行的函数，可以和上面的重载放在一起
        document.addEventListener('pjax:complete', function () {
            $(".section").css({opacity:1});
            if(false){
                $.getScript('/js/comment-issue-data.js',function(){loadIssueData('9fdc9739266d48d5f62e','c1cc33697d099a2197650ec9dadcb16bd4904655','LIRUILONGS','blog_comment',false);});
            }
            if(false){
                loadMathJax();
            }
            loadMainJs(jQuery, window.moment, window.ClipboardJS, window.IcarusThemeSettings);
            loadBackTop();
            loadBusuanzi();
            if(typeof loadBanner == 'function'){
                loadBanner();
            }
        });</script></body></html>